{
    "abilities": {
        "can_manage_common_responses?": false, 
        "can_manage_collaborators?": false, 
        "can_reopen?": false, 
        "can_ban_researcher?": false, 
        "can_create_severity?": false, 
        "can_assign_to_h1_triage?": false, 
        "can_agree_on_going_public?": false, 
        "assignable_team_member_groups": [], 
        "can_view_credential_account_details?": false, 
        "can_export?": false, 
        "can_create_retest?": false, 
        "can_assign_to_user?": false, 
        "can_use_common_responses?": false, 
        "can_hide_timeline?": false, 
        "can_be_manually_disclosed?": false, 
        "assignable_team_members": [], 
        "can_clone?": false, 
        "can_be_publicly_disclosed?": false, 
        "can_close_comments?": false, 
        "can_view_bounty_weights?": false, 
        "can_suggest_bounty_amount?": false, 
        "can_cancel_disclosure_request?": false, 
        "can_redact?": false, 
        "can_change_structured_scope?": false, 
        "can_post_internal_comments?": false, 
        "can_change_state?": false, 
        "can_change_weakness?": false, 
        "can_add_comment?": false, 
        "can_reassign_to_team?": false, 
        "can_change_title?": false, 
        "can_award_bounty?": false, 
        "can_award_swag?": false, 
        "can_close?": false, 
        "can_manage?": false
    }, 
    "comments_closed?": false, 
    "substate": "informative", 
    "bug_reporter_agreed_on_going_public_at": "2017-11-10T09:34:10.401Z", 
    "voters": [
        "jokebookservice1", 
        "003random", 
        "babayaga_", 
        "666reda"
    ], 
    "facebook_team?": false, 
    "has_bounty?": false, 
    "rejected_anc_report_that_can_be_sent_back_to_anc_triagers?": false, 
    "original_report_id": null, 
    "id": 287835, 
    "can_view_team": true, 
    "team_member_agreed_on_going_public_at": "2018-02-23T07:19:19.683Z", 
    "activity_page_count": 1, 
    "activity_page_number": 1, 
    "title": "Resolv::getaddresses bug that can be abused to bypass security measures. ", 
    "is_member_of_team?": null, 
    "vote_count": 4, 
    "summaries": [
        {
            "category": "team", 
            "can_create?": false, 
            "can_view?": true
        }, 
        {
            "category": "researcher", 
            "can_create?": false, 
            "can_view?": true
        }
    ], 
    "structured_scope": null, 
    "allow_singular_disclosure_at": null, 
    "state": "Closed", 
    "cve_ids": [], 
    "readable_substate": "Informative", 
    "public": true, 
    "singular_disclosure_disabled": true, 
    "activities": [
        {
            "automated_response": false, 
            "created_at": "2017-11-06T20:15:00.680Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-06T20:15:00.680Z", 
            "actor": {
                "username": "reed", 
                "url": "/reed", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/132/5781ea1c43c5c7680dd145226b86348a8d6ed085_medium.jpg?1394062279"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "cve_ids": [
                "CVE-2017-0904"
            ], 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::CveIdAdded", 
            "id": 2138101, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-07T04:18:13.168Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-07T04:18:13.168Z", 
            "actor": {
                "username": "shyouhei", 
                "url": "/shyouhei", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "Hello, thank you for the report.  Our team members are looking at it.", 
            "markdown_message": "<p>Hello, thank you for the report.  Our team members are looking at it.</p>\n", 
            "type": "Activities::Comment", 
            "id": 2139111, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-07T06:28:16.274Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-07T06:28:16.274Z", 
            "actor": {
                "username": "tanaka_akr", 
                "url": "/tanaka_akr", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::ExternalUserJoined", 
            "id": 2139227, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-07T07:32:23.648Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-07T07:32:23.648Z", 
            "actor": {
                "username": "tanaka_akr", 
                "url": "/tanaka_akr", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "resolv.rb can behave differently with OS's resolver.\nThis is documented behavior.\nhttps://docs.ruby-lang.org/en/2.4.0/Resolv.html describes that\nresolv.rb doesn't support NIS (of Solaris).\nI.e. some name not resolved with resolv.rb may be resolved in OS's resolver.\n\nUncommon IP address format can be considered as an example of above.\n\nAlthough it is possible to support such uncommon IP addresses in resolv.rb\nbut it is too difficult to support NIS.\nWe can not match the behaviors of resolv.rb and OS's resolver.\n\nThe right way to check an address is using OS's resolver instead of resolv.rb\nif the address is resolved by OS's resolver.\nFor example, Addrinfo.getaddrinfo of socket library can be used:\n\n```\n% ruby -rsocket -e '\nas = Addrinfo.getaddrinfo(\"192.168.0.1\", nil)\np as\np as.map {|a| a.ipv4_private? }\n'\n[#<Addrinfo: 192.168.0.1 TCP>, #<Addrinfo: 192.168.0.1 UDP>, #<Addrinfo: 192.168.0.1 SOCK_RAW>]\n[true, true, true]\n```\n\nIf you need CIDR or netmask, ipaddr library helps.\n", 
            "markdown_message": "<p>resolv.rb can behave differently with OS&#39;s resolver.<br>\nThis is documented behavior.<br>\n<a title=\"https://docs.ruby-lang.org/en/2.4.0/Resolv.html\" href=\"/redirect?signature=0bcd973e61f92edf360e216f735819565af9dced&amp;url=https%3A%2F%2Fdocs.ruby-lang.org%2Fen%2F2.4.0%2FResolv.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://docs.ruby-lang.org/en/2.4.0/Resolv.html</span><i class=\"icon-external-link\"></i></a> describes that<br>\nresolv.rb doesn&#39;t support NIS (of Solaris).<br>\nI.e. some name not resolved with resolv.rb may be resolved in OS&#39;s resolver.</p>\n\n<p>Uncommon IP address format can be considered as an example of above.</p>\n\n<p>Although it is possible to support such uncommon IP addresses in resolv.rb<br>\nbut it is too difficult to support NIS.<br>\nWe can not match the behaviors of resolv.rb and OS&#39;s resolver.</p>\n\n<p>The right way to check an address is using OS&#39;s resolver instead of resolv.rb<br>\nif the address is resolved by OS&#39;s resolver.<br>\nFor example, Addrinfo.getaddrinfo of socket library can be used:</p>\n<pre class=\"highlight plaintext\"><code>% ruby -rsocket -e &#39;\nas = Addrinfo.getaddrinfo(&quot;192.168.0.1&quot;, nil)\np as\np as.map {|a| a.ipv4_private? }\n&#39;\n[#&lt;Addrinfo: 192.168.0.1 TCP&gt;, #&lt;Addrinfo: 192.168.0.1 UDP&gt;, #&lt;Addrinfo: 192.168.0.1 SOCK_RAW&gt;]\n[true, true, true]\n</code></pre>\n<p>If you need CIDR or netmask, ipaddr library helps.</p>\n", 
            "type": "Activities::Comment", 
            "id": 2139298, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-07T09:57:59.475Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-07T09:57:59.475Z", 
            "actor": {
                "username": "edoverflow", 
                "url": "/edoverflow", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/116/374/95f9ffa246b2d43ca4f14a95d8815f429544fe54_medium.png?1527882436"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "Hi @tanaka_akr,\n\nThank you for the prompt response. I would like to reiterate the importance of this issue by reminding you that I have discovered numerous cases where this class was being used leading to a security vulnerability. In my opinion, those two little bullet points do not suffice and I would recommend reviewing your documentation again and coming up with a better solution to emphasize the fact that `Resolv` can have unpredictable behaviour and should not be used for security measures such as SSRF filters.\n\nThe Python documentation does this very well by having a large red panel that clearly instructs the developer on what not to use that specific library for. An example warning can be seen here: https://docs.python.org/3/library/random.html.", 
            "markdown_message": "<p>Hi <a href=\"/tanaka_akr\">@tanaka_akr</a>,</p>\n\n<p>Thank you for the prompt response. I would like to reiterate the importance of this issue by reminding you that I have discovered numerous cases where this class was being used leading to a security vulnerability. In my opinion, those two little bullet points do not suffice and I would recommend reviewing your documentation again and coming up with a better solution to emphasize the fact that <code>Resolv</code> can have unpredictable behaviour and should not be used for security measures such as SSRF filters.</p>\n\n<p>The Python documentation does this very well by having a large red panel that clearly instructs the developer on what not to use that specific library for. An example warning can be seen here: <a title=\"https://docs.python.org/3/library/random.html\" href=\"/redirect?signature=90cb05cf0246f4cb80ffeee3d2f4444f6517f0fe&amp;url=https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Frandom.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://docs.python.org/3/library/random.html</span><i class=\"icon-external-link\"></i></a>.</p>\n", 
            "type": "Activities::Comment", 
            "id": 2139723, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-08T01:54:56.589Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-08T01:54:56.589Z", 
            "actor": {
                "username": "shyouhei", 
                "url": "/shyouhei", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "True. We need doc improvements.", 
            "markdown_message": "<p>True. We need doc improvements.</p>\n", 
            "type": "Activities::Comment", 
            "id": 2141896, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-09T01:33:39.055Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-09T01:33:39.055Z", 
            "actor": {
                "username": "tanaka_akr", 
                "url": "/tanaka_akr", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "The document is not so updated since Ruby 1.8 era.\nI agree that it should be updated including emphasizing difference to OS's resolver.", 
            "markdown_message": "<p>The document is not so updated since Ruby 1.8 era.<br>\nI agree that it should be updated including emphasizing difference to OS&#39;s resolver.</p>\n", 
            "type": "Activities::Comment", 
            "id": 2144783, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-09T18:41:26.562Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-09T18:41:26.562Z", 
            "actor": {
                "username": "edoverflow", 
                "url": "/edoverflow", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/116/374/95f9ffa246b2d43ca4f14a95d8815f429544fe54_medium.png?1527882436"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "I have published a write-up on this issue in order to inform developers on the consequences of using `Resolv::getaddresses` for security measures such as SSRF filters: https://edoverflow.com/2017/ruby-resolv-bug/. If there is anyway that I can possibly help with improving Ruby's documentation, please let me know.", 
            "markdown_message": "<p>I have published a write-up on this issue in order to inform developers on the consequences of using <code>Resolv::getaddresses</code> for security measures such as SSRF filters: <a title=\"https://edoverflow.com/2017/ruby-resolv-bug/\" href=\"/redirect?signature=0842202ab0c39fea5a1f3a162725d485e221d4ea&amp;url=https%3A%2F%2Fedoverflow.com%2F2017%2Fruby-resolv-bug%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://edoverflow.com/2017/ruby-resolv-bug/</span><i class=\"icon-external-link\"></i></a>. If there is anyway that I can possibly help with improving Ruby&#39;s documentation, please let me know.</p>\n", 
            "type": "Activities::Comment", 
            "id": 2147025, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-10T08:39:25.907Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-10T08:39:25.907Z", 
            "actor": {
                "username": "hsbt", 
                "url": "/hsbt", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/051/808/a7d4f1d7b3f5de51caf190236c85c70986dc15ff_medium.jpg?1486003618"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "Thanks to your report. We decide to not handle this for security issue.", 
            "markdown_message": "<p>Thanks to your report. We decide to not handle this for security issue.</p>\n", 
            "type": "Activities::BugInformative", 
            "id": 2148413, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-10T09:34:10.456Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-10T09:34:10.456Z", 
            "actor": {
                "username": "edoverflow", 
                "url": "/edoverflow", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/116/374/95f9ffa246b2d43ca4f14a95d8815f429544fe54_medium.png?1527882436"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "first_to_agree": true, 
            "message": "Thank you very much for the extremely informative response, @hsbt. Now I know how to deal with such issues in future.", 
            "markdown_message": "<p>Thank you very much for the extremely informative response, <a href=\"/hsbt\">@hsbt</a>. Now I know how to deal with such issues in future.</p>\n", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 2148510, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-10T20:34:02.287Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-10T20:34:02.287Z", 
            "actor": {
                "username": "edoverflow", 
                "url": "/edoverflow", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/116/374/95f9ffa246b2d43ca4f14a95d8815f429544fe54_medium.png?1527882436"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "I would like to apologise for my brash comment earlier. Putting so much time and effort into this issue and not even getting a response explaining your final decision is very frustrating. In future, I will be more careful as to how I deal with this frustration. I would also suggest you communicate clearly how you came to your final decision to security researchers. Making your thought process clear helps us learn and improve. Nevertheless, my comment was uncalled for and I hope it did not offend anyone.\n\nI hope you have a wonderful weekend.", 
            "markdown_message": "<p>I would like to apologise for my brash comment earlier. Putting so much time and effort into this issue and not even getting a response explaining your final decision is very frustrating. In future, I will be more careful as to how I deal with this frustration. I would also suggest you communicate clearly how you came to your final decision to security researchers. Making your thought process clear helps us learn and improve. Nevertheless, my comment was uncalled for and I hope it did not offend anyone.</p>\n\n<p>I hope you have a wonderful weekend.</p>\n", 
            "type": "Activities::Comment", 
            "id": 2150182, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-11-11T03:04:56.165Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-11-11T03:04:56.165Z", 
            "actor": {
                "username": "reed", 
                "url": "/reed", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/003/132/5781ea1c43c5c7680dd145226b86348a8d6ed085_medium.jpg?1394062279"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "cve_ids": [], 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::CveIdAdded", 
            "id": 2150779, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2018-02-23T07:19:19.728Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2018-02-23T07:19:19.728Z", 
            "actor": {
                "username": "hsbt", 
                "url": "/hsbt", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/051/808/a7d4f1d7b3f5de51caf190236c85c70986dc15ff_medium.jpg?1486003618"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 2424149, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2018-02-23T07:19:19.801Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2018-02-23T07:19:19.801Z", 
            "actor": {
                "username": "hsbt", 
                "url": "/hsbt", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/051/808/a7d4f1d7b3f5de51caf190236c85c70986dc15ff_medium.jpg?1486003618"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ruby", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::ReportBecamePublic", 
            "id": 2424150, 
            "genius_execution_id": null
        }
    ], 
    "in_validation?": false, 
    "is_participant": false, 
    "reporter": {
        "username": "edoverflow", 
        "hacker_mediation": false, 
        "hackerone_triager": false, 
        "disabled": false, 
        "url": "/edoverflow", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/116/374/2e86e29173a7b27dc4e4c35ecaef804781110b9f_small.png?1527882436"
        }, 
        "is_me?": false
    }, 
    "weakness": {
        "id": 57, 
        "name": "Violation of Secure Design Principles"
    }, 
    "is_external_bug": false, 
    "visibility": "full", 
    "disclosed_at": "2018-02-23T07:19:19.776Z", 
    "stage": 4, 
    "url": "https://hackerone.com/reports/287835", 
    "created_at": "2017-11-06T19:44:58.500Z", 
    "original_report_url": null, 
    "vulnerability_information_html": "<h1 id=\"description\">Description</h1>\n\n<p><code>Resolv::getaddresses</code> is OS-dependent, therefore by playing around with different IP formats one can return blank values. This bug can be abused to bypass exclusion lists often used to protect against SSRF.</p>\n\n<table>\n<thead>\n<tr>\n<th>\ud83d\udcbb Machine 1</th>\n<th>\ud83d\udcbb Machine 2</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ruby 2.3.3p222 (2016-11-21) [x86_64-linux-gnu]</td>\n<td>ruby 2.3.1p112 (2016-04-26) [x86_64-linux-gnu]</td>\n</tr>\n</tbody>\n</table>\n\n<p>\ud83d\udcbb Machine 1</p>\n<pre class=\"highlight plaintext\"><code>irb(main):002:0&gt; Resolv.getaddresses(&quot;127.0.0.1&quot;)\n=&gt; [&quot;127.0.0.1&quot;]\nirb(main):003:0&gt; Resolv.getaddresses(&quot;localhost&quot;)\n=&gt; [&quot;127.0.0.1&quot;]\nirb(main):004:0&gt; Resolv.getaddresses(&quot;127.000.000.1&quot;)\n=&gt; [&quot;127.0.0.1&quot;]\n</code></pre>\n<p>\ud83d\udcbb Machine 2</p>\n<pre class=\"highlight plaintext\"><code>irb(main):008:0&gt; Resolv.getaddresses(&quot;127.0.0.1&quot;)\n=&gt; [&quot;127.0.0.1&quot;]\nirb(main):009:0&gt; Resolv.getaddresses(&quot;localhost&quot;)\n=&gt; [&quot;127.0.0.1&quot;]\nirb(main):010:0&gt; Resolv.getaddresses(&quot;127.000.000.1&quot;)\n=&gt; []\n</code></pre>\n<h1 id=\"proof-of-concept\">Proof of concept</h1>\n<pre class=\"highlight plaintext\"><code>irb(main):001:0&gt; require &#39;resolv&#39;\n=&gt; true\nirb(main):002:0&gt; uri = &quot;0x7f.1&quot;\n=&gt; &quot;0x7f.1&quot;\nirb(main):003:0&gt; server_ips = Resolv.getaddresses(uri)\n=&gt; [] # The bug!\nirb(main):004:0&gt; blocked_ips = [&quot;127.0.0.1&quot;, &quot;::1&quot;, &quot;0.0.0.0&quot;]\n=&gt; [&quot;127.0.0.1&quot;, &quot;::1&quot;, &quot;0.0.0.0&quot;]\nirb(main):005:0&gt; (blocked_ips &amp; server_ips).any?\n=&gt; false # Bypass\n</code></pre>\n<h1 id=\"mitigation\">Mitigation</h1>\n\n<p>Currently I have been suggesting that the affected vendors stay away from <code>Resolv::getaddresses</code> altogether and use the <code>Socket</code> class.</p>\n<pre class=\"highlight plaintext\"><code>irb(main):002:0&gt; Resolv.getaddresses(&quot;127.1&quot;)\n=&gt; []\nirb(main):003:0&gt; Socket.getaddrinfo(&quot;127.1&quot;, nil).sample[3]\n=&gt; &quot;127.0.0.1&quot;\n</code></pre>\n<h1 id=\"affected-vendors-and-gems\">Affected vendors and gems</h1>\n\n<p>By abusing this bug I was able to bypass GitLab, HackerOne and <a href=\"/redirect?signature=80252f71b6ef59c5c5c0d2d4049c5eb5a062a2cf&amp;url=https%3A%2F%2Fgithub.com%2Fjtdowney%2Fprivate_address_check%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>private_address_check</span><i class=\"icon-external-link\"></i></a>&#39;s <a href=\"/redirect?signature=e49ed38db36b9adea1f5971fec7d19cfd1f381f0&amp;url=https%3A%2F%2Fwww.owasp.org%2Findex.php%2FServer_Side_Request_Forgery\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>SSRF</span><i class=\"icon-external-link\"></i></a> filters.</p>\n\n<p>The <code>private_address_check</code> gem, for instance, relied on <code>Resolv::getaddresses</code> in <code>lib/private_address_check.rb</code>:</p>\n<pre class=\"highlight ruby\"><code><span class=\"k\">def</span> <span class=\"nf\">resolves_to_private_address?</span><span class=\"p\">(</span><span class=\"n\">hostname</span><span class=\"p\">)</span>\n    <span class=\"n\">ips</span> <span class=\"o\">=</span> <span class=\"no\">Resolv</span><span class=\"p\">.</span><span class=\"nf\">getaddresses</span><span class=\"p\">(</span><span class=\"n\">hostname</span><span class=\"p\">)</span>\n    <span class=\"n\">ips</span><span class=\"p\">.</span><span class=\"nf\">any?</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">ip</span><span class=\"o\">|</span> \n      <span class=\"n\">private_address?</span><span class=\"p\">(</span><span class=\"n\">ip</span><span class=\"p\">)</span>\n    <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre><pre class=\"highlight plaintext\"><code>irb(main):001:0&gt; require &#39;private_address_check&#39;\n=&gt; true\nirb(main):002:0&gt; PrivateAddressCheck.resolves_to_private_address?(&quot;127.1&quot;)\n=&gt; false # Bypass\n</code></pre>\n<p>The author of this gem has provided a <a href=\"/redirect?signature=24fea4362be978a9fd9cc93c22fd599d6543767d&amp;url=https%3A%2F%2Fgithub.com%2Fjtdowney%2Fprivate_address_check%2Fcommit%2F58a0d7fe31de339c0117160567a5b33ad82b46af\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>patch</span><i class=\"icon-external-link\"></i></a> for this issue and I can confirm that I am unable to bypass the fix.</p>\n\n<p>GitLab and HackerOne have also been notified and plan on releasing a fix this week.</p>\n", 
    "vulnerability_information": "# Description\n\n`Resolv::getaddresses` is OS-dependent, therefore by playing around with different IP formats one can return blank values. This bug can be abused to bypass exclusion lists often used to protect against SSRF.\n\n| \ud83d\udcbb Machine 1 | \t\ud83d\udcbb Machine 2 | \n|--------------|---------------| \n| ruby 2.3.3p222 (2016-11-21) [x86_64-linux-gnu] | ruby 2.3.1p112 (2016-04-26) [x86_64-linux-gnu] |\n\n\ud83d\udcbb Machine 1\n\n```\nirb(main):002:0> Resolv.getaddresses(\"127.0.0.1\")\n=> [\"127.0.0.1\"]\nirb(main):003:0> Resolv.getaddresses(\"localhost\")\n=> [\"127.0.0.1\"]\nirb(main):004:0> Resolv.getaddresses(\"127.000.000.1\")\n=> [\"127.0.0.1\"]\n```\n\ud83d\udcbb Machine 2\n\n```\nirb(main):008:0> Resolv.getaddresses(\"127.0.0.1\")\n=> [\"127.0.0.1\"]\nirb(main):009:0> Resolv.getaddresses(\"localhost\")\n=> [\"127.0.0.1\"]\nirb(main):010:0> Resolv.getaddresses(\"127.000.000.1\")\n=> []\n```\n\n# Proof of concept\n\n```\nirb(main):001:0> require 'resolv'\n=> true\nirb(main):002:0> uri = \"0x7f.1\"\n=> \"0x7f.1\"\nirb(main):003:0> server_ips = Resolv.getaddresses(uri)\n=> [] # The bug!\nirb(main):004:0> blocked_ips = [\"127.0.0.1\", \"::1\", \"0.0.0.0\"]\n=> [\"127.0.0.1\", \"::1\", \"0.0.0.0\"]\nirb(main):005:0> (blocked_ips & server_ips).any?\n=> false # Bypass\n```\n\n# Mitigation\n\nCurrently I have been suggesting that the affected vendors stay away from `Resolv::getaddresses` altogether and use the `Socket` class.\n\n```\nirb(main):002:0> Resolv.getaddresses(\"127.1\")\n=> []\nirb(main):003:0> Socket.getaddrinfo(\"127.1\", nil).sample[3]\n=> \"127.0.0.1\"\n```\n\n# Affected vendors and gems\n\nBy abusing this bug I was able to bypass GitLab, HackerOne and [private_address_check](https://github.com/jtdowney/private_address_check/)'s [SSRF](https://www.owasp.org/index.php/Server_Side_Request_Forgery) filters.\n\nThe `private_address_check` gem, for instance, relied on `Resolv::getaddresses` in `lib/private_address_check.rb`:\n\n```ruby\ndef resolves_to_private_address?(hostname)\n    ips = Resolv.getaddresses(hostname)\n    ips.any? do |ip| \n      private_address?(ip)\n    end\nend\n```\n\n```\nirb(main):001:0> require 'private_address_check'\n=> true\nirb(main):002:0> PrivateAddressCheck.resolves_to_private_address?(\"127.1\")\n=> false # Bypass\n```\n\nThe author of this gem has provided a [patch](https://github.com/jtdowney/private_address_check/commit/58a0d7fe31de339c0117160567a5b33ad82b46af) for this issue and I can confirm that I am unable to bypass the fix.\n\nGitLab and HackerOne have also been notified and plan on releasing a fix this week.\n\n", 
    "team_private?": false, 
    "team": {
        "profile": {
            "website": "https://www.ruby-lang.org", 
            "about": "A Programmer's Best Friend", 
            "twitter_handle": "", 
            "name": "Ruby"
        }, 
        "handle": "ruby", 
        "url": "https://hackerone.com/ruby", 
        "state": "public_mode", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/007/724/36e273f967b252ae8b4051d09ffc08f7de16d7d5_small.png?1449271894", 
            "medium": "https://profile-photos.hackerone-user-content.com/000/007/724/0c1556227f51c9b2b13ada11ccd2fb02cc9fa257_medium.png?1449271894"
        }, 
        "awards_miles": false, 
        "permissions": [], 
        "id": 7724, 
        "default_currency": "usd"
    }, 
    "is_published": false
}