{
    "abilities": {
        "can_manage_common_responses?": false, 
        "can_manage_collaborators?": false, 
        "can_reopen?": false, 
        "can_ban_researcher?": false, 
        "can_create_severity?": false, 
        "can_assign_to_h1_triage?": false, 
        "can_agree_on_going_public?": false, 
        "assignable_team_member_groups": [], 
        "can_view_credential_account_details?": false, 
        "can_export?": false, 
        "can_create_retest?": false, 
        "can_assign_to_user?": false, 
        "can_use_common_responses?": false, 
        "can_hide_timeline?": false, 
        "can_be_manually_disclosed?": false, 
        "assignable_team_members": [], 
        "can_clone?": false, 
        "can_be_publicly_disclosed?": false, 
        "can_close_comments?": false, 
        "can_view_bounty_weights?": false, 
        "can_suggest_bounty_amount?": false, 
        "can_cancel_disclosure_request?": false, 
        "can_redact?": false, 
        "can_change_structured_scope?": false, 
        "can_post_internal_comments?": false, 
        "can_change_state?": false, 
        "can_change_weakness?": false, 
        "can_add_comment?": false, 
        "can_reassign_to_team?": false, 
        "can_change_title?": false, 
        "can_award_bounty?": false, 
        "can_award_swag?": false, 
        "can_close?": false, 
        "can_manage?": false
    }, 
    "comments_closed?": false, 
    "substate": "resolved", 
    "bug_reporter_agreed_on_going_public_at": "2017-04-20T08:57:12.318Z", 
    "voters": [
        "eveeez", 
        "silv3rpoision", 
        "osama123", 
        "rbcafe", 
        "spetr0x", 
        "madarkitekt"
    ], 
    "facebook_team?": false, 
    "has_bounty?": false, 
    "rejected_anc_report_that_can_be_sent_back_to_anc_triagers?": false, 
    "original_report_id": null, 
    "id": 182487, 
    "can_view_team": true, 
    "team_member_agreed_on_going_public_at": "2017-04-20T16:50:53.850Z", 
    "vulnerability_information": "The authentication token `authenticity_token` used in the POST request for deleting an account can be bypassed, by replacing the same with a token generated for deleting another account. This way, a self submitting form can be used to delete another user's account as long as he/she's logged in.\n\n**Steps to Reproduce:**\n1. Create an account and copy the POST request for deleting it.\n\n```\nPOST /users HTTP/1.1\nHost: gitlab.com\nReferer: https://gitlab.com/profile/account\nCookie: _gitlab_session=1staccount_cookie;\nContent-Type: application/x-www-form-urlencoded\n\n_method=delete&authenticity_token=auth_1staccount\n```\n2. Create another account and send the above request after replacing the `_gitlab_session` cookie with that of the new one.  The `authenticity_token` remains the same as that of the first account.\n3. Send the request and the new account gets deleted.\n\nI have not explored all possible scenarios like different IP addresses or something. But the above situation, where I used accounts created using emails from a temporary email address generator, was reproduced multiple times.", 
    "activity_page_count": 1, 
    "severity": {
        "rating": "low", 
        "author_type": "Team"
    }, 
    "title": "CSRF Token Bypass in Account Deletion", 
    "is_member_of_team?": null, 
    "vote_count": 6, 
    "summaries": [
        {
            "category": "team", 
            "can_create?": false, 
            "can_view?": true
        }, 
        {
            "category": "researcher", 
            "can_create?": false, 
            "can_view?": true
        }
    ], 
    "structured_scope": null, 
    "allow_singular_disclosure_at": "2017-05-20T08:57:12.368Z", 
    "state": "Closed", 
    "cve_ids": [], 
    "activity_page_number": 1, 
    "readable_substate": "Resolved", 
    "public": true, 
    "singular_disclosure_disabled": false, 
    "activities": [
        {
            "automated_response": false, 
            "created_at": "2016-11-16T12:07:02.536Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T12:07:02.536Z", 
            "actor": {
                "username": "rspeicher", 
                "url": "/rspeicher", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/070/800/71ae869ab45b05d47a2118c159952ebe3ceca17e_medium.jpg?1519748506"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "Thanks for the report @7h0r4pp4n. We'll investigate and get back to you shortly.", 
            "markdown_message": "<p>Thanks for the report <a href=\"/7h0r4pp4n\">@7h0r4pp4n</a>. We&#39;ll investigate and get back to you shortly.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1302226, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-11-16T12:48:26.676Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T12:48:26.676Z", 
            "actor": {
                "username": "rspeicher", 
                "url": "/rspeicher", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/070/800/71ae869ab45b05d47a2118c159952ebe3ceca17e_medium.jpg?1519748506"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "@7h0r4pp4n I'm having trouble reproducing this as you've described. Here's where I am:\n\n1. Create two users, **attacker** and **victim**\n1. Somehow, **attacker** knows **victim**'s secure session key. In this case it's `b9dbae76ceaed44954d57d0d505eca00`\n1. As **attacker**, initiate an account deletion, which looks something like this:\n\n    ```\n    POST /users HTTP/1.1\n    Host: localhost:3000\n    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:39.0) Gecko/20100101 Firefox/39.0\n    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n    Accept-Language: en-US,en;q=0.5\n    Accept-Encoding: gzip, deflate\n    Cookie: _gitlab_session=568a0c6e266c55938182945af357dda4\n    Connection: close\n    Content-Type: application/x-www-form-urlencoded\n    Content-Length: 132\n\n    _method=delete&authenticity_token=a57BV%2BO0KhEtRe%2FS9W2%2FIBqZj2bWA8jbfE38VlA4pzN1wBKov8F4UV7gYerBaLOumjqpnIoC2Dsx1jufaAZGsg%3D%3D\n    ```\n\n1. Intercept that request, modifying `_gitlab_session` with the value of **victim**'s secure session cookie\n1. Forward the request, which now looks like this:\n\n    ```\n    POST /users HTTP/1.1\n    Host: localhost:3000\n    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:39.0) Gecko/20100101 Firefox/39.0\n    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n    Accept-Language: en-US,en;q=0.5\n    Accept-Encoding: gzip, deflate\n    Cookie: _gitlab_session=b9dbae76ceaed44954d57d0d505eca00\n    Connection: close\n    Content-Type: application/x-www-form-urlencoded\n    Content-Length: 132\n\n    _method=delete&authenticity_token=a57BV%2BO0KhEtRe%2FS9W2%2FIBqZj2bWA8jbfE38VlA4pzN1wBKov8F4UV7gYerBaLOumjqpnIoC2Dsx1jufaAZGsg%3D%3D\n    ```\n\n1. At this point we expect the **victim** account to be deleted. Instead, I get back an `ActionController::InvalidAuthenticityToken` error\n\nWhat am I misunderstanding?\n\nThanks!", 
            "markdown_message": "<p><a href=\"/7h0r4pp4n\">@7h0r4pp4n</a> I&#39;m having trouble reproducing this as you&#39;ve described. Here&#39;s where I am:</p>\n\n<ol>\n<li>Create two users, <strong>attacker</strong> and <strong>victim</strong>\n</li>\n<li>Somehow, <strong>attacker</strong> knows <strong>victim</strong>&#39;s secure session key. In this case it&#39;s <code>b9dbae76ceaed44954d57d0d505eca00</code>\n</li>\n<li>\n<p>As <strong>attacker</strong>, initiate an account deletion, which looks something like this:</p>\n<pre class=\"highlight plaintext\"><code>POST /users HTTP/1.1\nHost: localhost:3000\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:39.0) Gecko/20100101 Firefox/39.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nCookie: _gitlab_session=568a0c6e266c55938182945af357dda4\nConnection: close\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 132\n\n_method=delete&amp;authenticity_token=a57BV%2BO0KhEtRe%2FS9W2%2FIBqZj2bWA8jbfE38VlA4pzN1wBKov8F4UV7gYerBaLOumjqpnIoC2Dsx1jufaAZGsg%3D%3D\n</code></pre>\n</li>\n<li><p>Intercept that request, modifying <code>_gitlab_session</code> with the value of <strong>victim</strong>&#39;s secure session cookie</p></li>\n<li>\n<p>Forward the request, which now looks like this:</p>\n<pre class=\"highlight plaintext\"><code>POST /users HTTP/1.1\nHost: localhost:3000\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:39.0) Gecko/20100101 Firefox/39.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nCookie: _gitlab_session=b9dbae76ceaed44954d57d0d505eca00\nConnection: close\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 132\n\n_method=delete&amp;authenticity_token=a57BV%2BO0KhEtRe%2FS9W2%2FIBqZj2bWA8jbfE38VlA4pzN1wBKov8F4UV7gYerBaLOumjqpnIoC2Dsx1jufaAZGsg%3D%3D\n</code></pre>\n</li>\n<li><p>At this point we expect the <strong>victim</strong> account to be deleted. Instead, I get back an <code>ActionController::InvalidAuthenticityToken</code> error</p></li>\n</ol>\n\n<p>What am I misunderstanding?</p>\n\n<p>Thanks!</p>\n", 
            "type": "Activities::Comment", 
            "id": 1302358, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-11-16T14:56:48.754Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T14:56:48.754Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "I tried a different route: \n\nHave two sessions open and have both browse to delete their accounts.  \nSwap authenticity_tokens between them.\nNeither account deletion works.\n", 
            "markdown_message": "<p>I tried a different route: </p>\n\n<p>Have two sessions open and have both browse to delete their accounts.<br><br>\nSwap authenticity_tokens between them.<br>\nNeither account deletion works.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1302511, 
            "genius_execution_id": null
        }, 
        {
            "attachments": [
                {
                    "url": "https://hackerone-us-west-2-production-attachments.s3-us-west-2.amazonaws.com/000/135/071/99084bdf023ebdc447fd46364f1bccb6918cdb11/record.mkv?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQVHWOGSNR%2F20181206%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20181206T224019Z&X-Amz-Expires=3600&X-Amz-Security-Token=FQoGZXIvYXdzEBAaDNyA%2BB7EVws6w20xiyK3AzcCTkx0GnZzVQ6TwXkp44%2Ff6M7%2FsO19EHzsTJXAjGqGadXUwBewmY%2FA3saLwd8Xt%2FLbqrBXnPVBmQqsNFRuZECDCBvLhSnrZ0V6VgN9XIGcsvjdqc1keY1F5jqudqF9DVlIY8TMvC8HZK%2B7Q1nt4NsrhczyPwsxABuLuXRQ9jz342kfr6jcg4V0RDeoTmkF41Ft6RtUq0hmoAqdCx1%2Fz70xB4R7l69zShPP7HLfYHPPTt8XR1Db%2BqWNJQckpie0NnlFKA6ZUTMDBoFCJMNlSMrC8fe4WfzeCwJzHJRBg8PuHWSmO%2BotEruefTqBjLBoXXi34gvMNLGz%2F2UMbXN0CJxslsSVQ1hVUGyCtMe0w9EsQpL39cO7khz0GcmiaRxiDS26USPGfQCc9lffeZFTxh4so1l02filHtFdYLVvAvgjiOYt2Mz5u6lBhccM0iI2WWXmcjR%2FS%2BkxYva3%2BrEYrii1%2BMbFzOhDKAxYvafuSoo%2BiLMqIErMru4lSMvT6Hdl0F7q6ar9ursg2xy2ld%2BSsM1Ffwx%2FIlTxlx%2Fk5K%2BKS4mgc5N3QgLYcjLnqKIjMyLCEr%2FVbmVxbtUo%2B7qm4AU%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=b4efa00c3368e1dd6a1d3ad939e93c46749d865b6e0864b0e7abe804f56289b8", 
                    "type": "video/x-matroska", 
                    "id": 135071, 
                    "filename": "record.mkv"
                }
            ], 
            "automated_response": false, 
            "created_at": "2016-11-16T16:08:23.300Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T16:08:23.300Z", 
            "actor": {
                "username": "7h0r4pp4n", 
                "url": "/7h0r4pp4n", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/049/473/f4f0d35495a2193b7f940e5f4f631b6cf135a0e8_medium.jpg?1461706353"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "The attached video shows the process that I followed. Kindly go through the same.", 
            "markdown_message": "<p>The attached video shows the process that I followed. Kindly go through the same.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1302633, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-11-16T17:23:31.032Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T17:23:31.032Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "@7h0r4pp4n Try clearing your cookies before creating the second account. AFAICT this is a bug with not deleting the old session ID when a user deletes an account and therefore Rails somehow ends up with two valid CSRF authentication_token values for one account. It shouldn't work across client IPs or browser sessions.", 
            "markdown_message": "<p><a href=\"/7h0r4pp4n\">@7h0r4pp4n</a> Try clearing your cookies before creating the second account. AFAICT this is a bug with not deleting the old session ID when a user deletes an account and therefore Rails somehow ends up with two valid CSRF authentication_token values for one account. It shouldn&#39;t work across client IPs or browser sessions.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1302750, 
            "genius_execution_id": null
        }, 
        {
            "attachments": [
                {
                    "url": "https://hackerone-us-west-2-production-attachments.s3-us-west-2.amazonaws.com/000/135/101/a7f0e36cec1291db7b539e58d70d1e5c43742272/screenshot2.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQVHWOGSNR%2F20181206%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20181206T224019Z&X-Amz-Expires=3600&X-Amz-Security-Token=FQoGZXIvYXdzEBAaDNyA%2BB7EVws6w20xiyK3AzcCTkx0GnZzVQ6TwXkp44%2Ff6M7%2FsO19EHzsTJXAjGqGadXUwBewmY%2FA3saLwd8Xt%2FLbqrBXnPVBmQqsNFRuZECDCBvLhSnrZ0V6VgN9XIGcsvjdqc1keY1F5jqudqF9DVlIY8TMvC8HZK%2B7Q1nt4NsrhczyPwsxABuLuXRQ9jz342kfr6jcg4V0RDeoTmkF41Ft6RtUq0hmoAqdCx1%2Fz70xB4R7l69zShPP7HLfYHPPTt8XR1Db%2BqWNJQckpie0NnlFKA6ZUTMDBoFCJMNlSMrC8fe4WfzeCwJzHJRBg8PuHWSmO%2BotEruefTqBjLBoXXi34gvMNLGz%2F2UMbXN0CJxslsSVQ1hVUGyCtMe0w9EsQpL39cO7khz0GcmiaRxiDS26USPGfQCc9lffeZFTxh4so1l02filHtFdYLVvAvgjiOYt2Mz5u6lBhccM0iI2WWXmcjR%2FS%2BkxYva3%2BrEYrii1%2BMbFzOhDKAxYvafuSoo%2BiLMqIErMru4lSMvT6Hdl0F7q6ar9ursg2xy2ld%2BSsM1Ffwx%2FIlTxlx%2Fk5K%2BKS4mgc5N3QgLYcjLnqKIjMyLCEr%2FVbmVxbtUo%2B7qm4AU%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=d57af5191c902d6740355c539e6c07a3f29e72026dabf7c9b8aa52261fe17ccf", 
                    "type": "image/png", 
                    "id": 135101, 
                    "filename": "screenshot2.png"
                }
            ], 
            "automated_response": false, 
            "created_at": "2016-11-16T18:05:48.832Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T18:06:55.266Z", 
            "actor": {
                "username": "7h0r4pp4n", 
                "url": "/7h0r4pp4n", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/049/473/f4f0d35495a2193b7f940e5f4f631b6cf135a0e8_medium.jpg?1461706353"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "The request to delete the account was not initiated from the browser. The request was directly sent from the network proxy I was using. \n\nCurrently I'm unable to access gitlab.com anymore. Is my IP (103.10.24.194) blocked for creating and deleting multiple accounts or something?\nOnce it's back up, I'll give it a shot without the proxy.", 
            "markdown_message": "<p>The request to delete the account was not initiated from the browser. The request was directly sent from the network proxy I was using. </p>\n\n<p>Currently I&#39;m unable to access gitlab.com anymore. Is my IP (103.10.24.194) blocked for creating and deleting multiple accounts or something?<br>\nOnce it&#39;s back up, I&#39;ll give it a shot without the proxy.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1302807, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-11-16T18:12:32.717Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T18:12:32.717Z", 
            "actor": {
                "username": "rspeicher", 
                "url": "/rspeicher", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/070/800/71ae869ab45b05d47a2118c159952ebe3ceca17e_medium.jpg?1519748506"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "@7h0r4pp4n No, we're just experiencing some (unrelated) downtime right now.\n\nThat said, we do list testing on gitlab.com as out of scope on our H1 program page and would appreciate if you tested locally in the future. \ud83d\ude00", 
            "markdown_message": "<p><a href=\"/7h0r4pp4n\">@7h0r4pp4n</a> No, we&#39;re just experiencing some (unrelated) downtime right now.</p>\n\n<p>That said, we do list testing on gitlab.com as out of scope on our H1 program page and would appreciate if you tested locally in the future. \ud83d\ude00</p>\n", 
            "type": "Activities::Comment", 
            "id": 1302819, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-11-16T18:26:31.348Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T18:26:31.348Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "@7h0r4pp4n It's not the request to delete the user that's associating the old authentication token with the new session, it's the initial login request for the second account.\n\nIf you create the first user and then delete them (storing the delete request in Burp), close your browser and re-open (or delete cookies and refresh the login page), this attack _shouldn't_ succeed. What I think is happening -- and I'm still trying to verify this -- is that when you register your second account you're doing so still using the old session ID associated with the first account. When you validate your email address the second time and are logged in a new session ID is created, but the old authentication token has already been declared valid for the new user. Burp can save all of these values but only GitLab can associate the auth token with a new session.\n\nAnother way to test this would be to run two web browsers, both using Burp as a proxy, and see if it still works. Use each browser for only one user. I've done this and it doesn't appear to work.", 
            "markdown_message": "<p><a href=\"/7h0r4pp4n\">@7h0r4pp4n</a> It&#39;s not the request to delete the user that&#39;s associating the old authentication token with the new session, it&#39;s the initial login request for the second account.</p>\n\n<p>If you create the first user and then delete them (storing the delete request in Burp), close your browser and re-open (or delete cookies and refresh the login page), this attack <u>shouldn&#39;t</u> succeed. What I think is happening -- and I&#39;m still trying to verify this -- is that when you register your second account you&#39;re doing so still using the old session ID associated with the first account. When you validate your email address the second time and are logged in a new session ID is created, but the old authentication token has already been declared valid for the new user. Burp can save all of these values but only GitLab can associate the auth token with a new session.</p>\n\n<p>Another way to test this would be to run two web browsers, both using Burp as a proxy, and see if it still works. Use each browser for only one user. I&#39;ve done this and it doesn&#39;t appear to work.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1302839, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-11-16T19:13:45.753Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T19:13:45.753Z", 
            "actor": {
                "username": "7h0r4pp4n", 
                "url": "/7h0r4pp4n", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/049/473/f4f0d35495a2193b7f940e5f4f631b6cf135a0e8_medium.jpg?1461706353"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "Aha. Now that works. I'm getting a 422 status code.\n\nWhy wasn't the `authenticity_token` invalidated though? And how did it even sustain after logging out?\nThe token was passed via the meta-tag and only ever used via POST tag right?\n\nAlso the scenario begs for attention to an even bigger issue!  Why was the old session id validated to a new account? I can easily leave a session id in a public system and wait for someone else to use that system to create a new account or login. Wouldn't this then validate the old session id (which I know) to someone's new account? Should I open this as a new issue?", 
            "markdown_message": "<p>Aha. Now that works. I&#39;m getting a 422 status code.</p>\n\n<p>Why wasn&#39;t the <code>authenticity_token</code> invalidated though? And how did it even sustain after logging out?<br>\nThe token was passed via the meta-tag and only ever used via POST tag right?</p>\n\n<p>Also the scenario begs for attention to an even bigger issue!  Why was the old session id validated to a new account? I can easily leave a session id in a public system and wait for someone else to use that system to create a new account or login. Wouldn&#39;t this then validate the old session id (which I know) to someone&#39;s new account? Should I open this as a new issue?</p>\n", 
            "type": "Activities::Comment", 
            "id": 1302938, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-11-16T20:18:52.093Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T20:19:24.767Z", 
            "actor": {
                "username": "7h0r4pp4n", 
                "url": "/7h0r4pp4n", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/049/473/f4f0d35495a2193b7f940e5f4f631b6cf135a0e8_medium.jpg?1461706353"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "**Ignore the previous comment**\nAha. Now that works. I'm getting a 422 status code.\n\nI am seeing three separate issues, all equally terrifying, which came together to cause the issue that we are facing.\n\n- The `authenticity_token` wasn't invalidated even though it was already used for deleting the first account.\n- The old session id wasn't invalidated by emptying the value of `_gitlab_session` cookie after the account was deleted.\n- Why was the **user submitted value** of `_gitlab_session` validated? That too, to a new account?\n\n I can easily leave a session id in a public system and wait for someone else to use that system to create a new account or login. Wouldn't this then validate the old session id (which I know) to someone's account? I mean, why was the old session id even allowed to be validated? Should I open this as a new issue?", 
            "markdown_message": "<p><strong>Ignore the previous comment</strong><br>\nAha. Now that works. I&#39;m getting a 422 status code.</p>\n\n<p>I am seeing three separate issues, all equally terrifying, which came together to cause the issue that we are facing.</p>\n\n<ul>\n<li>The <code>authenticity_token</code> wasn&#39;t invalidated even though it was already used for deleting the first account.</li>\n<li>The old session id wasn&#39;t invalidated by emptying the value of <code>_gitlab_session</code> cookie after the account was deleted.</li>\n<li>Why was the <strong>user submitted value</strong> of <code>_gitlab_session</code> validated? That too, to a new account?</li>\n</ul>\n\n<p>I can easily leave a session id in a public system and wait for someone else to use that system to create a new account or login. Wouldn&#39;t this then validate the old session id (which I know) to someone&#39;s account? I mean, why was the old session id even allowed to be validated? Should I open this as a new issue?</p>\n", 
            "type": "Activities::Comment", 
            "id": 1303050, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-11-16T21:03:13.150Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T21:03:13.150Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "A couple of important things:\n\nThe old session ID used for authenticating the user is invalidated in the sense that it can no longer be used to authenticate. It's not being removed from the browser's cookie store but it is no longer trusted in any sense by GitLab. It can't be used for session fixation because session IDs are always replaced on a login attempt.\n\nNow why the old authentication token used to prevent CSRF is still honored is a good question and one I'm still trying to answer. It would be next to impossible to leverage this to attack a user because they would have to be logged into the very browsing session the attacker used to create their own session ID and auth token in the first place and then they'd have to be tricked into\nnavigating to a malicious site that leverages the CSRF attack.\n\nBtw, these CSRF authentication tokens are intended to be valid for the length of a session so the fact that they are still valid beyond a single form POST isn't an issue. Them being valid after a new session ID is assigned is concerning, however.\n\nI'll keep researching it and see if I can find the root cause. Feel free to do the same! I'll keep you updated here.\n", 
            "markdown_message": "<p>A couple of important things:</p>\n\n<p>The old session ID used for authenticating the user is invalidated in the sense that it can no longer be used to authenticate. It&#39;s not being removed from the browser&#39;s cookie store but it is no longer trusted in any sense by GitLab. It can&#39;t be used for session fixation because session IDs are always replaced on a login attempt.</p>\n\n<p>Now why the old authentication token used to prevent CSRF is still honored is a good question and one I&#39;m still trying to answer. It would be next to impossible to leverage this to attack a user because they would have to be logged into the very browsing session the attacker used to create their own session ID and auth token in the first place and then they&#39;d have to be tricked into<br>\nnavigating to a malicious site that leverages the CSRF attack.</p>\n\n<p>Btw, these CSRF authentication tokens are intended to be valid for the length of a session so the fact that they are still valid beyond a single form POST isn&#39;t an issue. Them being valid after a new session ID is assigned is concerning, however.</p>\n\n<p>I&#39;ll keep researching it and see if I can find the root cause. Feel free to do the same! I&#39;ll keep you updated here.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1303145, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-11-16T21:30:00.226Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-11-16T21:33:49.225Z", 
            "actor": {
                "username": "7h0r4pp4n", 
                "url": "/7h0r4pp4n", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/049/473/f4f0d35495a2193b7f940e5f4f631b6cf135a0e8_medium.jpg?1461706353"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "If the session ids are not revalidated to the new account, how can the auth token for one account be used to delete another account? The generated tokens ARE uniquely linked to each account right?\nAnd the auth token I used for deleting the first account, is not sent back to the server at a later time. The only connection between these two accounts appear to be the presence of the session id in the browser's cookie jar.", 
            "markdown_message": "<p>If the session ids are not revalidated to the new account, how can the auth token for one account be used to delete another account? The generated tokens ARE uniquely linked to each account right?<br>\nAnd the auth token I used for deleting the first account, is not sent back to the server at a later time. The only connection between these two accounts appear to be the presence of the session id in the browser&#39;s cookie jar.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1303196, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-12-02T20:15:03.056Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-12-02T20:15:03.056Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "This all appears to relate to an old Warden vulnerability where csrf_tokens weren't being reset upon authentication. What the Warden developers did was implement a \"hook\" so that after each successful authentication the csrf_token is reset. Because our process for confirming accounts via email link did not qualify as \"authentication events\" to Warden this token was never being reset. We're working on a patch right now. Thanks for bringing this to our attention and I'll be sure to keep you updated on our progress.", 
            "markdown_message": "<p>This all appears to relate to an old Warden vulnerability where csrf_tokens weren&#39;t being reset upon authentication. What the Warden developers did was implement a &quot;hook&quot; so that after each successful authentication the csrf_token is reset. Because our process for confirming accounts via email link did not qualify as &quot;authentication events&quot; to Warden this token was never being reset. We&#39;re working on a patch right now. Thanks for bringing this to our attention and I&#39;ll be sure to keep you updated on our progress.</p>\n", 
            "type": "Activities::Comment", 
            "id": 1337422, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-12-02T20:16:41.075Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-12-02T20:16:41.075Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "additional_data": {
                "new_severity": "None (0.0)", 
                "old_severity": "High (7.4)"
            }, 
            "team_handle": "gitlab", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::ReportSeverityUpdated", 
            "id": 1337425, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-12-02T20:16:52.113Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-12-02T20:16:52.113Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "additional_data": {
                "new_severity": "Low", 
                "old_severity": "None (0.0)"
            }, 
            "team_handle": "gitlab", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::ReportSeverityUpdated", 
            "id": 1337426, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-12-02T20:18:11.326Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-12-02T20:18:11.326Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::BugTriaged", 
            "id": 1337431, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2016-12-03T00:57:22.347Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2016-12-03T00:57:22.347Z", 
            "actor": {
                "username": "7h0r4pp4n", 
                "url": "/7h0r4pp4n", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/049/473/f4f0d35495a2193b7f940e5f4f631b6cf135a0e8_medium.jpg?1461706353"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "Alright @briann :)", 
            "markdown_message": "<p>Alright <a href=\"/briann\">@briann</a> :)</p>\n", 
            "type": "Activities::Comment", 
            "id": 1337920, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "reporter": {
                "username": "7h0r4pp4n", 
                "url": "/7h0r4pp4n"
            }, 
            "created_at": "2017-02-25T00:11:10.346Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-02-25T00:11:10.346Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "This has been fixed in GitLab 8.17. Sessions are destroyed on logout and email confirmation links no longer automatically log in the user without a password. Thanks for the report!", 
            "markdown_message": "<p>This has been fixed in GitLab 8.17. Sessions are destroyed on logout and email confirmation links no longer automatically log in the user without a password. Thanks for the report!</p>\n", 
            "type": "Activities::BugResolved", 
            "id": 1504754, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-02-25T08:25:19.485Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-02-25T08:25:19.485Z", 
            "actor": {
                "username": "7h0r4pp4n", 
                "url": "/7h0r4pp4n", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/049/473/f4f0d35495a2193b7f940e5f4f631b6cf135a0e8_medium.jpg?1461706353"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "Sorry about the whole confusion about what exactly is the bug.\nBeen my pleasure mate :)", 
            "markdown_message": "<p>Sorry about the whole confusion about what exactly is the bug.<br>\nBeen my pleasure mate :)</p>\n", 
            "type": "Activities::Comment", 
            "id": 1505156, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-04-20T08:57:12.340Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-04-20T08:57:12.340Z", 
            "actor": {
                "username": "7h0r4pp4n", 
                "url": "/7h0r4pp4n", 
                "profile_picture_urls": {
                    "medium": "https://profile-photos.hackerone-user-content.com/000/049/473/f4f0d35495a2193b7f940e5f4f631b6cf135a0e8_medium.jpg?1461706353"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "first_to_agree": true, 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 1623195, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-04-20T16:50:53.872Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-04-20T16:50:53.872Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::AgreedOnGoingPublic", 
            "id": 1624204, 
            "genius_execution_id": null
        }, 
        {
            "automated_response": false, 
            "created_at": "2017-04-20T16:50:53.919Z", 
            "is_internal": false, 
            "editable": false, 
            "updated_at": "2017-04-20T16:50:53.919Z", 
            "actor": {
                "username": "briann", 
                "url": "/briann", 
                "profile_picture_urls": {
                    "medium": "/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"
                }, 
                "hackerone_triager": false
            }, 
            "team_handle": "gitlab", 
            "message": "", 
            "markdown_message": "", 
            "type": "Activities::ReportBecamePublic", 
            "id": 1624205, 
            "genius_execution_id": null
        }
    ], 
    "in_validation?": false, 
    "is_participant": false, 
    "singular_disclosure_allowed": true, 
    "reporter": {
        "username": "7h0r4pp4n", 
        "hacker_mediation": false, 
        "hackerone_triager": false, 
        "disabled": false, 
        "url": "/7h0r4pp4n", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/049/473/6496d187fe720ab2cee3cee2ae9ff0f0ff53286a_small.jpg?1461706353"
        }, 
        "is_me?": false
    }, 
    "weakness": {
        "id": 45, 
        "name": "Cross-Site Request Forgery (CSRF)"
    }, 
    "is_external_bug": false, 
    "visibility": "full", 
    "allow_singular_disclosure_after": -48865386.871376425, 
    "disclosed_at": "2017-04-20T16:50:53.899Z", 
    "stage": 4, 
    "url": "https://hackerone.com/reports/182487", 
    "created_at": "2016-11-16T11:14:50.871Z", 
    "original_report_url": null, 
    "vulnerability_information_html": "<p>The authentication token <code>authenticity_token</code> used in the POST request for deleting an account can be bypassed, by replacing the same with a token generated for deleting another account. This way, a self submitting form can be used to delete another user&#39;s account as long as he/she&#39;s logged in.</p>\n\n<p><strong>Steps to Reproduce:</strong></p>\n\n<ol>\n<li>Create an account and copy the POST request for deleting it.</li>\n</ol>\n<pre class=\"highlight plaintext\"><code>POST /users HTTP/1.1\nHost: gitlab.com\nReferer: https://gitlab.com/profile/account\nCookie: _gitlab_session=1staccount_cookie;\nContent-Type: application/x-www-form-urlencoded\n\n_method=delete&amp;authenticity_token=auth_1staccount\n</code></pre>\n<ol>\n<li>Create another account and send the above request after replacing the <code>_gitlab_session</code> cookie with that of the new one.  The <code>authenticity_token</code> remains the same as that of the first account.</li>\n<li>Send the request and the new account gets deleted.</li>\n</ol>\n\n<p>I have not explored all possible scenarios like different IP addresses or something. But the above situation, where I used accounts created using emails from a temporary email address generator, was reproduced multiple times.</p>\n", 
    "severity_rating": "low", 
    "team_private?": false, 
    "team": {
        "profile": {
            "website": "https://about.gitlab.com", 
            "about": "Open source software to collaborate on code", 
            "twitter_handle": "gitlab", 
            "name": "GitLab"
        }, 
        "handle": "gitlab", 
        "url": "https://hackerone.com/gitlab", 
        "state": "public_mode", 
        "profile_picture_urls": {
            "small": "https://profile-photos.hackerone-user-content.com/000/000/264/338ec4b43393873324e3f1911f2f107d025d13f1_small.png?1454722206", 
            "medium": "https://profile-photos.hackerone-user-content.com/000/000/264/f40e550269de1c8aef9adbdfe728c9aa8163a7e5_medium.png?1454722206"
        }, 
        "awards_miles": false, 
        "permissions": [], 
        "id": 264, 
        "default_currency": "usd"
    }, 
    "is_published": false
}